var app=function(e){"use strict";function t(){}function n(e,t){for(const n in t)e[n]=t[n];return e}function r(e){return e()}function i(){return Object.create(null)}function o(e){e.forEach(r)}function s(e){return"function"==typeof e}function a(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function l(e,t,n){if(e){const r=c(e,t,n);return e[0](r)}}function c(e,t,r){return e[1]?n({},n(t.$$scope.ctx,e[1](r?r(t):{}))):t.$$scope.ctx}function h(e,t,r,i){return e[1]?n({},n(t.$$scope.changed||{},e[1](i?i(r):{}))):t.$$scope.changed||{}}function u(e,t){e.appendChild(t)}function d(e,t,n){e.insertBefore(t,n||null)}function f(e){e.parentNode.removeChild(e)}function m(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function p(e){return document.createElement(e)}function g(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function v(e){return document.createTextNode(e)}function b(){return v(" ")}function w(){return v("")}function y(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function x(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function M(e,t){t=""+t,e.data!==t&&(e.data=t)}function $(e,t){(null!=t||e.value)&&(e.value=t)}function P(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}let k;function I(e){k=e}function N(){if(!k)throw new Error("Function called outside component initialization");return k}function j(e){N().$$.on_mount.push(e)}function S(e){N().$$.after_update.push(e)}function _(){const e=k;return(t,n)=>{const r=e.$$.callbacks[t];if(r){const i=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);r.slice().forEach(t=>{t.call(e,i)})}}}function C(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(e=>e(t))}const A=[],z=[],E=[],O=[],R=Promise.resolve();let D=!1;function L(e){E.push(e)}function T(e){O.push(e)}function U(){const e=new Set;do{for(;A.length;){const e=A.shift();I(e),F(e.$$)}for(;z.length;)z.pop()();for(let t=0;t<E.length;t+=1){const n=E[t];e.has(n)||(n(),e.add(n))}E.length=0}while(A.length);for(;O.length;)O.pop()();D=!1}function F(e){e.fragment&&(e.update(e.dirty),o(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(L))}const q=new Set;let V,H;function W(){V={r:0,c:[],p:V}}function G(){V.r||o(V.c),V=V.p}function B(e,t){e&&e.i&&(q.delete(e),e.i(t))}function J(e,t,n,r){if(e&&e.o){if(q.has(e))return;q.add(e),V.c.push(()=>{q.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}function K(e,t){J(e,1,1,()=>{t.delete(e.key)})}function X(e,t,n){-1!==e.$$.props.indexOf(t)&&(e.$$.bound[t]=n,n(e.$$.ctx[t]))}function Q(e,t,n){const{fragment:i,on_mount:a,on_destroy:l,after_update:c}=e.$$;i.m(t,n),L(()=>{const t=a.map(r).filter(s);l?l.push(...t):o(t),e.$$.on_mount=[]}),c.forEach(L)}function Z(e,t){e.$$.fragment&&(o(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function Y(e,t){e.$$.dirty||(A.push(e),D||(D=!0,R.then(U)),e.$$.dirty=i()),e.$$.dirty[t]=!0}function ee(e,n,r,s,a,l){const c=k;I(e);const h=n.props||{},u=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:a,bound:i(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:i(),dirty:null};let d=!1;var f;u.ctx=r?r(e,h,(t,n,r=n)=>(u.ctx&&a(u.ctx[t],u.ctx[t]=r)&&(u.bound[t]&&u.bound[t](r),d&&Y(e,t)),n)):h,u.update(),d=!0,o(u.before_update),u.fragment=s(u.ctx),n.target&&(n.hydrate?u.fragment.l((f=n.target,Array.from(f.childNodes))):u.fragment.c(),n.intro&&B(e.$$.fragment),Q(e,n.target,n.anchor),U()),I(c)}"undefined"!=typeof HTMLElement&&(H=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}$destroy(){Z(this,1),this.$destroy=t}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}});class te{$destroy(){Z(this,1),this.$destroy=t}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}const ne=()=>({}),re=()=>({});function ie(e){var t,n,r,i,o;const s=e.$$slots.default,a=l(s,e,null),m=e.$$slots.caption,g=l(m,e,re);return{c(){t=p("figure"),n=p("div"),a&&a.c(),r=b(),i=p("caption"),g&&g.c(),x(n,"class","figure-container svelte-jpfwvv"),x(i,"class","svelte-jpfwvv"),x(t,"class","svelte-jpfwvv")},l(e){a&&a.l(div_nodes),g&&g.l(caption_nodes)},m(e,s){d(e,t,s),u(t,n),a&&a.m(n,null),u(t,r),u(t,i),g&&g.m(i,null),o=!0},p(e,t){a&&a.p&&e.$$scope&&a.p(h(s,t,e,null),c(s,t,null)),g&&g.p&&e.$$scope&&g.p(h(m,t,e,ne),c(m,t,re))},i(e){o||(B(a,e),B(g,e),o=!0)},o(e){J(a,e),J(g,e),o=!1},d(e){e&&f(t),a&&a.d(e),g&&g.d(e)}}}function oe(e,t,n){let{$$slots:r={},$$scope:i}=t;return e.$set=(e=>{"$$scope"in e&&n("$$scope",i=e.$$scope)}),{$$slots:r,$$scope:i}}class se extends te{constructor(e){super(),ee(this,e,oe,ie,a,[])}}function ae(e){var n;return{c(){x(n=p("div"),"class","spacer svelte-6euh3r"),P(n,"height",e.height+"px")},m(e,t){d(e,n,t)},p(e,t){e.height&&P(n,"height",t.height+"px")},i:t,o:t,d(e){e&&f(n)}}}function le(e,t,n){let{height:r=50}=t;return e.$set=(e=>{"height"in e&&n("height",r=e.height)}),{height:r}}class ce extends te{constructor(e){super(),ee(this,e,le,ae,a,["height"])}}function he(e){var n,r,i;return{c(){n=p("a"),r=v(e.label),x(n,"class","label"),x(n,"href","#"),i=y(n,"click",e.onClick)},m(e,t){d(e,n,t),u(n,r)},p(e,t){e.label&&M(r,t.label)},i:t,o:t,d(e){e&&f(n),i()}}}function ue(e,t,n){let{label:r}=t;return e.$set=(e=>{"label"in e&&n("label",r=e.label)}),{label:r,onClick:e=>(e.preventDefault(),e.stopPropagation(),window._selectFmnistLabel&&window._selectFmnistLabel(e,r),!1)}}class de extends te{constructor(e){super(),ee(this,e,ue,he,a,["label"])}}var fe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function me(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function pe(e,t){return e(t={exports:{}},t.exports),t.exports}var ge=pe(function(e,t){!function(e){function t(e,t,n){this.obj=e,this.left=null,this.right=null,this.parent=n,this.dimension=t}function n(e){this.content=[],this.scoreFunction=e}n.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e},peek:function(){return this.content[0]},remove:function(e){for(var t=this.content.length,n=0;n<t;n++)if(this.content[n]==e){var r=this.content.pop();return void(n!=t-1&&(this.content[n]=r,this.scoreFunction(r)<this.scoreFunction(e)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e];e>0;){var n=Math.floor((e+1)/2)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}},sinkDown:function(e){for(var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);;){var i=2*(e+1),o=i-1,s=null;if(o<t){var a=this.content[o],l=this.scoreFunction(a);l<r&&(s=o)}if(i<t){var c=this.content[i];this.scoreFunction(c)<(null==s?r:l)&&(s=i)}if(null==s)break;this.content[e]=this.content[s],this.content[s]=n,e=s}}},e.kdTree=function(e,r,i){var o=this;Array.isArray(e)?this.root=function e(n,r,o){var s,a,l=r%i.length;return 0===n.length?null:1===n.length?new t(n[0],l,o):(n.sort(function(e,t){return e[i[l]]-t[i[l]]}),s=Math.floor(n.length/2),(a=new t(n[s],l,o)).left=e(n.slice(0,s),r+1,a),a.right=e(n.slice(s+1),r+1,a),a)}(e,0,null):function(e){o.root=e,function e(t){t.left&&(t.left.parent=t,e(t.left)),t.right&&(t.right.parent=t,e(t.right))}(o.root)}(e),this.toJSON=function(e){e||(e=this.root);var n=new t(e.obj,e.dimension,null);return e.left&&(n.left=o.toJSON(e.left)),e.right&&(n.right=o.toJSON(e.right)),n},this.insert=function(e){var n,r,o=function t(n,r){if(null===n)return r;var o=i[n.dimension];return e[o]<n.obj[o]?t(n.left,n):t(n.right,n)}(this.root,null);null!==o?(n=new t(e,(o.dimension+1)%i.length,o),r=i[o.dimension],e[r]<o.obj[r]?o.left=n:o.right=n):this.root=new t(e,0,null)},this.remove=function(e){var t;null!==(t=function t(n){if(null===n)return null;if(n.obj===e)return n;var r=i[n.dimension];return e[r]<n.obj[r]?t(n.left):t(n.right)}(o.root))&&function e(t){function n(e,t){var r,o,s,a,l;return null===e?null:(r=i[t],e.dimension===t?null!==e.left?n(e.left,t):e:(o=e.obj[r],s=n(e.left,t),a=n(e.right,t),l=e,null!==s&&s.obj[r]<o&&(l=s),null!==a&&a.obj[r]<l.obj[r]&&(l=a),l))}var r,s,a;if(null===t.left&&null===t.right)return null===t.parent?void(o.root=null):(a=i[t.parent.dimension],void(t.obj[a]<t.parent.obj[a]?t.parent.left=null:t.parent.right=null));null!==t.right?(s=(r=n(t.right,t.dimension)).obj,e(r),t.obj=s):(s=(r=n(t.left,t.dimension)).obj,e(r),t.right=t.left,t.left=null,t.obj=s)}(t)},this.nearest=function(e,t,s){var a,l,c;if(c=new n(function(e){return-e[1]}),s)for(a=0;a<t;a+=1)c.push([null,s]);for(o.root&&function n(o){function s(e,n){c.push([e,n]),c.size()>t&&c.pop()}var a,l,h,u,d=i[o.dimension],f=r(e,o.obj),m={};for(u=0;u<i.length;u+=1)u===o.dimension?m[i[u]]=e[i[u]]:m[i[u]]=o.obj[i[u]];l=r(m,o.obj),null!==o.right||null!==o.left?(n(a=null===o.right?o.left:null===o.left?o.right:e[d]<o.obj[d]?o.left:o.right),(c.size()<t||f<c.peek()[1])&&s(o,f),(c.size()<t||Math.abs(l)<c.peek()[1])&&null!==(h=a===o.left?o.right:o.left)&&n(h)):(c.size()<t||f<c.peek()[1])&&s(o,f)}(o.root),l=[],a=0;a<Math.min(t,c.content.length);a+=1)c.content[a][0]&&l.push([c.content[a][0].obj,c.content[a][1]]);return l},this.balanceFactor=function(){return function e(t){return null===t?0:Math.max(e(t.left),e(t.right))+1}(o.root)/(Math.log(function e(t){return null===t?0:e(t.left)+e(t.right)+1}(o.root))/Math.log(2))}},e.BinaryHeap=n}(t)});function ve(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var be,we,ye=(1===(be=ve).length&&(we=be,be=function(e,t){return ve(we(e),t)}),{left:function(e,t,n,r){for(null==n&&(n=0),null==r&&(r=e.length);n<r;){var i=n+r>>>1;be(e[i],t)<0?n=i+1:r=i}return n},right:function(e,t,n,r){for(null==n&&(n=0),null==r&&(r=e.length);n<r;){var i=n+r>>>1;be(e[i],t)>0?r=i:n=i+1}return n}}).right,xe=Math.sqrt(50),Me=Math.sqrt(10),$e=Math.sqrt(2);function Pe(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=xe?10:o>=Me?5:o>=$e?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=xe?10:o>=Me?5:o>=$e?2:1)}function ke(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Ie(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Ne(){}var je="\\s*([+-]?\\d+)\\s*",Se="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",_e="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ce=/^#([0-9a-f]{3})$/,Ae=/^#([0-9a-f]{6})$/,ze=new RegExp("^rgb\\("+[je,je,je]+"\\)$"),Ee=new RegExp("^rgb\\("+[_e,_e,_e]+"\\)$"),Oe=new RegExp("^rgba\\("+[je,je,je,Se]+"\\)$"),Re=new RegExp("^rgba\\("+[_e,_e,_e,Se]+"\\)$"),De=new RegExp("^hsl\\("+[Se,_e,_e]+"\\)$"),Le=new RegExp("^hsla\\("+[Se,_e,_e,Se]+"\\)$"),Te={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ue(){return this.rgb().formatHex()}function Fe(){return this.rgb().formatRgb()}function qe(e){var t;return e=(e+"").trim().toLowerCase(),(t=Ce.exec(e))?new Be((t=parseInt(t[1],16))>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):(t=Ae.exec(e))?Ve(parseInt(t[1],16)):(t=ze.exec(e))?new Be(t[1],t[2],t[3],1):(t=Ee.exec(e))?new Be(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Oe.exec(e))?He(t[1],t[2],t[3],t[4]):(t=Re.exec(e))?He(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=De.exec(e))?Qe(t[1],t[2]/100,t[3]/100,1):(t=Le.exec(e))?Qe(t[1],t[2]/100,t[3]/100,t[4]):Te.hasOwnProperty(e)?Ve(Te[e]):"transparent"===e?new Be(NaN,NaN,NaN,0):null}function Ve(e){return new Be(e>>16&255,e>>8&255,255&e,1)}function He(e,t,n,r){return r<=0&&(e=t=n=NaN),new Be(e,t,n,r)}function We(e){return e instanceof Ne||(e=qe(e)),e?new Be((e=e.rgb()).r,e.g,e.b,e.opacity):new Be}function Ge(e,t,n,r){return 1===arguments.length?We(e):new Be(e,t,n,null==r?1:r)}function Be(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Je(){return"#"+Xe(this.r)+Xe(this.g)+Xe(this.b)}function Ke(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Xe(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Qe(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ye(e,t,n,r)}function Ze(e){if(e instanceof Ye)return new Ye(e.h,e.s,e.l,e.opacity);if(e instanceof Ne||(e=qe(e)),!e)return new Ye;if(e instanceof Ye)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),s=NaN,a=o-i,l=(o+i)/2;return a?(s=t===o?(n-r)/a+6*(n<r):n===o?(r-t)/a+2:(t-n)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new Ye(s,a,l,e.opacity)}function Ye(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function et(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}ke(Ne,qe,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Ue,formatHex:Ue,formatHsl:function(){return Ze(this).formatHsl()},formatRgb:Fe,toString:Fe}),ke(Be,Ge,Ie(Ne,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new Be(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new Be(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Je,formatHex:Je,formatRgb:Ke,toString:Ke})),ke(Ye,function(e,t,n,r){return 1===arguments.length?Ze(e):new Ye(e,t,n,null==r?1:r)},Ie(Ne,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new Ye(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new Ye(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Be(et(e>=240?e-240:e+120,i,r),et(e,i,r),et(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));var tt=Math.PI/180,nt=180/Math.PI,rt=.96422,it=1,ot=.82521,st=4/29,at=6/29,lt=3*at*at,ct=at*at*at;function ht(e){if(e instanceof ut)return new ut(e.l,e.a,e.b,e.opacity);if(e instanceof gt)return vt(e);e instanceof Be||(e=We(e));var t,n,r=pt(e.r),i=pt(e.g),o=pt(e.b),s=dt((.2225045*r+.7168786*i+.0606169*o)/it);return r===i&&i===o?t=n=s:(t=dt((.4360747*r+.3850649*i+.1430804*o)/rt),n=dt((.0139322*r+.0971045*i+.7141733*o)/ot)),new ut(116*s-16,500*(t-s),200*(s-n),e.opacity)}function ut(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function dt(e){return e>ct?Math.pow(e,1/3):e/lt+st}function ft(e){return e>at?e*e*e:lt*(e-st)}function mt(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function pt(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function gt(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function vt(e){if(isNaN(e.h))return new ut(e.l,0,0,e.opacity);var t=e.h*tt;return new ut(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}ke(ut,function(e,t,n,r){return 1===arguments.length?ht(e):new ut(e,t,n,null==r?1:r)},Ie(Ne,{brighter:function(e){return new ut(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new ut(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new Be(mt(3.1338561*(t=rt*ft(t))-1.6168667*(e=it*ft(e))-.4906146*(n=ot*ft(n))),mt(-.9787684*t+1.9161415*e+.033454*n),mt(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),ke(gt,function(e,t,n,r){return 1===arguments.length?function(e){if(e instanceof gt)return new gt(e.h,e.c,e.l,e.opacity);if(e instanceof ut||(e=ht(e)),0===e.a&&0===e.b)return new gt(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*nt;return new gt(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}(e):new gt(e,t,n,null==r?1:r)},Ie(Ne,{brighter:function(e){return new gt(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new gt(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return vt(this).rgb()}}));var bt=-.14861,wt=1.78277,yt=-.29227,xt=-.90649,Mt=1.97294,$t=Mt*xt,Pt=Mt*wt,kt=wt*yt-xt*bt;function It(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Nt(e){return function(){return e}}function jt(e){return 1==(e=+e)?St:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Nt(isNaN(t)?n:t)}}function St(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):Nt(isNaN(e)?t:e)}ke(It,function(e,t,n,r){return 1===arguments.length?function(e){if(e instanceof It)return new It(e.h,e.s,e.l,e.opacity);e instanceof Be||(e=We(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(kt*r+$t*t-Pt*n)/(kt+$t-Pt),o=r-i,s=(Mt*(n-i)-yt*o)/xt,a=Math.sqrt(s*s+o*o)/(Mt*i*(1-i)),l=a?Math.atan2(s,o)*nt-120:NaN;return new It(l<0?l+360:l,a,i,e.opacity)}(e):new It(e,t,n,null==r?1:r)},Ie(Ne,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new It(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new It(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*tt,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new Be(255*(t+n*(bt*r+wt*i)),255*(t+n*(yt*r+xt*i)),255*(t+n*(Mt*r)),this.opacity)}}));var _t=function e(t){var n=jt(t);function r(e,t){var r=n((e=Ge(e)).r,(t=Ge(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),s=St(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=s(t),e+""}}return r.gamma=e,r}(1);function Ct(e,t){return t-=e=+e,function(n){return e+t*n}}var At=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zt=new RegExp(At.source,"g");function Et(e,t){var n,r=typeof t;return null==t||"boolean"===r?Nt(t):("number"===r?Ct:"string"===r?(n=qe(t))?(t=n,_t):function(e,t){var n,r,i,o=At.lastIndex=zt.lastIndex=0,s=-1,a=[],l=[];for(e+="",t+="";(n=At.exec(e))&&(r=zt.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),a[s]?a[s]+=i:a[++s]=i),(n=n[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,l.push({i:s,x:Ct(n,r)})),o=zt.lastIndex;return o<t.length&&(i=t.slice(o),a[s]?a[s]+=i:a[++s]=i),a.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)a[(n=l[r]).i]=n.x(e);return a.join("")})}:t instanceof qe?_t:t instanceof Date?function(e,t){var n=new Date;return t-=e=+e,function(r){return n.setTime(e+t*r),n}}:Array.isArray(t)?function(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),s=new Array(r);for(n=0;n<i;++n)o[n]=Et(e[n],t[n]);for(;n<r;++n)s[n]=t[n];return function(e){for(n=0;n<i;++n)s[n]=o[n](e);return s}}:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?function(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=Et(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}:Ct)(e,t)}function Ot(e,t){return t-=e=+e,function(n){return Math.round(e+t*n)}}function Rt(e){return+e}var Dt=[0,1];function Lt(e){return e}function Tt(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function Ut(e,t,n){var r=e[0],i=e[1],o=t[0],s=t[1];return i<r?(r=Tt(i,r),o=n(s,o)):(r=Tt(r,i),o=n(o,s)),function(e){return o(r(e))}}function Ft(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),s=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<r;)i[s]=Tt(e[s],e[s+1]),o[s]=n(t[s],t[s+1]);return function(t){var n=ye(e,t,1,r)-1;return o[n](i[n](t))}}function qt(){var e,t,n,r,i,o,s=Dt,a=Dt,l=Et,c=Lt;function h(){var e,t,n,l=Math.min(s.length,a.length);return c!==Lt&&(e=s[0],t=s[l-1],e>t&&(n=e,e=t,t=n),c=function(n){return Math.max(e,Math.min(t,n))}),r=l>2?Ft:Ut,i=o=null,u}function u(t){return isNaN(t=+t)?n:(i||(i=r(s.map(e),a,l)))(e(c(t)))}return u.invert=function(n){return c(t((o||(o=r(a,s.map(e),Ct)))(n)))},u.domain=function(e){return arguments.length?(s=Array.from(e,Rt),h()):s.slice()},u.range=function(e){return arguments.length?(a=Array.from(e),h()):a.slice()},u.rangeRound=function(e){return a=Array.from(e),l=Ot,h()},u.clamp=function(e){return arguments.length?(c=!!e||Lt,h()):c!==Lt},u.interpolate=function(e){return arguments.length?(l=e,h()):l},u.unknown=function(e){return arguments.length?(n=e,u):n},function(n,r){return e=n,t=r,h()}}function Vt(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Ht(e){return(e=Vt(Math.abs(e)))?e[1]:NaN}var Wt,Gt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Bt(e){if(!(t=Gt.exec(e)))throw new Error("invalid format: "+e);var t;return new Jt({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Jt(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function Kt(e,t){var n=Vt(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Bt.prototype=Jt.prototype,Jt.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Xt={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Kt(100*e,t)},r:Kt,s:function(e,t){var n=Vt(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(Wt=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=r.length;return o===s?r:o>s?r+new Array(o-s+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Vt(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Qt(e){return e}var Zt,Yt,en,tn=Array.prototype.map,nn=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function rn(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?Qt:(t=tn.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],s=0,a=t[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),o.push(e.substring(i-=a,i+a)),!((l+=a+1)>r));)a=t[s=(s+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",s=void 0===e.decimal?".":e.decimal+"",a=void 0===e.numerals?Qt:function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(tn.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"-":e.minus+"",h=void 0===e.nan?"NaN":e.nan+"";function u(e){var t=(e=Bt(e)).fill,n=e.align,u=e.sign,d=e.symbol,f=e.zero,m=e.width,p=e.comma,g=e.precision,v=e.trim,b=e.type;"n"===b?(p=!0,b="g"):Xt[b]||(void 0===g&&(g=12),v=!0,b="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var w="$"===d?i:"#"===d&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",y="$"===d?o:/[%p]/.test(b)?l:"",x=Xt[b],M=/[defgprs%]/.test(b);function $(e){var i,o,l,d=w,$=y;if("c"===b)$=x(e)+$,e="";else{var P=(e=+e)<0;if(e=isNaN(e)?h:x(Math.abs(e),g),v&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(i>0){if(!+e[r])break e;i=0}}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),P&&0==+e&&(P=!1),d=(P?"("===u?u:c:"-"===u||"("===u?"":u)+d,$=("s"===b?nn[8+Wt/3]:"")+$+(P&&"("===u?")":""),M)for(i=-1,o=e.length;++i<o;)if(48>(l=e.charCodeAt(i))||l>57){$=(46===l?s+e.slice(i+1):e.slice(i))+$,e=e.slice(0,i);break}}p&&!f&&(e=r(e,1/0));var k=d.length+e.length+$.length,I=k<m?new Array(m-k+1).join(t):"";switch(p&&f&&(e=r(I+e,I.length?m-$.length:1/0),I=""),n){case"<":e=d+e+$+I;break;case"=":e=d+I+e+$;break;case"^":e=I.slice(0,k=I.length>>1)+d+e+$+I.slice(k);break;default:e=I+d+e+$}return a(e)}return g=void 0===g?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),$.toString=function(){return e+""},$}return{format:u,formatPrefix:function(e,t){var n=u(((e=Bt(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(Ht(t)/3))),i=Math.pow(10,-r),o=nn[8+r/3];return function(e){return n(i*e)+o}}}}function on(e,t,n,r){var i,o=function(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=xe?i*=10:o>=Me?i*=5:o>=$e&&(i*=2),t<e?-i:i}(e,t,n);switch((r=Bt(null==r?",f":r)).type){case"s":var s=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Ht(t)/3)))-Ht(Math.abs(e)))}(o,s))||(r.precision=i),en(r,s);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Ht(t)-Ht(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-Ht(Math.abs(e)))}(o))||(r.precision=i-2*("%"===r.type))}return Yt(r)}function sn(e){var t=e.domain;return e.ticks=function(e){var n=t();return function(e,t,n){var r,i,o,s,a=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(s=Pe(e,t,n))||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=new Array(i=Math.ceil(t-e+1));++a<i;)o[a]=(e+a)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=new Array(i=Math.ceil(e-t+1));++a<i;)o[a]=(e-a)/s;return r&&o.reverse(),o}(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return on(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i=t(),o=0,s=i.length-1,a=i[o],l=i[s];return l<a&&(r=a,a=l,l=r,r=o,o=s,s=r),(r=Pe(a,l,n))>0?r=Pe(a=Math.floor(a/r)*r,l=Math.ceil(l/r)*r,n):r<0&&(r=Pe(a=Math.ceil(a*r)/r,l=Math.floor(l*r)/r,n)),r>0?(i[o]=Math.floor(a/r)*r,i[s]=Math.ceil(l/r)*r,t(i)):r<0&&(i[o]=Math.ceil(a*r)/r,i[s]=Math.floor(l*r)/r,t(i)),e},e}function an(){var e=qt()(Lt,Lt);return e.copy=function(){return t=e,an().domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown());var t},function(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}.apply(e,arguments),sn(e)}Zt=rn({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),Yt=Zt.format,en=Zt.formatPrefix;const ln=new class{constructor(e){this._seed=e%2147483647,this._seed<=0&&(this._seed+=2147483646)}next(){return this._seed=16807*this._seed%2147483647}nextFloat(e,t){return(this.next()-1)/2147483646}}(112),cn=(e,t,n=0)=>Math.max(Math.min(e,t),n),hn=e=>Math.floor(e*ln.nextFloat()),un=(e,t,n)=>{let r=hn(e),i=Math.sin(r/e*6*Math.PI)*t/4+t/2;return i+=hn(t/5)*(ln.nextFloat()>.5?1:-1),{x:cn(r,e-n,n),y:cn(i,t-n,n)}};function dn(e,t,n=5){const{width:r,height:i}=t,o=[];for(let t=0;t<e;t++){const e=un(r,i,n);o.push({...e,index:t})}return o}function fn(e){var n,r;return{c(){x(n=p("input"),"type","range"),x(n,"min",e.min),x(n,"max",e.max),x(n,"step",e.step),x(n,"class","svelte-fa559t"),r=[y(n,"change",e.input_change_input_handler),y(n,"input",e.input_change_input_handler),y(n,"change",e.onSliderChange)]},m(t,r){d(t,n,r),$(n,e.value)},p(e,t){e.value&&$(n,t.value),e.min&&x(n,"min",t.min),e.max&&x(n,"max",t.max),e.step&&x(n,"step",t.step)},i:t,o:t,d(e){e&&f(n),o(r)}}}function mn(e,t,n){let{value:r,min:i=0,max:o=100,step:s=1,onChange:a=(()=>{})}=t;return e.$set=(e=>{"value"in e&&n("value",r=e.value),"min"in e&&n("min",i=e.min),"max"in e&&n("max",o=e.max),"step"in e&&n("step",s=e.step),"onChange"in e&&n("onChange",a=e.onChange)}),{value:r,min:i,max:o,step:s,onChange:a,onSliderChange:e=>{a(e.target.value)},input_change_input_handler:function(){r=function(e){return""===e?void 0:+e}(this.value),n("value",r)}}}class pn extends te{constructor(e){super(),ee(this,e,mn,fn,a,["value","min","max","step","onChange"])}}function gn(e){var t,n,r,i,o,s,a,l,c,h,m,g,w,$,P,k,I,N,j,S,_;function C(t){e.slider0_value_binding.call(null,t),h=!0,T(()=>h=!1)}let A={min:0,max:100,step:1};void 0!==e.extent&&(A.value=e.extent);var E=new pn({props:A});function O(t){e.slider1_value_binding.call(null,t),I=!0,T(()=>I=!1)}z.push(()=>X(E,"value",C));let R={min:2,max:10,step:1};void 0!==e.nNearest&&(R.value=e.nNearest);var D=new pn({props:R});return z.push(()=>X(D,"value",O)),{c(){t=p("div"),n=p("canvas"),r=b(),i=p("div"),o=p("label"),s=v("extent: "),a=v(e.extent),l=v("%"),c=b(),E.$$.fragment.c(),m=b(),g=p("div"),w=p("label"),$=v("n_nearest: "),P=v(e.nNearest),k=b(),D.$$.fragment.c(),N=b(),(j=p("div")).innerHTML='<i class="material-icons">refresh</i>',x(n,"width",bn),x(n,"height",wn),x(n,"class","svelte-1a9dhel"),x(o,"class","svelte-1a9dhel"),x(i,"class","controls svelte-1a9dhel"),x(w,"class","svelte-1a9dhel"),x(g,"class","controls svelte-1a9dhel"),x(j,"class","refresh svelte-1a9dhel"),x(t,"class","container svelte-1a9dhel"),_=y(j,"click",e.refreshPoints)},m(h,f){d(h,t,f),u(t,n),e.canvas_1_binding(n),u(t,r),u(t,i),u(i,o),u(o,s),u(o,a),u(o,l),u(i,c),Q(E,i,null),u(t,m),u(t,g),u(g,w),u(w,$),u(w,P),u(g,k),Q(D,g,null),u(t,N),u(t,j),S=!0},p(e,t){S&&!e.extent||M(a,t.extent);var n={};!h&&e.extent&&(n.value=t.extent),E.$set(n),S&&!e.nNearest||M(P,t.nNearest);var r={};!I&&e.nNearest&&(r.value=t.nNearest),D.$set(r)},i(e){S||(B(E.$$.fragment,e),B(D.$$.fragment,e),S=!0)},o(e){J(E.$$.fragment,e),J(D.$$.fragment,e),S=!1},d(n){n&&f(t),e.canvas_1_binding(null),Z(E),Z(D),_()}}}const vn=9,bn=2048,wn=1024,yn=100;function xn(e,t,n){const r=[[44,123,182],[0,166,202],[0,204,188],[144,235,157]],i=an().range(r);let o,s=0,a=5,l=5;i.domain(r.map((e,t)=>t/(r.length-1)*bn));let c=dn(yn,{width:bn,height:wn},vn);let h,u,d,f,m;const p=()=>{const e=new ge.kdTree([...c],(e,t)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),["x","y"]);h=c.map(t=>{return e.nearest(t,l+1).sort((e,t)=>e[1]-t[1]).slice(1,l+1).map(e=>{const t=e[0],{x:n,y:r,index:i}=t;return{point:{x:n,y:r},index:i,distance:e[1]}})}),u=h.map(e=>e.map(e=>e.distance)),d=u.map(e=>e[e.length-1]),f=c.map((e,t)=>{const n=d[t],r=u[t][0],i=h[t][0].index,o=d[i],s=u[i][0];if(r>s){const e=h[i][0].index;return r-o*(s/(o+d[e]))}return r/(n+o)*n}),m=c.map(e=>i(e.x))},g=()=>{a!==l&&(p(),a=l);const e=o.getContext("2d"),t=s/100;e.clearRect(0,0,bn,wn),c.forEach((t,n)=>{const{x:r,y:i}=t;e.beginPath(),e.arc(r,i,vn,0,2*Math.PI);const[o,s,a]=m[n];e.fillStyle=`rgba(${o},${s},${a},1)`,e.fill()}),c.forEach((n,r)=>{const{x:i,y:o}=n,s=f[r],a=d[r],l=a*t,[c,h,u]=m[r],p=`rgba(${c},${h},${u},0.2)`,g=`rgba(${c},${h},${u},0.0)`,v=e.createRadialGradient(i,o,s,i,o,.85*a);v.addColorStop(0,p),v.addColorStop(1,g),e.beginPath(),e.arc(i,o,l,0,2*Math.PI),e.fillStyle=v,e.fill(),e.beginPath();const b=Math.min(l,s);e.arc(i,o,b,0,2*Math.PI),e.fillStyle=`rgba(${c},${h},${u},0.2)`,e.fill()}),c.forEach((n,r)=>{const i=d[r],o=i*t,s=h[r];for(const a of s){const{point:s,index:l,distance:c}=a;if(c<=o+d[l]*t){const t=c/i;e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(s.x,s.y),e.lineWidth=2+5*(1-t);const[o,a,l]=m[r],h=`rgba(${o},${a},${l},${1-.5*t})`;e.strokeStyle=h,e.stroke()}}})};return p(),S(()=>{g()}),{canvas:o,extent:s,nNearest:l,refreshPoints:()=>{c=dn(yn,{width:bn,height:wn},vn),p(),g()},canvas_1_binding:function(e){z[e?"unshift":"push"](()=>{n("canvas",o=e)})},slider0_value_binding:function(e){n("extent",s=e)},slider1_value_binding:function(e){n("nNearest",l=e)}}}class Mn extends te{constructor(e){super(),ee(this,e,xn,gn,a,[])}}const $n=[0,6,2,4,3,5,7,9,1,8];async function Pn(){const e=await fetch("fmnist_tsne_vs_umap.json");return function(e){const t={};$n.forEach((e,n)=>t[e]=n),e.labels=e.labels.map(e=>t[e]);const n=[...e.labelNames];return e.labelNames=$n.map(e=>n[e]),e}(await e.json())}var kn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},In=pe(function(e){var t=Array.prototype.concat,n=Array.prototype.slice,r=e.exports=function(e){for(var r,i=[],o=0,s=e.length;o<s;o++){var a=e[o];(r=a)&&"string"!=typeof r&&(r instanceof Array||Array.isArray(r)||r.length>=0&&(r.splice instanceof Function||Object.getOwnPropertyDescriptor(r,r.length-1)&&"String"!==r.constructor.name))?i=t.call(i,n.call(a)):i.push(a)}return i};r.wrap=function(e){return function(){return e(r(arguments))}}}),Nn=pe(function(e){var t={};for(var n in kn)kn.hasOwnProperty(n)&&(t[kn[n]]=n);var r=e.exports={to:{},get:{}};function i(e,t,n){return Math.min(Math.max(t,e),n)}function o(e){var t=e.toString(16).toUpperCase();return t.length<2?"0"+t:t}r.get=function(e){var t,n;switch(e.substring(0,3).toLowerCase()){case"hsl":t=r.get.hsl(e),n="hsl";break;case"hwb":t=r.get.hwb(e),n="hwb";break;default:t=r.get.rgb(e),n="rgb"}return t?{model:n,value:t}:null},r.get.rgb=function(e){if(!e)return null;var t,n,r,o=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=t[2],t=t[1],n=0;n<3;n++){var s=2*n;o[n]=parseInt(t.slice(s,s+2),16)}r&&(o[3]=Math.round(parseInt(r,16)/255*100)/100)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(r=(t=t[1])[3],n=0;n<3;n++)o[n]=parseInt(t[n]+t[n],16);r&&(o[3]=Math.round(parseInt(r+r,16)/255*100)/100)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(n=0;n<3;n++)o[n]=parseInt(t[n+1],0);t[4]&&(o[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(t=e.match(/(\D+)/))?"transparent"===t[1]?[0,0,0,0]:(o=kn[t[1]])?(o[3]=1,o):null:null;for(n=0;n<3;n++)o[n]=Math.round(2.55*parseFloat(t[n+1]));t[4]&&(o[3]=parseFloat(t[4]))}for(n=0;n<3;n++)o[n]=i(o[n],0,255);return o[3]=i(o[3],0,1),o},r.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var n=parseFloat(t[4]);return[(parseFloat(t[1])+360)%360,i(parseFloat(t[2]),0,100),i(parseFloat(t[3]),0,100),i(isNaN(n)?1:n,0,1)]}return null},r.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var n=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,i(parseFloat(t[2]),0,100),i(parseFloat(t[3]),0,100),i(isNaN(n)?1:n,0,1)]}return null},r.to.hex=function(){var e=In(arguments);return"#"+o(e[0])+o(e[1])+o(e[2])+(e[3]<1?o(Math.round(255*e[3])):"")},r.to.rgb=function(){var e=In(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},r.to.rgb.percent=function(){var e=In(arguments),t=Math.round(e[0]/255*100),n=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+n+"%, "+r+"%)":"rgba("+t+"%, "+n+"%, "+r+"%, "+e[3]+")"},r.to.hsl=function(){var e=In(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},r.to.hwb=function(){var e=In(arguments),t="";return e.length>=4&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},r.to.keyword=function(e){return t[e.slice(0,3)]}}),jn=(Nn.to,Nn.get,pe(function(e){var t={};for(var n in kn)kn.hasOwnProperty(n)&&(t[kn[n]]=n);var r=e.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var i in r)if(r.hasOwnProperty(i)){if(!("channels"in r[i]))throw new Error("missing channels property: "+i);if(!("labels"in r[i]))throw new Error("missing channel labels property: "+i);if(r[i].labels.length!==r[i].channels)throw new Error("channel and label counts mismatch: "+i);var o=r[i].channels,s=r[i].labels;delete r[i].channels,delete r[i].labels,Object.defineProperty(r[i],"channels",{value:o}),Object.defineProperty(r[i],"labels",{value:s})}r.rgb.hsl=function(e){var t,n,r=e[0]/255,i=e[1]/255,o=e[2]/255,s=Math.min(r,i,o),a=Math.max(r,i,o),l=a-s;return a===s?t=0:r===a?t=(i-o)/l:i===a?t=2+(o-r)/l:o===a&&(t=4+(r-i)/l),(t=Math.min(60*t,360))<0&&(t+=360),n=(s+a)/2,[t,100*(a===s?0:n<=.5?l/(a+s):l/(2-a-s)),100*n]},r.rgb.hsv=function(e){var t,n,r,i,o,s=e[0]/255,a=e[1]/255,l=e[2]/255,c=Math.max(s,a,l),h=c-Math.min(s,a,l),u=function(e){return(c-e)/6/h+.5};return 0===h?i=o=0:(o=h/c,t=u(s),n=u(a),r=u(l),s===c?i=r-n:a===c?i=1/3+t-r:l===c&&(i=2/3+n-t),i<0?i+=1:i>1&&(i-=1)),[360*i,100*o,100*c]},r.rgb.hwb=function(e){var t=e[0],n=e[1],i=e[2];return[r.rgb.hsl(e)[0],100*(1/255*Math.min(t,Math.min(n,i))),100*(i=1-1/255*Math.max(t,Math.max(n,i)))]},r.rgb.cmyk=function(e){var t,n=e[0]/255,r=e[1]/255,i=e[2]/255;return[100*((1-n-(t=Math.min(1-n,1-r,1-i)))/(1-t)||0),100*((1-r-t)/(1-t)||0),100*((1-i-t)/(1-t)||0),100*t]},r.rgb.keyword=function(e){var n=t[e];if(n)return n;var r,i,o,s=1/0;for(var a in kn)if(kn.hasOwnProperty(a)){var l=kn[a],c=(i=e,o=l,Math.pow(i[0]-o[0],2)+Math.pow(i[1]-o[1],2)+Math.pow(i[2]-o[2],2));c<s&&(s=c,r=a)}return r},r.keyword.rgb=function(e){return kn[e]},r.rgb.xyz=function(e){var t=e[0]/255,n=e[1]/255,r=e[2]/255;return[100*(.4124*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*t+.7152*n+.0722*r),100*(.0193*t+.1192*n+.9505*r)]},r.rgb.lab=function(e){var t=r.rgb.xyz(e),n=t[0],i=t[1],o=t[2];return i/=100,o/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(n-i),200*(i-(o=o>.008856?Math.pow(o,1/3):7.787*o+16/116))]},r.hsl.rgb=function(e){var t,n,r,i,o,s=e[0]/360,a=e[1]/100,l=e[2]/100;if(0===a)return[o=255*l,o,o];t=2*l-(n=l<.5?l*(1+a):l+a-l*a),i=[0,0,0];for(var c=0;c<3;c++)(r=s+1/3*-(c-1))<0&&r++,r>1&&r--,o=6*r<1?t+6*(n-t)*r:2*r<1?n:3*r<2?t+(n-t)*(2/3-r)*6:t,i[c]=255*o;return i},r.hsl.hsv=function(e){var t=e[0],n=e[1]/100,r=e[2]/100,i=n,o=Math.max(r,.01);return n*=(r*=2)<=1?r:2-r,i*=o<=1?o:2-o,[t,100*(0===r?2*i/(o+i):2*n/(r+n)),100*((r+n)/2)]},r.hsv.rgb=function(e){var t=e[0]/60,n=e[1]/100,r=e[2]/100,i=Math.floor(t)%6,o=t-Math.floor(t),s=255*r*(1-n),a=255*r*(1-n*o),l=255*r*(1-n*(1-o));switch(r*=255,i){case 0:return[r,l,s];case 1:return[a,r,s];case 2:return[s,r,l];case 3:return[s,a,r];case 4:return[l,s,r];case 5:return[r,s,a]}},r.hsv.hsl=function(e){var t,n,r,i=e[0],o=e[1]/100,s=e[2]/100,a=Math.max(s,.01);return r=(2-o)*s,n=o*a,[i,100*(n=(n/=(t=(2-o)*a)<=1?t:2-t)||0),100*(r/=2)]},r.hwb.rgb=function(e){var t,n,r,i,o,s,a,l=e[0]/360,c=e[1]/100,h=e[2]/100,u=c+h;switch(u>1&&(c/=u,h/=u),r=6*l-(t=Math.floor(6*l)),0!=(1&t)&&(r=1-r),i=c+r*((n=1-h)-c),t){default:case 6:case 0:o=n,s=i,a=c;break;case 1:o=i,s=n,a=c;break;case 2:o=c,s=n,a=i;break;case 3:o=c,s=i,a=n;break;case 4:o=i,s=c,a=n;break;case 5:o=n,s=c,a=i}return[255*o,255*s,255*a]},r.cmyk.rgb=function(e){var t=e[0]/100,n=e[1]/100,r=e[2]/100,i=e[3]/100;return[255*(1-Math.min(1,t*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i)),255*(1-Math.min(1,r*(1-i)+i))]},r.xyz.rgb=function(e){var t,n,r,i=e[0]/100,o=e[1]/100,s=e[2]/100;return n=-.9689*i+1.8758*o+.0415*s,r=.0557*i+-.204*o+1.057*s,t=(t=3.2406*i+-1.5372*o+-.4986*s)>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(t=Math.min(Math.max(0,t),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]},r.xyz.lab=function(e){var t=e[0],n=e[1],r=e[2];return n/=100,r/=108.883,t=(t/=95.047)>.008856?Math.pow(t,1/3):7.787*t+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(t-n),200*(n-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},r.lab.xyz=function(e){var t,n,r,i=e[0];t=e[1]/500+(n=(i+16)/116),r=n-e[2]/200;var o=Math.pow(n,3),s=Math.pow(t,3),a=Math.pow(r,3);return n=o>.008856?o:(n-16/116)/7.787,t=s>.008856?s:(t-16/116)/7.787,r=a>.008856?a:(r-16/116)/7.787,[t*=95.047,n*=100,r*=108.883]},r.lab.lch=function(e){var t,n=e[0],r=e[1],i=e[2];return(t=360*Math.atan2(i,r)/2/Math.PI)<0&&(t+=360),[n,Math.sqrt(r*r+i*i),t]},r.lch.lab=function(e){var t,n=e[0],r=e[1];return t=e[2]/360*2*Math.PI,[n,r*Math.cos(t),r*Math.sin(t)]},r.rgb.ansi16=function(e){var t=e[0],n=e[1],i=e[2],o=1 in arguments?arguments[1]:r.rgb.hsv(e)[2];if(0===(o=Math.round(o/50)))return 30;var s=30+(Math.round(i/255)<<2|Math.round(n/255)<<1|Math.round(t/255));return 2===o&&(s+=60),s},r.hsv.ansi16=function(e){return r.rgb.ansi16(r.hsv.rgb(e),e[2])},r.rgb.ansi256=function(e){var t=e[0],n=e[1],r=e[2];return t===n&&n===r?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)},r.ansi16.rgb=function(e){var t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),[t=t/10.5*255,t,t];var n=.5*(1+~~(e>50));return[(1&t)*n*255,(t>>1&1)*n*255,(t>>2&1)*n*255]},r.ansi256.rgb=function(e){if(e>=232){var t=10*(e-232)+8;return[t,t,t]}var n;return e-=16,[Math.floor(e/36)/5*255,Math.floor((n=e%36)/6)/5*255,n%6/5*255]},r.rgb.hex=function(e){var t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},r.hex.rgb=function(e){var t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];var n=t[0];3===t[0].length&&(n=n.split("").map(function(e){return e+e}).join(""));var r=parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},r.rgb.hcg=function(e){var t,n=e[0]/255,r=e[1]/255,i=e[2]/255,o=Math.max(Math.max(n,r),i),s=Math.min(Math.min(n,r),i),a=o-s;return t=a<=0?0:o===n?(r-i)/a%6:o===r?2+(i-n)/a:4+(n-r)/a+4,t/=6,[360*(t%=1),100*a,100*(a<1?s/(1-a):0)]},r.hsl.hcg=function(e){var t=e[1]/100,n=e[2]/100,r=1,i=0;return(r=n<.5?2*t*n:2*t*(1-n))<1&&(i=(n-.5*r)/(1-r)),[e[0],100*r,100*i]},r.hsv.hcg=function(e){var t=e[1]/100,n=e[2]/100,r=t*n,i=0;return r<1&&(i=(n-r)/(1-r)),[e[0],100*r,100*i]},r.hcg.rgb=function(e){var t=e[0]/360,n=e[1]/100,r=e[2]/100;if(0===n)return[255*r,255*r,255*r];var i,o=[0,0,0],s=t%1*6,a=s%1,l=1-a;switch(Math.floor(s)){case 0:o[0]=1,o[1]=a,o[2]=0;break;case 1:o[0]=l,o[1]=1,o[2]=0;break;case 2:o[0]=0,o[1]=1,o[2]=a;break;case 3:o[0]=0,o[1]=l,o[2]=1;break;case 4:o[0]=a,o[1]=0,o[2]=1;break;default:o[0]=1,o[1]=0,o[2]=l}return i=(1-n)*r,[255*(n*o[0]+i),255*(n*o[1]+i),255*(n*o[2]+i)]},r.hcg.hsv=function(e){var t=e[1]/100,n=t+e[2]/100*(1-t),r=0;return n>0&&(r=t/n),[e[0],100*r,100*n]},r.hcg.hsl=function(e){var t=e[1]/100,n=e[2]/100*(1-t)+.5*t,r=0;return n>0&&n<.5?r=t/(2*n):n>=.5&&n<1&&(r=t/(2*(1-n))),[e[0],100*r,100*n]},r.hcg.hwb=function(e){var t=e[1]/100,n=t+e[2]/100*(1-t);return[e[0],100*(n-t),100*(1-n)]},r.hwb.hcg=function(e){var t=e[1]/100,n=1-e[2]/100,r=n-t,i=0;return r<1&&(i=(n-r)/(1-r)),[e[0],100*r,100*i]},r.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},r.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},r.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},r.gray.hsl=r.gray.hsv=function(e){return[0,0,e[0]]},r.gray.hwb=function(e){return[0,100,e[0]]},r.gray.cmyk=function(e){return[0,0,0,e[0]]},r.gray.lab=function(e){return[e[0],0,0]},r.gray.hex=function(e){var t=255&Math.round(e[0]/100*255),n=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(n.length)+n},r.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}}));jn.rgb,jn.hsl,jn.hsv,jn.hwb,jn.cmyk,jn.xyz,jn.lab,jn.lch,jn.hex,jn.keyword,jn.ansi16,jn.ansi256,jn.hcg,jn.apple,jn.gray;function Sn(e){var t=function(){for(var e={},t=Object.keys(jn),n=t.length,r=0;r<n;r++)e[t[r]]={distance:-1,parent:null};return e}(),n=[e];for(t[e].distance=0;n.length;)for(var r=n.pop(),i=Object.keys(jn[r]),o=i.length,s=0;s<o;s++){var a=i[s],l=t[a];-1===l.distance&&(l.distance=t[r].distance+1,l.parent=r,n.unshift(a))}return t}function _n(e,t){return function(n){return t(e(n))}}function Cn(e,t){for(var n=[t[e].parent,e],r=jn[t[e].parent][e],i=t[e].parent;t[i].parent;)n.unshift(t[i].parent),r=_n(jn[t[i].parent][i],r),i=t[i].parent;return r.conversion=n,r}var An={};Object.keys(jn).forEach(function(e){An[e]={},Object.defineProperty(An[e],"channels",{value:jn[e].channels}),Object.defineProperty(An[e],"labels",{value:jn[e].labels});var t=function(e){for(var t=Sn(e),n={},r=Object.keys(t),i=r.length,o=0;o<i;o++){var s=r[o];null!==t[s].parent&&(n[s]=Cn(s,t))}return n}(e);Object.keys(t).forEach(function(n){var r=t[n];An[e][n]=function(e){var t=function(t){if(null==t)return t;arguments.length>1&&(t=Array.prototype.slice.call(arguments));var n=e(t);if("object"==typeof n)for(var r=n.length,i=0;i<r;i++)n[i]=Math.round(n[i]);return n};return"conversion"in e&&(t.conversion=e.conversion),t}(r),An[e][n].raw=function(e){var t=function(t){return null==t?t:(arguments.length>1&&(t=Array.prototype.slice.call(arguments)),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}(r)})});var zn=An,En=[].slice,On=["keyword","gray","hex"],Rn={};Object.keys(zn).forEach(function(e){Rn[En.call(zn[e].labels).sort().join("")]=e});var Dn={};function Ln(e,t){if(!(this instanceof Ln))return new Ln(e,t);if(t&&t in On&&(t=null),t&&!(t in zn))throw new Error("Unknown model: "+t);var n,r;if(null==e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof Ln)this.model=e.model,this.color=e.color.slice(),this.valpha=e.valpha;else if("string"==typeof e){var i=Nn.get(e);if(null===i)throw new Error("Unable to parse color from string: "+e);this.model=i.model,r=zn[this.model].channels,this.color=i.value.slice(0,r),this.valpha="number"==typeof i.value[r]?i.value[r]:1}else if(e.length){this.model=t||"rgb",r=zn[this.model].channels;var o=En.call(e,0,r);this.color=Fn(o,r),this.valpha="number"==typeof e[r]?e[r]:1}else if("number"==typeof e)e&=16777215,this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;var s=Object.keys(e);"alpha"in e&&(s.splice(s.indexOf("alpha"),1),this.valpha="number"==typeof e.alpha?e.alpha:0);var a=s.sort().join("");if(!(a in Rn))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=Rn[a];var l=zn[this.model].labels,c=[];for(n=0;n<l.length;n++)c.push(e[l[n]]);this.color=Fn(c)}if(Dn[this.model])for(r=zn[this.model].channels,n=0;n<r;n++){var h=Dn[this.model][n];h&&(this.color[n]=h(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function Tn(e,t,n){return(e=Array.isArray(e)?e:[e]).forEach(function(e){(Dn[e]||(Dn[e]=[]))[t]=n}),e=e[0],function(r){var i;return arguments.length?(n&&(r=n(r)),(i=this[e]()).color[t]=r,i):(i=this[e]().color[t],n&&(i=n(i)),i)}}function Un(e){return function(t){return Math.max(0,Math.min(e,t))}}function Fn(e,t){for(var n=0;n<t;n++)"number"!=typeof e[n]&&(e[n]=0);return e}Ln.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(e){var t=this.model in Nn.to?this:this.rgb(),n=1===(t=t.round("number"==typeof e?e:1)).valpha?t.color:t.color.concat(this.valpha);return Nn.to[t.model](n)},percentString:function(e){var t=this.rgb().round("number"==typeof e?e:1),n=1===t.valpha?t.color:t.color.concat(this.valpha);return Nn.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var e={},t=zn[this.model].channels,n=zn[this.model].labels,r=0;r<t;r++)e[n[r]]=this.color[r];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray:function(){var e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject:function(){var e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round:function(e){return e=Math.max(e||0,0),new Ln(this.color.map(function(e){return function(t){return function(e,t){return Number(e.toFixed(t))}(t,e)}}(e)).concat(this.valpha),this.model)},alpha:function(e){return arguments.length?new Ln(this.color.concat(Math.max(0,Math.min(1,e))),this.model):this.valpha},red:Tn("rgb",0,Un(255)),green:Tn("rgb",1,Un(255)),blue:Tn("rgb",2,Un(255)),hue:Tn(["hsl","hsv","hsl","hwb","hcg"],0,function(e){return(e%360+360)%360}),saturationl:Tn("hsl",1,Un(100)),lightness:Tn("hsl",2,Un(100)),saturationv:Tn("hsv",1,Un(100)),value:Tn("hsv",2,Un(100)),chroma:Tn("hcg",1,Un(100)),gray:Tn("hcg",2,Un(100)),white:Tn("hwb",1,Un(100)),wblack:Tn("hwb",2,Un(100)),cyan:Tn("cmyk",0,Un(100)),magenta:Tn("cmyk",1,Un(100)),yellow:Tn("cmyk",2,Un(100)),black:Tn("cmyk",3,Un(100)),x:Tn("xyz",0,Un(100)),y:Tn("xyz",1,Un(100)),z:Tn("xyz",2,Un(100)),l:Tn("lab",0,Un(100)),a:Tn("lab",1),b:Tn("lab",2),keyword:function(e){return arguments.length?new Ln(e):zn[this.model].keyword(this.color)},hex:function(e){return arguments.length?new Ln(e):Nn.to.hex(this.rgb().round().color)},rgbNumber:function(){var e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity:function(){for(var e=this.rgb().color,t=[],n=0;n<e.length;n++){var r=e[n]/255;t[n]=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast:function(e){var t=this.luminosity(),n=e.luminosity();return t>n?(t+.05)/(n+.05):(n+.05)/(t+.05)},level:function(e){var t=this.contrast(e);return t>=7.1?"AAA":t>=4.5?"AA":""},isDark:function(){var e=this.rgb().color;return(299*e[0]+587*e[1]+114*e[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var e=this.rgb(),t=0;t<3;t++)e.color[t]=255-e.color[t];return e},lighten:function(e){var t=this.hsl();return t.color[2]+=t.color[2]*e,t},darken:function(e){var t=this.hsl();return t.color[2]-=t.color[2]*e,t},saturate:function(e){var t=this.hsl();return t.color[1]+=t.color[1]*e,t},desaturate:function(e){var t=this.hsl();return t.color[1]-=t.color[1]*e,t},whiten:function(e){var t=this.hwb();return t.color[1]+=t.color[1]*e,t},blacken:function(e){var t=this.hwb();return t.color[2]+=t.color[2]*e,t},grayscale:function(){var e=this.rgb().color,t=.3*e[0]+.59*e[1]+.11*e[2];return Ln.rgb(t,t,t)},fade:function(e){return this.alpha(this.valpha-this.valpha*e)},opaquer:function(e){return this.alpha(this.valpha+this.valpha*e)},rotate:function(e){var t=this.hsl(),n=t.color[0];return n=(n=(n+e)%360)<0?360+n:n,t.color[0]=n,t},mix:function(e,t){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);var n=e.rgb(),r=this.rgb(),i=void 0===t?.5:t,o=2*i-1,s=n.alpha()-r.alpha(),a=((o*s==-1?o:(o+s)/(1+o*s))+1)/2,l=1-a;return Ln.rgb(a*n.red()+l*r.red(),a*n.green()+l*r.green(),a*n.blue()+l*r.blue(),n.alpha()*i+r.alpha()*(1-i))}},Object.keys(zn).forEach(function(e){if(-1===On.indexOf(e)){var t=zn[e].channels;Ln.prototype[e]=function(){if(this.model===e)return new Ln(this);if(arguments.length)return new Ln(arguments,e);var n,r="number"==typeof arguments[t]?t:this.valpha;return new Ln((n=zn[this.model][e].raw(this.color),Array.isArray(n)?n:[n]).concat(r),e)},Ln[e]=function(n){return"number"==typeof n&&(n=Fn(En.call(arguments),t)),new Ln(n,e)}}});var qn=Ln;function Vn(e,t,n){const r=Object.create(e);return r.labelName=t[n],r.labelIndex=n,r}function Hn(e){var t;let n=e.data.labelNames,r=[];for(let t=0;t<n.length;t+=1)r[t]=Wn(Vn(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=w()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);d(e,t,n)},p(e,i){if(e.selectedLabelIndices||e.getBackgroundColor||e.data){let o;for(n=i.data.labelNames,o=0;o<n.length;o+=1){const s=Vn(i,n,o);r[o]?r[o].p(e,s):(r[o]=Wn(s),r[o].c(),r[o].m(t.parentNode,t))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d(e){m(r,e),e&&f(t)}}}function Wn(e){var t,n,r,i,o,s=e.labelName+"";return{c(){t=p("div"),n=v(s),r=b(),x(t,"class",i="category "+(e.selectedLabelIndices.has(e.labelIndex)?"selected":"")+" svelte-ub142o"),P(t,"background-color",e.getBackgroundColor(e.labelIndex,e.selectedLabelIndices)),o=y(t,"click",e.onCategoryClick(e.labelIndex))},m(e,i){d(e,t,i),u(t,n),u(t,r)},p(r,o){e=o,r.data&&s!==(s=e.labelName+"")&&M(n,s),r.selectedLabelIndices&&i!==(i="category "+(e.selectedLabelIndices.has(e.labelIndex)?"selected":"")+" svelte-ub142o")&&x(t,"class",i),r.selectedLabelIndices&&P(t,"background-color",e.getBackgroundColor(e.labelIndex,e.selectedLabelIndices))},d(e){e&&f(t),o()}}}function Gn(e){var t,n;return{c(){(t=p("div")).innerHTML='<i class="material-icons">3d_rotation</i>',x(t,"class","orbit svelte-ub142o"),n=y(t,"click",e.toggleOrbit)},m(e,n){d(e,t,n)},d(e){e&&f(t),n()}}}function Bn(e){var n,r,i,o,s,a,l,c,h,m=e.isLoaded&&Hn(e),g=!e.isOrbiting&&Gn(e);return{c(){n=p("div"),r=p("div"),i=b(),o=p("div"),s=b(),(a=p("div")).innerHTML='<div class="projection-type-umap svelte-ub142o">UMAP</div> <div class="projection-type-umap svelte-ub142o">t-SNE</div>',l=b(),c=p("div"),m&&m.c(),h=b(),g&&g.c(),x(r,"class","scatter-gl-container umap-container svelte-ub142o"),x(o,"class","scatter-gl-container tsne-container svelte-ub142o"),x(a,"class","projection-types svelte-ub142o"),x(c,"class","categories svelte-ub142o"),x(n,"class","container svelte-ub142o")},m(t,f){d(t,n,f),u(n,r),e.div0_binding(r),u(n,i),u(n,o),e.div1_binding(o),u(n,s),u(n,a),u(n,l),u(n,c),m&&m.m(c,null),u(n,h),g&&g.m(n,null)},p(e,t){t.isLoaded?m?m.p(e,t):((m=Hn(t)).c(),m.m(c,null)):m&&(m.d(1),m=null),t.isOrbiting?g&&(g.d(1),g=null):g||((g=Gn(t)).c(),g.m(n,null))},i:t,o:t,d(t){t&&f(n),e.div0_binding(null),e.div1_binding(null),m&&m.d(),g&&g.d()}}}function Jn(e,t,n){let r,i,o,s,a,l,c,h,u,d=!1,f=new Set,m=!0;const p=e=>{const t=null===e?null:h[e].labelIndex;v(t)(),g()},g=()=>{s.stopOrbitAnimation(),o.stopOrbitAnimation()};window._selectFmnistLabel=((e,t)=>{const n=c.labelNames.findIndex(e=>e.toLowerCase()===t);-1!==n&&v(n)(e)});const v=e=>t=>{if(t&&t.shiftKey?f.add(e):f.has(e)||null===e?f.clear():(f.clear(),f.add(e)),n("selectedLabelIndices",f),0===f.size)return b();[o,s].forEach(e=>{e.setPointColorer(e=>{const t=h[e].labelIndex;return f.has(t)?u[t].string():"white"})})},b=()=>{[o,s].forEach(e=>{e.setPointColorer(e=>{const t=h[e].labelIndex;return u[t].string()})})};return j(async()=>{n("data",c=await Pn()),n("isLoaded",d=!0),h=[];const e=[],t=[];c.umapProjection.forEach((n,r)=>{const i=c.labels[r];e.push([n[2],n[0],n[1]]);const o=c.tsneProjection[r];t.push(o),h.push({labelIndex:i,label:c.labelNames[i]})});const f={dimensions:3,metadata:h,spriteMetadata:{spriteImage:"spritesheet.png",singleSpriteSize:[28,28]}};a={...f,points:e},l={...f,points:t},u=[...new Array(10)].map((e,t)=>{let n=Math.floor(36*t);return new qn({h:n,s:100,l:70})});const v={renderMode:"SPRITE",selectEnabled:!1,onClick:p,onCameraMove:()=>{m&&n("isOrbiting",m=!1),g()}};o=new ScatterGL(r,{...v,camera:{zoom:1.2},onHover:e=>s.setHoverPointIndex(e)}),s=new ScatterGL(i,{...v,camera:{zoom:.9},onHover:e=>o.setHoverPointIndex(e)}),b(),o.render(a),s.render(l)}),{umapContainer:r,tsneContainer:i,data:c,isLoaded:d,selectedLabelIndices:f,isOrbiting:m,onCategoryClick:v,getBackgroundColor:(e,t)=>{const n=t.has(e),r=0===t.size,i=u[e];return n||r?i.string():i.lighten(.35).string()},toggleOrbit:()=>{n("isOrbiting",m=!0),[o,s].forEach(e=>{e.startOrbitAnimation()})},div0_binding:function(e){z[e?"unshift":"push"](()=>{n("umapContainer",r=e)})},div1_binding:function(e){z[e?"unshift":"push"](()=>{n("tsneContainer",i=e)})}}}class Kn extends te{constructor(e){super(),ee(this,e,Jn,Bn,a,[])}}class Xn{constructor(e){e=Math.ceil(e/32),this.backingArray=new Uint32Array(e),this.length=e}get(e){return 0!=(this.backingArray[e/32|0]&1<<e%32)}on(e){this.backingArray[e/32|0]|=1<<e%32}off(e){this.backingArray[e/32|0]&=~(1<<e%32)}toggle(e){this.backingArray[e/32|0]^=1<<e%32}}var Qn=function(e,t,n){const r=new Xn(t*n);for(let t=0;t<e.length;t++){const n=e[t];for(let e=0;e<8;e++){const i=8*t+e;n&2**e&&r.on(i)}}const i=[];for(let e=0;e<t;e++){let t=0;for(let i=0;i<n;i++){const o=e*n+i;r.get(o)&&(t+=2**i)}i.push(t)}return i},Zn=function(e){return Uint8Array.from(e,e=>e.charCodeAt(0))};const Yn=[5,15,30,50,100,200,500,1e3,2e3],er=8,tr=8,nr=10,rr=new Map;async function ir(){const e=await fetch("hyperparameters_encoded.json"),t=await e.json();return t.map((e,t)=>{const n={};return Object.keys(e).forEach(r=>{Object.defineProperty(n,r,{get:function(){const n=`${t}:${r}`;if(rr.has(n))return rr.get(n);const i=e[r],{data:o,length:s,nDimensions:a,ranges:l}=i,c=Zn(atob(o)),h=Qn(c,a*s,er),u=[],[d,f]=l,{min:m,max:p}=d,{min:g,max:v}=f,b=2**er;for(let e=0;e<h.length;e+=2){const t=h[e]/b*(p-m)+m,n=h[e+1]/b*(v-g)+g;u.push([t,n])}return rr.set(n,u),u},enumerable:!0})}),n})}var or=e.randomNormal();function sr(e){for(var t=[],n=0;n<e;n++)t[n]=or();return t}function ar(e,t){for(var n=0;n<e.length;n++)e[n]*=t}function lr(e,t){for(var n=e.length,r=[],i=0;i<n;i++)r[i]=e[i]+t[i];return r}class cr{constructor(e,t){this.coords=e,this.color=t||"#039"}}function hr(t){var n=t.map(function(e){return new cr(e)});return function(t){var n=e.extent(t,function(e){return e.coords[0]}),r=e.extent(t,function(e){return e.coords[1]}),i=e.scaleLinear().domain(n).range([0,255]),o=e.scaleLinear().domain(r).range([0,255]);t.forEach(function(e){var t=~~i(e.coords[0]),n=~~o(e.coords[1]);e.color="rgb(20,"+t+","+n+")"})}(n),n}function ur(e){return"hsl("+~~(300*e/(2*Math.PI))+",50%,50%)"}function dr(e,t){return e.map(e=>e*t)}function fr(e,t){return e.map(e=>{return e+(Math.random()*t-t/2)})}function mr(e,t,n){return e.map((e,r)=>{return(t[r]-e)*n+e})}function pr(e,t){const n=e/2,r=Math.PI/(e/5),i=[];for(let o=0;o<e;o++){const e=[o,Math.sin(r*o)*n];i.push(new cr(e,ur(t)))}return i}const gr=[{name:"Star",description:"Points arranged in a radial star pattern",options:[{name:"Number of points",min:10,max:300,start:100},{name:"Number of arms",min:3,max:20,start:5},{name:"Dimensions",min:3,max:50,start:10}],generator:function(e,t,n){const r=[],i=Math.floor(e/t);for(let e=0;e<t;e++){const o=ur(2*Math.PI*e/t),s=sr(n);for(let e=0;e<i;e++){const t=.01,n=fr(dr(s,e/i),t);r.push(new cr(n,o))}}return r}},{name:"Linked Clusters",description:"Clusters linked with a chain of points",options:[{name:"Number of clusters",min:3,max:20,start:6},{name:"Points per cluster",min:10,max:100,start:30},{name:"Points per link",min:5,max:100,start:15},{name:"Dimensions",min:3,max:100,start:10}],generator:function(e,t,n,r){const i=[],o=[];for(let s=0;s<e;s++){const a=ur(2*Math.PI*s/e),l=sr(r);o.push(l);for(let e=0;e<t;e++){const e=fr(l,.2);i.push(new cr(e,a))}if(s>0){const e=o[s-1];for(let t=0;t<n;t++){const r=mr(l,e,t/n);i.push(new cr(fr(r,.01),"darkgray"))}}}return i}},{name:"Rotated lines",description:"nxn images of a line rotated smoothly around the center, represented as an n*n dimensional vector.",options:[{name:"Number of lines",min:10,max:200,start:50},{name:"Pixels per side",min:5,max:28,start:10}],generator:function(e,t=28){return[]},previewOverride:function(){const e=Array.prototype.slice.apply(arguments).pop(),t=[];for(let n=0;n<e;n++)for(let r=0;r<e;r++){const e=[n,r];t.push(new cr(e,r===n?"aliceblue":"black"))}return t}},{name:"Rotated lines, clustered",description:"nxn images of a line rotated around the center, represented as an n*n dimensional vector. Grouped by similar angles.",options:[{name:"Number of lines",min:10,max:200,start:50},{name:"Number of clusters",min:3,max:12,start:5},{name:"Noise",min:0,max:100,start:8},{name:"Pixels per side",min:5,max:28,start:10}],generator:function(e,t,n=25,r=28){return[]},previewOverride:function(){const e=Array.prototype.slice.apply(arguments).pop(),t=[];for(let n=0;n<e;n++)for(let r=0;r<e;r++){const i=[n,r];t.push(new cr(i,r===e-n?"aliceblue":"black"))}return t}},{name:"Sine frequency",description:"Vectors of a sine wave parameterized by frequency. Hue corresponds to frequency.",options:[{name:"Number of vectors",min:10,max:200,start:50},{name:"Vector size",min:3,max:300,start:100}],generator:function(e,t){const n=Math.PI/(2*t),r=Math.PI/(.1*t),i=[];for(let o=0;o<e;o++){const s=o/e,a=(r-n)*s+n,l=[];for(let e=0;e<t;e++)l.push(Math.sin(a*e));i.push(new cr(l,ur(2*Math.PI*s)))}return i},previewOverride:function(e){return pr(e,0)}},{name:"Sine phase",description:"Vectors of a sine wave parameterized by phase. Hue corresponds to phase.",options:[{name:"Number of vectors",min:10,max:200,start:50},{name:"Vector size",min:3,max:300,start:100}],generator:function(e,t){const n=2*Math.PI/t,r=t/e,i=[];for(let o=0;o<e;o++){const s=o/e,a=r*s,l=[];for(let e=0;e<t;e++)l.push(Math.sin(n*(e+a)));i.push(new cr(l,ur(2*Math.PI*s)))}return i},previewOverride:function(e){return pr(e,Math.PI/2)}}],vr=[{name:"Grid",description:"A square grid with equal spacing between points.",options:[{name:"Points Per Side",min:5,max:20,start:10}],generator:function(e){for(var t=[],n=0;n<e;n++)for(var r=0;r<e;r++)t.push([n,r]);return hr(t)}},{name:"Two Clusters",description:"Two clusters with equal numbers of points.",options:[{name:"Points Per Cluster",min:10,max:100,start:50},{name:"Dimensions",min:1,max:100,start:2}],generator:function(e,t){t=t||50;for(var n=[],r=0;r<e;r++){n.push(new cr(sr(t),"#039"));var i=sr(t);i[0]+=10,n.push(new cr(i,"#f90"))}return n}},{name:"Three Clusters",description:"Three clusters with equal numbers of points, but at different distances from each other.",options:[{name:"Points Per Cluster",min:10,max:100,start:50},{name:"Dimensions",min:1,max:100,start:2}],generator:function(e,t){t=t||50;for(var n=[],r=0;r<e;r++){var i=sr(t);n.push(new cr(i,"#039"));var o=sr(t);o[0]+=10,n.push(new cr(o,"#f90"));var s=sr(t);s[0]+=50,n.push(new cr(s,"#6a3"))}return n}},{name:"Two Different-Sized Clusters",description:"Two clusters with equal numbers of points, but different variances within the clusters.",options:[{name:"Points Per Cluster",min:10,max:100,start:50},{name:"Dimensions",min:1,max:100,start:2},{name:"Scale",min:1,max:10,start:5}],generator:function(e,t,n){t=t||50,n=n||10;for(var r=[],i=0;i<e;i++){r.push(new cr(sr(t),"#039"));for(var o=sr(t),s=0;s<t;s++)o[s]/=n;o[0]+=20,r.push(new cr(o,"#f90"))}return r}},{name:"Two Long Linear Clusters",description:"Two sets of points, arranged in parallel lines that are close to each other. Note curvature of lines.",options:[{name:"Points Per Cluster",min:10,max:100,start:50}],generator:function(e){for(var t=[],n=.03*e,r=0;r<e;r++){var i=r+n*or(),o=r+n*or();t.push(new cr([i,o],"#039"));var s=r+n*or()+e/5,a=r+n*or()-e/5;t.push(new cr([s,a],"#f90"))}return t}},{name:"Cluster In Cluster",description:"A dense, tight cluster inside of a wide, sparse cluster.",options:[{name:"Points Per Cluster",min:10,max:100,start:50},{name:"Dimensions",min:1,max:100,start:2}],generator:function(e,t){t=t||2;for(var n=[],r=0;r<e;r++){var i=sr(t);n.push(new cr(i,"#039"));var o=sr(t);ar(o,50),n.push(new cr(o,"#f90"))}return n}},{name:"Circle (Evenly Spaced)",description:"Points evenly distributed in a circle. Hue corresponds to angle in the circle.",options:[{name:"Number Of Points",min:20,max:100,start:50}],generator:function(e){for(var t=[],n=0;n<e;n++){var r=2*Math.PI*n/e;t.push(new cr([Math.cos(r),Math.sin(r)],ur(r)))}return t}},{name:"Circle (Randomly Spaced)",description:"Points randomly distributed in a circle. Hue corresponds to angle in the circle.",options:[{name:"Number Of Points",min:20,max:100,start:50}],generator:function(e){for(var t=[],n=0;n<e;n++){var r=2*Math.PI*Math.random();t.push(new cr([Math.cos(r),Math.sin(r)],ur(r)))}return t}},{name:"Gaussian Cloud",description:"Points in a unit Gaussian distribution. Data is entirely random, so any visible subclusters are not statistically significant",options:[{name:"Number Of Points",min:20,max:500,start:50},{name:"Dimensions",min:1,max:100,start:2}],generator:function(e,t){for(var n=[],r=0;r<e;r++){var i=sr(t);n.push(new cr(i))}return n}},{name:"Ellipsoidal Gaussian Cloud",description:"Points in an ellipsoidal Gaussian distribution.  Dimension n has variance 1/n. Elongation is visible in plot.",options:[{name:"Number Of Points",min:20,max:500,start:50},{name:"Dimensions",min:1,max:100,start:2}],generator:function(e,t){for(var n=[],r=0;r<e;r++){for(var i=sr(t),o=0;o<t;o++)i[o]/=1+o;n.push(new cr(i))}return n}},{name:"Trefoil Knot",description:"Points arranged in 3D, following a trefoil knot. Different runs may give different results.",options:[{name:"Number Of Points",min:20,max:200,start:50}],generator:function(e){for(var t=[],n=0;n<e;n++){var r=2*Math.PI*n/e,i=Math.sin(r)+2*Math.sin(2*r),o=Math.cos(r)-2*Math.cos(2*r),s=-Math.sin(3*r);t.push(new cr([i,o,s],ur(r)))}return t}},{name:"Linked Rings",description:"Points arranged in 3D, on two linked circles. ",options:[{name:"Number Of Points",min:20,max:200,start:50}],generator:function(e){var t=[];function n(e,t,n){var r=e,i=Math.cos(.4),o=Math.sin(.4);return[r,i*t+o*n,-o*t+i*n]}for(var r=0;r<e;r++){var i=2*Math.PI*r/e,o=Math.sin(i),s=Math.cos(i);t.push(new cr(n(s,o,0),"#f90")),t.push(new cr(n(1+s,0,o),"#039"))}return t}},{name:"Unlinked Rings",description:"Points arranged in 3D, on two unlinked circles",options:[{name:"Number Of Points",min:20,max:200,start:50}],generator:function(e){var t=[];function n(e,t,n){var r=e,i=Math.cos(.4),o=Math.sin(.4);return[r,i*t+o*n,-o*t+i*n]}for(var r=0;r<e;r++){var i=2*Math.PI*r/e,o=Math.sin(i),s=Math.cos(i);t.push(new cr(n(s,o,0),"#f90")),t.push(new cr(n(3+s,0,o),"#039"))}return t}},{name:"Orthogonal Steps",description:"Points related by mutually orthogonal steps. Very similar to a random walk.",options:[{name:"Number Of Points",min:20,max:500,start:50}],generator:function(e){for(var t=[],n=0;n<e;n++){for(var r=[],i=0;i<e;i++)r[i]=i<n?1:0;var o=1.5*Math.PI*n/e;t.push(new cr(r,ur(o)))}return t}},{name:"Random Walk",description:"Random (Gaussian) walk. Smoother than you might think.",options:[{name:"Number Of Points",min:20,max:1e3,start:100},{name:"Dimension",min:1,max:1e3,start:100}],generator:function(e,t){for(var n=[],r=[],i=0;i<t;i++)r[i]=0;for(i=0;i<e;i++){for(var o=sr(t),s=r.slice(),a=0;a<t;a++)s[a]=r[a]+o[a];var l=1.5*Math.PI*i/e;n.push(new cr(s,ur(l))),r=s}return n}},{name:"Random Jump",description:"Random (Gaussian) Jump",options:[{name:"Number Of Points",min:20,max:1e3,start:100},{name:"Dimension",min:1,max:1e3,start:100}],generator:function(e,t){for(var n=[],r=[],i=0;i<t;i++)r[i]=0;for(i=0;i<e;i++){var o=lr(sr(t),r.slice()),s=sr(t);ar(s,Math.sqrt(t));var a=1.5*Math.PI*i/e,l=lr(s,o);n.push(new cr(l,ur(a))),r=o}return n}},{name:"Equally Spaced",description:"A set of points, where distances between all pairs of points are the same in the original space.",options:[{name:"Number Of Points",min:20,max:100,start:50}],generator:function(e,t){t=t||.5;for(var n=[],r=0;r<e;r++){for(var i=[],o=0;o<e;o++)i[o]=r==o?1+t*or():0;n.push(new cr(i))}return n}},{name:"Uniform Distribution",description:"Points uniformly distributed in a unit cube.",options:[{name:"Number Of Points",min:20,max:200,start:50},{name:"Dimensions",min:1,max:10,start:3}],generator:function(e,t){for(var n=[],r=0;r<e;r++){for(var i=[],o=0;o<t;o++)i[o]=Math.random();n.push(new cr(i))}return n}}],br=[...gr,...vr],wr=[{name:"Star",options:[{name:"Number of points",start:300},{name:"Number of arms",start:12},{name:"Dimensions",start:10}]},{name:"Linked Clusters",options:[{name:"Number of clusters",start:6},{name:"Points per cluster",start:100},{name:"Points per link",start:50},{name:"Dimensions",start:10}]},{name:"Rotated lines",options:[{name:"Number of lines",start:200},{name:"Pixels per side",start:28}]},{name:"Rotated lines, clustered",options:[{name:"Number of lines",start:200},{name:"Number of clusters",start:10},{name:"Noise",start:8},{name:"Pixels per side",start:28}]},{name:"Sine frequency",options:[{name:"Number of vectors",start:200},{name:"Vector size",start:256}]},{name:"Sine phase",options:[{name:"Number of vectors",start:200},{name:"Vector size",start:256}]},{name:"Grid",options:[{name:"Points Per Side",start:20}],description:"A square grid with equal spacing between points."},{name:"Two Clusters",options:[{name:"Points Per Cluster",start:100},{name:"Dimensions",start:50}]},{name:"Three Clusters",options:[{name:"Points Per Cluster",start:100},{name:"Dimensions",start:50}]},{name:"Two Different-Sized Clusters",options:[{name:"Points Per Cluster",start:100},{name:"Dimensions",start:50},{name:"Scale",start:5}]},{name:"Two Long Linear Clusters",options:[{name:"Points Per Cluster",start:100}]},{name:"Cluster In Cluster",options:[{name:"Points Per Cluster",start:100},{name:"Dimensions",start:50}]},{name:"Circle (Evenly Spaced)",options:[{name:"Number Of Points",start:200}]},{name:"Circle (Randomly Spaced)",options:[{name:"Number Of Points",start:200}]},{name:"Gaussian Cloud",options:[{name:"Number Of Points",start:250},{name:"Dimensions",start:50}]},{name:"Ellipsoidal Gaussian Cloud",options:[{name:"Number Of Points",start:250},{name:"Dimensions",start:50}]},{name:"Trefoil Knot",options:[{name:"Number Of Points",start:200}]},{name:"Linked Rings",options:[{name:"Number Of Points",start:200}]},{name:"Unlinked Rings",options:[{name:"Number Of Points",start:200}]},{name:"Orthogonal Steps",options:[{name:"Number Of Points",start:200}]},{name:"Random Walk",options:[{name:"Number Of Points",start:200},{name:"Dimension",start:100}]},{name:"Random Jump",options:[{name:"Number Of Points",start:200},{name:"Dimension",start:100}]},{name:"Equally Spaced",options:[{name:"Number Of Points",start:200}]},{name:"Uniform Distribution",options:[{name:"Number Of Points",start:200},{name:"Dimensions",start:10}]}],yr=[...gr,...vr].map((e,t)=>{const n=JSON.parse(JSON.stringify(e));return n.generator=e.generator,n.previewOverride=e.previewOverride,n.options=n.options.map((e,n)=>{const r=wr[t];return e.start=r.options[n].start,r.description&&(e.description=r.description),e}),n});function xr(e,t){return t||(t=e.options.map(e=>e.start)),e.generator.apply(null,t)}function Mr(e,t){return t||(t=e.options.map(e=>e.start)),e.previewOverride?e.previewOverride.apply(null,t):null}function $r(e,t,n,r){e.beginPath(),e.arc(t,n,r,0,2*Math.PI),e.fill(),e.stroke()}function Pr(e,t,n,r){var i=t.width,o=t.height,s=t.getContext("2d");s.fillStyle="white",s.fillRect(0,0,i,o);var a=d3.extent(e,function(e){return e.coords[0]}),l=d3.extent(e,function(e){return e.coords[1]}),c=d3.extent(e,function(e){return e.coords[2]}),h=d3.scaleLinear().domain(c).range([2,10]),u=(a[0]+a[1])/2,d=(l[0]+l[1])/2,f=Math.min(i,o)/Math.max(a[1]-a[0],l[1]-l[0]);f*=.9,s.strokeStyle="rgba(255,255,255,.5)";var m=!r&&e[0].coords.length>2,p=[],g=e.length;if(m){for(var v=0;v<g;v++)p[v]=v;p.sort(function(t,n){return d3.ascending(e[t].coords[2],e[n].coords[2])})}for(v=0;v<g;v++){var b=m?e[p[v]]:e[v];s.fillStyle=b.color;var w=(b.coords[0]-u)*f+i/2,y=-(b.coords[1]-d)*f+o/2;$r(s,w,y,m?h(b.coords[2]):4),m||(b.px=w,b.py=y)}n&&(s.fillStyle="#000",s.font="24pt Lato",s.fillText(n,8,34))}function kr(e){var t,n,r,i;return{c(){x(t=g("circle"),"r","5"),x(t,"fill","none"),x(t,"stroke","#000"),x(t,"stroke-width","2"),x(t,"opacity",n=e.hoveredPointIndex>-1?1:0),x(t,"cx",r=e.points[e.hoveredPointIndex].px),x(t,"cy",i=e.points[e.hoveredPointIndex].py)},m(e,n){d(e,t,n)},p(e,o){e.hoveredPointIndex&&n!==(n=o.hoveredPointIndex>-1?1:0)&&x(t,"opacity",n),(e.points||e.hoveredPointIndex)&&r!==(r=o.points[o.hoveredPointIndex].px)&&x(t,"cx",r),(e.points||e.hoveredPointIndex)&&i!==(i=o.points[o.hoveredPointIndex].py)&&x(t,"cy",i)},d(e){e&&f(t)}}}function Ir(e){var n,r,i,s,a,l,c,h=e.points[e.hoveredPointIndex]&&e.points[e.hoveredPointIndex].px&&kr(e);return{c(){n=p("div"),r=p("canvas"),i=b(),s=g("svg"),h&&h.c(),x(r,"width",e.size),x(r,"height",e.size),x(r,"class","svelte-1i02yig"),x(s,"viewBox",a="0 0 "+e.size+" "+e.size),x(s,"class","svelte-1i02yig"),x(n,"class",l="demo-data "+(e.selected?"selected":"")+"\n  "+(e.highlighted?"highlighted":"")+"\n  "+(e.selectable?"":"non-selectable")+" svelte-1i02yig"),c=[y(r,"mousemove",e.handleMousemove),y(n,"click",e.onClick)]},m(t,o){d(t,n,o),u(n,r),e.canvas_1_binding(r),u(n,i),u(n,s),h&&h.m(s,null),e.svg_1_binding(s)},p(e,t){e.size&&(x(r,"width",t.size),x(r,"height",t.size)),t.points[t.hoveredPointIndex]&&t.points[t.hoveredPointIndex].px?h?h.p(e,t):((h=kr(t)).c(),h.m(s,null)):h&&(h.d(1),h=null),e.size&&a!==(a="0 0 "+t.size+" "+t.size)&&x(s,"viewBox",a),(e.selected||e.highlighted||e.selectable)&&l!==(l="demo-data "+(t.selected?"selected":"")+"\n  "+(t.highlighted?"highlighted":"")+"\n  "+(t.selectable?"":"non-selectable")+" svelte-1i02yig")&&x(n,"class",l)},i:t,o:t,d(t){t&&f(n),e.canvas_1_binding(null),h&&h.d(),e.svg_1_binding(null),o(c)}}}function Nr(e,t,n){const r=_();let i,o,{points:s,onClick:a,selected:l,hoveredPointIndex:c=-1,selectable:h=!0,highlighted:u=!1,size:d=150}=t;j(()=>{Pr(s,i,null,null)});let f=null;return S(()=>{s!=f&&(f=s,Pr(s,i,null,null))}),e.$set=(e=>{"points"in e&&n("points",s=e.points),"onClick"in e&&n("onClick",a=e.onClick),"selected"in e&&n("selected",l=e.selected),"hoveredPointIndex"in e&&n("hoveredPointIndex",c=e.hoveredPointIndex),"selectable"in e&&n("selectable",h=e.selectable),"highlighted"in e&&n("highlighted",u=e.highlighted),"size"in e&&n("size",d=e.size)}),{points:s,onClick:a,selected:l,hoveredPointIndex:c,selectable:h,highlighted:u,size:d,handleMousemove:function(){var e=d/i.offsetWidth,t=event.layerX*e,n=event.layerY*e;if(s||!s.length){var o=1/0,a=0;s.forEach((e,r)=>{var i=e.px-t,s=e.py-n,l=i*i+s*s;l<o&&(o=l,a=r)}),r("hover",a)}},canvas:i,svg:o,canvas_1_binding:function(e){z[e?"unshift":"push"](()=>{n("canvas",i=e)})},svg_1_binding:function(e){z[e?"unshift":"push"](()=>{n("svg",o=e)})}}}class jr extends te{constructor(e){super(),ee(this,e,Nr,Ir,a,["points","onClick","selected","hoveredPointIndex","selectable","highlighted","size"])}}var Sr=pe(function(e,t){var n=fe&&fe.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};function r(e,t){return Math.floor(t()*e)}function i(e){for(var t=[],n=0;n<e;n++)t.push(void 0);return t}function o(e,t){return i(e).map(function(){return t})}function s(e){return o(e,0)}function a(e){return e.reduce(function(e,t){return e+t})}Object.defineProperty(t,"__esModule",{value:!0}),t.tauRandInt=r,t.tauRand=function(e){return e()},t.norm=function(e){var t,r,i=0;try{for(var o=n(e),s=o.next();!s.done;s=o.next()){var a=s.value;i+=Math.pow(a,2)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return Math.sqrt(i)},t.empty=i,t.range=function(e){return i(e).map(function(e,t){return t})},t.filled=o,t.zeros=s,t.ones=function(e){return o(e,1)},t.linear=function(e,t,n){return i(n).map(function(r,i){return e+i*((t-e)/(n-1))})},t.sum=a,t.mean=function(e){return a(e)/e.length},t.max=function(e){for(var t=0,n=0;n<e.length;n++)t=e[n]>t?e[n]:t;return t},t.max2d=function(e){for(var t=0,n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++)t=e[n][r]>t?e[n][r]:t;return t},t.rejectionSample=function(e,t,n){for(var i=s(e),o=0;o<e;o++)for(var a=!0;a;){for(var l=r(t,n),c=!1,h=0;h<o;h++)if(l===i[h]){c=!0;break}c||(a=!1),i[o]=l}return i},t.reshape2d=function(e,t,n){var r=[],i=0;if(e.length!==t*n)throw new Error("Array dimensions must match input length.");for(var o=0;o<t;o++){for(var s=[],a=0;a<n;a++)s.push(e[i]),i+=1;r.push(s)}return r}});me(Sr);Sr.tauRandInt,Sr.tauRand,Sr.norm,Sr.empty,Sr.range,Sr.filled,Sr.zeros,Sr.ones,Sr.linear,Sr.sum,Sr.mean,Sr.max,Sr.max2d,Sr.rejectionSample,Sr.reshape2d;var _r=pe(function(e,t){var n=fe&&fe.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var r=n(Sr);function i(e,t){var n=function(n){return r.empty(e).map(function(){return r.filled(t,n)})},i=[];return i.push(n(-1)),i.push(n(1/0)),i.push(n(0)),i}function o(e,t,n,r,i){t=Math.floor(t);var o=e[0][t],a=e[1][t];e[2][t];if(n>=a[0])return 0;for(var l=0;l<o.length;l++)if(r===o[l])return 0;return s(e,t,n,r,i)}function s(e,t,n,r,i){var o=e[0][t],s=e[1][t],a=e[2][t];if(n>=s[0])return 0;s[0]=n,o[0]=r,a[0]=i;for(var l=0,c=0;;){var h=2*l+1,u=h+1,d=e[0][0].length;if(h>=d)break;if(u>=d){if(!(s[h]>n))break;c=h}else if(s[h]>=s[u]){if(!(n<s[h]))break;c=h}else{if(!(n<s[u]))break;c=u}s[l]=s[c],o[l]=o[c],a[l]=a[c],l=c}return s[l]=n,o[l]=r,a[l]=i,1}function a(e,t,n,r){for(;2*r+1<n;){var i=2*r+1,o=i+1,s=r;if(e[s]<e[i]&&(s=i),o<n&&e[s]<e[o]&&(s=o),s===r)break;var a=e[r];e[r]=e[s],e[s]=a;var l=t[r];t[r]=t[s],t[s]=l,r=s}}t.makeHeap=i,t.rejectionSample=function(e,t,n){for(var i=r.zeros(e),o=0;o<e;o++){for(var s=!0,a=0;s;){a=r.tauRandInt(t,n);for(var l=!1,c=0;c<o;c++)if(a===i[c]){l=!0;break}l||(s=!1)}i[o]=a}return i},t.heapPush=o,t.uncheckedHeapPush=s,t.buildCandidates=function(e,t,n,s,a){for(var l=i(t,s),c=0;c<t;c++)for(var h=0;h<n;h++)if(!(e[0][c][h]<0)){var u=e[0][c][h],d=e[2][c][h],f=r.tauRand(a);o(l,c,f,u,d),o(l,u,f,c,d),e[2][c][h]=0}return l},t.deheapSort=function(e){for(var t=e[0],n=e[1],r=0;r<t.length;r++)for(var i=t[r],o=n[r],s=0;s<i.length-1;s++){var l=i.length-s-1,c=o.length-s-1,h=i[0];i[0]=i[l],i[l]=h;var u=o[0];o[0]=o[c],o[c]=u,a(o,i,c,0)}return{indices:t,weights:n}},t.smallestFlagged=function(e,t){for(var n=e[0][t],r=e[1][t],i=e[2][t],o=1/0,s=-1,a=0;a>n.length;a++)1===i[a]&&r[a]<o&&(o=r[a],s=a);return s>=0?(i[s]=0,Math.floor(n[s])):-1}});me(_r);_r.makeHeap,_r.rejectionSample,_r.heapPush,_r.uncheckedHeapPush,_r.buildCandidates,_r.deheapSort,_r.smallestFlagged;var Cr=pe(function(e,t){var n,r=fe&&fe.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},i=fe&&fe.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},o=fe&&fe.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},s=fe&&fe.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var a=s(Sr),l=function(){function e(e,t,n,r){this.entries=new Map,this.nRows=0,this.nCols=0,this.rows=i(e),this.cols=i(t),this.values=i(n);for(var o=0;o<n.length;o++){var s=this.makeKey(this.rows[o],this.cols[o]);this.entries.set(s,o)}this.nRows=r[0],this.nCols=r[1]}return e.prototype.makeKey=function(e,t){return e+":"+t},e.prototype.checkDims=function(e,t){if(!(e<this.nRows&&t<this.nCols))throw new Error("array index out of bounds")},e.prototype.set=function(e,t,n){this.checkDims(e,t);var r=this.makeKey(e,t);if(this.entries.has(r)){var i=this.entries.get(r);this.values[i]=n}else this.rows.push(e),this.cols.push(t),this.values.push(n),this.entries.set(r,this.values.length-1)},e.prototype.get=function(e,t,n){void 0===n&&(n=0),this.checkDims(e,t);var r=this.makeKey(e,t);if(this.entries.has(r)){var i=this.entries.get(r);return this.values[i]}return n},e.prototype.getDims=function(){return[this.nRows,this.nCols]},e.prototype.getRows=function(){return i(this.rows)},e.prototype.getCols=function(){return i(this.cols)},e.prototype.getValues=function(){return i(this.values)},e.prototype.forEach=function(e){for(var t=0;t<this.values.length;t++)e(this.values[t],this.rows[t],this.cols[t])},e.prototype.map=function(t){for(var n=[],r=0;r<this.values.length;r++)n.push(t(this.values[r],this.rows[r],this.cols[r]));var i=[this.nRows,this.nCols];return new e(this.rows,this.cols,n,i)},e.prototype.toArray=function(){for(var e=this,t=a.empty(this.nRows).map(function(){return a.zeros(e.nCols)}),n=0;n<this.values.length;n++)t[this.rows[n]][this.cols[n]]=this.values[n];return t},e}();t.SparseMatrix=l,t.transpose=function(e){var t=[],n=[],r=[];e.forEach(function(e,i,o){t.push(i),n.push(o),r.push(e)});var i=[e.nCols,e.nRows];return new l(n,t,r,i)},t.identity=function(e){for(var t=r(e,1)[0],n=new l([],[],[],e),i=0;i<t;i++)n.set(i,i,1);return n},t.pairwiseMultiply=function(e,t){return h(e,t,function(e,t){return e*t})},t.add=function(e,t){return h(e,t,function(e,t){return e+t})},t.subtract=function(e,t){return h(e,t,function(e,t){return e-t})},t.maximum=function(e,t){return h(e,t,function(e,t){return e>t?e:t})},t.multiplyScalar=function(e,t){return e.map(function(e){return e*t})},t.eliminateZeros=function(e){for(var t=new Set,n=e.getValues(),r=e.getRows(),i=e.getCols(),o=0;o<n.length;o++)0===n[o]&&t.add(o);var s=function(e,n){return!t.has(n)},a=n.filter(s),c=r.filter(s),h=i.filter(s);return new l(c,h,a,e.getDims())},t.normalize=function(e,t){var n,r;void 0===t&&(t="l2");var i=c[t],s=new Map;e.forEach(function(e,t,n){var r=s.get(t)||[];r.push(n),s.set(t,r)});var a=new l([],[],[],e.getDims()),h=function(t){for(var n=s.get(t).sort(),r=n.map(function(n){return e.get(t,n)}),o=i(r),l=0;l<o.length;l++)a.set(t,n[l],o[l])};try{for(var u=o(s.keys()),d=u.next();!d.done;d=u.next())h(d.value)}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}return a};var c=((n={}).max=function(e){for(var t=-1/0,n=0;n<e.length;n++)t=e[n]>t?e[n]:t;return e.map(function(e){return e/t})},n.l1=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return e.map(function(e){return e/t})},n.l2=function(e){for(var t=0,n=0;n<e.length;n++)t+=Math.pow(e[n],2);return e.map(function(e){return Math.sqrt(Math.pow(e,2)/t)})},n);function h(e,t,n){for(var r=new Set,i=[],o=[],s=[],a=function(r,a){i.push(r),o.push(a);var l=n(e.get(r,a),t.get(r,a));s.push(l)},c=e.getValues(),h=e.getRows(),u=e.getCols(),d=0;d<c.length;d++){var f=(v=h[d])+":"+(b=u[d]);r.add(f),a(v,b)}var m=t.getValues(),p=t.getRows(),g=t.getCols();for(d=0;d<m.length;d++){var v,b;f=(v=p[d])+":"+(b=g[d]);r.has(f)||a(v,b)}var w=[e.nRows,e.nCols];return new l(i,o,s,w)}t.getCSR=function(e){var t=[];e.forEach(function(e,n,r){t.push({value:e,row:n,col:r})}),t.sort(function(e,t){return e.row===t.row?e.col-t.col:e.row-t.col});for(var n=[],r=[],i=[],o=-1,s=0;s<t.length;s++){var a=t[s],l=a.row,c=a.col,h=a.value;l!==o&&(o=l,i.push(s)),n.push(c),r.push(h)}return{indices:n,values:r,indptr:i}}});me(Cr);Cr.SparseMatrix,Cr.transpose,Cr.identity,Cr.pairwiseMultiply,Cr.add,Cr.subtract,Cr.maximum,Cr.multiplyScalar,Cr.eliminateZeros,Cr.normalize,Cr.getCSR;var Ar=pe(function(e,t){var n=fe&&fe.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},r=fe&&fe.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e},i=fe&&fe.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},o=fe&&fe.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var s=o(Sr),a=function(){return function(e,t,n,r){this.hyperplanes=e,this.offsets=t,this.children=n,this.indices=r}}();function l(e,t,n,r){for(var i=t,o=0;o<n.length;o++)i+=e[o]*n[o];return 0===i?s.tauRandInt(2,r):i>0?0:1}t.FlatTree=a,t.makeForest=function(e,t,n,i){var o=Math.max(10,t);return s.range(n).map(function(t,n){return function(e,t,n,r){void 0===t&&(t=30);var i=s.range(e.length);return function e(t,n,r,i,o){if(void 0===r&&(r=30),n.length>r){var a=function(e,t,n){var r=e[0].length,i=s.tauRandInt(t.length,n),o=s.tauRandInt(t.length,n);o=(o+=i===o?1:0)%t.length;for(var a=t[i],l=t[o],c=0,h=s.zeros(r),u=0;u<h.length;u++)h[u]=e[a][u]-e[l][u],c-=h[u]*(e[a][u]+e[l][u])/2;for(var d=0,f=0,m=s.zeros(t.length),u=0;u<t.length;u++){for(var p=c,g=0;g<r;g++)p+=h[g]*e[t[u]][g];0===p?(m[u]=s.tauRandInt(2,n),0===m[u]?d+=1:f+=1):p>0?(m[u]=0,d+=1):(m[u]=1,f+=1)}var v=s.zeros(d),b=s.zeros(f);for(var u in d=0,f=0,s.range(m.length))0===m[u]?(v[d]=t[u],d+=1):(b[f]=t[u],f+=1);return{indicesLeft:v,indicesRight:b,hyperplane:h,offset:c}}(t,n,o),l=a.indicesLeft,c=a.indicesRight,h=a.hyperplane,u=a.offset,d=e(t,l,r,i+1,o),f=e(t,c,r,i+1,o),m={leftChild:d,rightChild:f,isLeaf:!1,hyperplane:h,offset:u};return m}var m={indices:n,isLeaf:!0};return m}(e,i,t,n,r)}(e,o,n,i)}).map(function(e){return function(e,t){var n=function e(t){return t.isLeaf?1:1+e(t.leftChild)+e(t.rightChild)}(e),i=function e(t){return t.isLeaf?1:e(t.leftChild)+e(t.rightChild)}(e),o=s.range(n).map(function(){return s.zeros(e.hyperplane.length)}),l=s.zeros(n),c=s.range(n).map(function(){return[-1,-1]}),h=s.range(i).map(function(){return s.range(t).map(function(){return-1})});return function e(t,n,i,o,s,a,l){var c;if(t.isLeaf)return o[a][0]=-l,(c=s[l]).splice.apply(c,r([0,t.indices.length],t.indices)),{nodeNum:a,leafNum:l+=1};n[a]=t.hyperplane,i[a]=t.offset,o[a][0]=a+1;var h=a,u=e(t.leftChild,n,i,o,s,a+1,l);return a=u.nodeNum,l=u.leafNum,o[h][1]=a+1,{nodeNum:(u=e(t.rightChild,n,i,o,s,a+1,l)).nodeNum,leafNum:u.leafNum}}(e,o,l,c,h,0,0),new a(o,l,c,h)}(e,o)})},t.makeLeafArray=function(e){var t,n;if(e.length>0){var o=[];try{for(var s=i(e),a=s.next();!a.done;a=s.next()){var l=a.value;o.push.apply(o,r(l.indices))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return o}return[[-1]]},t.searchFlatTree=function(e,t,n){for(var r=0;t.children[r][0]>0;)r=0===l(t.hyperplanes[r],t.offsets[r],e,n)?t.children[r][0]:t.children[r][1];var i=-1*t.children[r][0];return t.indices[i]}});me(Ar);Ar.FlatTree,Ar.makeForest,Ar.makeLeafArray,Ar.searchFlatTree;var zr=pe(function(e,t){var n=fe&&fe.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},r=fe&&fe.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i=r(_r),o=r(Cr),s=r(Ar),a=r(Sr);t.makeNNDescent=function(e,t){return function(n,r,o,s,l,c,h,u){void 0===s&&(s=10),void 0===l&&(l=50),void 0===c&&(c=.001),void 0===h&&(h=.5),void 0===u&&(u=!0);for(var d=n.length,f=i.makeHeap(n.length,o),m=0;m<n.length;m++)for(var p=i.rejectionSample(o,n.length,t),g=0;g<p.length;g++){var v=e(n[m],n[p[g]]);i.heapPush(f,m,v,p[g],1),i.heapPush(f,p[g],v,m,1)}if(u)for(var b=0;b<r.length;b++)for(m=0;m<r[b].length&&!(r[b][m]<0);m++)for(g=m+1;g<r[b].length&&!(r[b][g]<0);g++)v=e(n[r[b][m]],n[r[b][g]]),i.heapPush(f,r[b][m],v,r[b][g],1),i.heapPush(f,r[b][g],v,r[b][m],1);for(b=0;b<s;b++){var w=i.buildCandidates(f,d,o,l,t),y=0;for(m=0;m<d;m++)for(g=0;g<l;g++){var x=Math.floor(w[0][m][g]);if(!(x<0||a.tauRand(t)<h))for(var M=0;M<l;M++){var $=Math.floor(w[0][m][M]),P=w[2][m][g],k=w[2][m][M];$<0||!P&&!k||(v=e(n[x],n[$]),y+=i.heapPush(f,x,v,$,1),y+=i.heapPush(f,$,v,x,1))}}if(y<=c*o*n.length)break}return i.deheapSort(f)}},t.makeInitializations=function(e){return{initFromRandom:function(t,n,r,o,s){for(var l=0;l<r.length;l++)for(var c=a.rejectionSample(t,n.length,s),h=0;h<c.length;h++)if(!(c[h]<0)){var u=e(n[c[h]],r[l]);i.heapPush(o,l,u,c[h],1)}},initFromTree:function(t,n,r,o,a){for(var l=0;l<r.length;l++)for(var c=s.searchFlatTree(r[l],t,a),h=0;h<c.length;h++){if(c[h]<0)return;var u=e(n[c[h]],r[l]);i.heapPush(o,l,u,c[h],1)}}}},t.makeInitializedNNSearch=function(e){return function(t,r,s,a){for(var l,c,h=o.getCSR(r),u=h.indices,d=h.indptr,f=0;f<a.length;f++)for(var m=new Set(s[0][f]);;){var p=i.smallestFlagged(s,f);if(-1===p)break;var g=u.slice(d[p],d[p+1]);try{for(var v=n(g),b=v.next();!b.done;b=v.next()){var w=b.value;if(w!==p&&-1!==w&&!m.has(w)){var y=e(t[w],a[f]);i.uncheckedHeapPush(s,f,y,w,1),m.add(w)}}}catch(e){l={error:e}}finally{try{b&&!b.done&&(c=v.return)&&c.call(v)}finally{if(l)throw l.error}}}return s}},t.initializeSearch=function(e,t,r,o,s,a,l){var c,h,u=i.makeHeap(r.length,o);if(s(o,t,r,u,l),e)try{for(var d=n(e),f=d.next();!f.done;f=d.next())a(f.value,t,r,u,l)}catch(e){c={error:e}}finally{try{f&&!f.done&&(h=d.return)&&h.call(d)}finally{if(c)throw c.error}}return u}});me(zr);zr.makeNNDescent,zr.makeInitializations,zr.makeInitializedNNSearch,zr.initializeSearch;function Er(e,t,n){var r=0;const i=n(t);for(var o=0;o<e.x.length;o++)r+=Math.abs(e.y[o]-i(e.x[o]));return r}const Or=Object.prototype.toString;var Rr=function(e){return Or.call(e).endsWith("Array]")};function Dr(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Rr(e))throw new TypeError("input must be an array");if(0===e.length)throw new TypeError("input must not be empty");if(void 0!==n.output){if(!Rr(n.output))throw new TypeError("output option must be an array if specified");t=n.output}else t=new Array(e.length);var r=function(e){if(!Rr(e))throw new TypeError("input must be an array");if(0===e.length)throw new TypeError("input must not be empty");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t}(e),i=function(e){if(!Rr(e))throw new TypeError("input must be an array");if(0===e.length)throw new TypeError("input must not be empty");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t}(e);if(r===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var o=n.min,s=void 0===o?n.autoMinMax?r:0:o,a=n.max,l=void 0===a?n.autoMinMax?i:1:a;if(s>=l)throw new RangeError("min option must be smaller than max option");for(var c=(l-s)/(i-r),h=0;h<e.length;h++)t[h]=(e[h]-r)*c+s;return t}class Lr{constructor(e){var t,n,r,i,o,s,a,l,c,h=(e=ui.checkMatrix(e)).clone(),u=h.rows,d=h.columns,f=new Array(u),m=1;for(t=0;t<u;t++)f[t]=t;for(l=new Array(u),n=0;n<d;n++){for(t=0;t<u;t++)l[t]=h.get(t,n);for(t=0;t<u;t++){for(c=Math.min(t,n),o=0,r=0;r<c;r++)o+=h.get(t,r)*l[r];l[t]-=o,h.set(t,n,l[t])}for(i=n,t=n+1;t<u;t++)Math.abs(l[t])>Math.abs(l[i])&&(i=t);if(i!==n){for(r=0;r<d;r++)s=h.get(i,r),h.set(i,r,h.get(n,r)),h.set(n,r,s);a=f[i],f[i]=f[n],f[n]=a,m=-m}if(n<u&&0!==h.get(n,n))for(t=n+1;t<u;t++)h.set(t,n,h.get(t,n)/h.get(n,n))}this.LU=h,this.pivotVector=f,this.pivotSign=m}isSingular(){for(var e=this.LU,t=e.columns,n=0;n<t;n++)if(0===e[n][n])return!0;return!1}solve(e){e=hi.checkMatrix(e);var t=this.LU;if(t.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");var n,r,i,o=e.columns,s=e.subMatrixRow(this.pivotVector,0,o-1),a=t.columns;for(i=0;i<a;i++)for(n=i+1;n<a;n++)for(r=0;r<o;r++)s[n][r]-=s[i][r]*t[n][i];for(i=a-1;i>=0;i--){for(r=0;r<o;r++)s[i][r]/=t[i][i];for(n=0;n<i;n++)for(r=0;r<o;r++)s[n][r]-=s[i][r]*t[n][i]}return s}get determinant(){var e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");for(var t=this.pivotSign,n=e.columns,r=0;r<n;r++)t*=e[r][r];return t}get lowerTriangularMatrix(){for(var e=this.LU,t=e.rows,n=e.columns,r=new hi(t,n),i=0;i<t;i++)for(var o=0;o<n;o++)r[i][o]=i>o?e[i][o]:i===o?1:0;return r}get upperTriangularMatrix(){for(var e=this.LU,t=e.rows,n=e.columns,r=new hi(t,n),i=0;i<t;i++)for(var o=0;o<n;o++)r[i][o]=i<=o?e[i][o]:0;return r}get pivotPermutationVector(){return this.pivotVector.slice()}}function Tr(e,t){var n=0;return Math.abs(e)>Math.abs(t)?(n=t/e,Math.abs(e)*Math.sqrt(1+n*n)):0!==t?(n=e/t,Math.abs(t)*Math.sqrt(1+n*n)):0}function Ur(e,t,n){for(var r=new Array(e),i=0;i<e;i++){r[i]=new Array(t);for(var o=0;o<t;o++)r[i][o]=n}return r}class Fr{constructor(e,t={}){var n=(e=ui.checkMatrix(e)).rows,r=e.columns;const{computeLeftSingularVectors:i=!0,computeRightSingularVectors:o=!0,autoTranspose:s=!1}=t;var a,l=Boolean(i),c=Boolean(o),h=!1;if(n<r)if(s){n=(a=e.transpose()).rows,r=a.columns,h=!0;var u=l;l=c,c=u}else a=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else a=e.clone();var d=Math.min(n,r),f=Math.min(n+1,r),m=new Array(f),p=Ur(n,d,0),g=Ur(r,r,0),v=new Array(r),b=new Array(n),w=new Array(f);for(let e=0;e<f;e++)w[e]=e;var y=Math.min(n-1,r),x=Math.max(0,Math.min(r-2,n)),M=Math.max(y,x);for(let e=0;e<M;e++){if(e<y){m[e]=0;for(let t=e;t<n;t++)m[e]=Tr(m[e],a[t][e]);if(0!==m[e]){a[e][e]<0&&(m[e]=-m[e]);for(let t=e;t<n;t++)a[t][e]/=m[e];a[e][e]+=1}m[e]=-m[e]}for(let t=e+1;t<r;t++){if(e<y&&0!==m[e]){let r=0;for(let i=e;i<n;i++)r+=a[i][e]*a[i][t];r=-r/a[e][e];for(let i=e;i<n;i++)a[i][t]+=r*a[i][e]}v[t]=a[e][t]}if(l&&e<y)for(let t=e;t<n;t++)p[t][e]=a[t][e];if(e<x){v[e]=0;for(let t=e+1;t<r;t++)v[e]=Tr(v[e],v[t]);if(0!==v[e]){v[e+1]<0&&(v[e]=0-v[e]);for(let t=e+1;t<r;t++)v[t]/=v[e];v[e+1]+=1}if(v[e]=-v[e],e+1<n&&0!==v[e]){for(let t=e+1;t<n;t++)b[t]=0;for(let t=e+1;t<n;t++)for(let n=e+1;n<r;n++)b[t]+=v[n]*a[t][n];for(let t=e+1;t<r;t++){let r=-v[t]/v[e+1];for(let i=e+1;i<n;i++)a[i][t]+=r*b[i]}}if(c)for(let t=e+1;t<r;t++)g[t][e]=v[t]}}let $=Math.min(r,n+1);if(y<r&&(m[y]=a[y][y]),n<$&&(m[$-1]=0),x+1<$&&(v[x]=a[x][$-1]),v[$-1]=0,l){for(let e=y;e<d;e++){for(let t=0;t<n;t++)p[t][e]=0;p[e][e]=1}for(let e=y-1;e>=0;e--)if(0!==m[e]){for(let t=e+1;t<d;t++){let r=0;for(let i=e;i<n;i++)r+=p[i][e]*p[i][t];r=-r/p[e][e];for(let i=e;i<n;i++)p[i][t]+=r*p[i][e]}for(let t=e;t<n;t++)p[t][e]=-p[t][e];p[e][e]=1+p[e][e];for(let t=0;t<e-1;t++)p[t][e]=0}else{for(let t=0;t<n;t++)p[t][e]=0;p[e][e]=1}}if(c)for(let e=r-1;e>=0;e--){if(e<x&&0!==v[e])for(let t=e+1;t<r;t++){let n=0;for(let i=e+1;i<r;i++)n+=g[i][e]*g[i][t];n=-n/g[e+1][e];for(let i=e+1;i<r;i++)g[i][t]+=n*g[i][e]}for(let t=0;t<r;t++)g[t][e]=0;g[e][e]=1}for(var P=$-1,k=Number.EPSILON;$>0;){let e,t;for(e=$-2;e>=-1&&-1!==e;e--){const t=Number.MIN_VALUE+k*Math.abs(m[e]+Math.abs(m[e+1]));if(Math.abs(v[e])<=t||Number.isNaN(v[e])){v[e]=0;break}}if(e===$-2)t=4;else{let n;for(n=$-1;n>=e&&n!==e;n--){let t=(n!==$?Math.abs(v[n]):0)+(n!==e+1?Math.abs(v[n-1]):0);if(Math.abs(m[n])<=k*t){m[n]=0;break}}n===e?t=3:n===$-1?t=1:(t=2,e=n)}switch(e++,t){case 1:{let t=v[$-2];v[$-2]=0;for(let n=$-2;n>=e;n--){let i=Tr(m[n],t),o=m[n]/i,s=t/i;if(m[n]=i,n!==e&&(t=-s*v[n-1],v[n-1]=o*v[n-1]),c)for(let e=0;e<r;e++)i=o*g[e][n]+s*g[e][$-1],g[e][$-1]=-s*g[e][n]+o*g[e][$-1],g[e][n]=i}break}case 2:{let t=v[e-1];v[e-1]=0;for(let r=e;r<$;r++){let i=Tr(m[r],t),o=m[r]/i,s=t/i;if(m[r]=i,t=-s*v[r],v[r]=o*v[r],l)for(let t=0;t<n;t++)i=o*p[t][r]+s*p[t][e-1],p[t][e-1]=-s*p[t][r]+o*p[t][e-1],p[t][r]=i}break}case 3:{const t=Math.max(Math.abs(m[$-1]),Math.abs(m[$-2]),Math.abs(v[$-2]),Math.abs(m[e]),Math.abs(v[e])),i=m[$-1]/t,o=m[$-2]/t,s=v[$-2]/t,a=m[e]/t,h=v[e]/t,u=((o+i)*(o-i)+s*s)/2,d=i*s*(i*s);let f=0;0===u&&0===d||(f=d/(u+(f=u<0?0-Math.sqrt(u*u+d):Math.sqrt(u*u+d))));let b=(a+i)*(a-i)+f,w=a*h;for(let t=e;t<$-1;t++){let i=Tr(b,w);0===i&&(i=Number.MIN_VALUE);let o=b/i,s=w/i;if(t!==e&&(v[t-1]=i),b=o*m[t]+s*v[t],v[t]=o*v[t]-s*m[t],w=s*m[t+1],m[t+1]=o*m[t+1],c)for(let e=0;e<r;e++)i=o*g[e][t]+s*g[e][t+1],g[e][t+1]=-s*g[e][t]+o*g[e][t+1],g[e][t]=i;if(0===(i=Tr(b,w))&&(i=Number.MIN_VALUE),o=b/i,s=w/i,m[t]=i,b=o*v[t]+s*m[t+1],m[t+1]=-s*v[t]+o*m[t+1],w=s*v[t+1],v[t+1]=o*v[t+1],l&&t<n-1)for(let e=0;e<n;e++)i=o*p[e][t]+s*p[e][t+1],p[e][t+1]=-s*p[e][t]+o*p[e][t+1],p[e][t]=i}v[$-2]=b;break}case 4:if(m[e]<=0&&(m[e]=m[e]<0?-m[e]:0,c))for(let t=0;t<=P;t++)g[t][e]=-g[t][e];for(;e<P&&!(m[e]>=m[e+1]);){let t=m[e];if(m[e]=m[e+1],m[e+1]=t,c&&e<r-1)for(let n=0;n<r;n++)t=g[n][e+1],g[n][e+1]=g[n][e],g[n][e]=t;if(l&&e<n-1)for(let r=0;r<n;r++)t=p[r][e+1],p[r][e+1]=p[r][e],p[r][e]=t;e++}$--}}if(h){var I=g;g=p,p=I}this.m=n,this.n=r,this.s=m,this.U=p,this.V=g}solve(e){var t=e,n=this.threshold,r=this.s.length,i=hi.zeros(r,r);for(let e=0;e<r;e++)Math.abs(this.s[e])<=n?i[e][e]=0:i[e][e]=1/this.s[e];var o=this.U,s=this.rightSingularVectors,a=s.mmul(i),l=s.rows,c=o.length,h=hi.zeros(l,c);for(let e=0;e<l;e++)for(let t=0;t<c;t++){let n=0;for(let i=0;i<r;i++)n+=a[e][i]*o[t][i];h[e][t]=n}return h.mmul(t)}solveForDiagonal(e){return this.solve(hi.diag(e))}inverse(){var e=this.V,t=this.threshold,n=e.length,r=e[0].length,i=new hi(n,this.s.length);for(let o=0;o<n;o++)for(let n=0;n<r;n++)Math.abs(this.s[n])>t?i[o][n]=e[o][n]/this.s[n]:i[o][n]=0;var o=this.U,s=o.length,a=o[0].length,l=new hi(n,s);for(let e=0;e<n;e++)for(let t=0;t<s;t++){let n=0;for(let r=0;r<a;r++)n+=i[e][r]*o[t][r];l[e][t]=n}return l}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){for(var e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,t=0,n=this.s,r=0,i=n.length;r<i;r++)n[r]>e&&t++;return t}get diagonal(){return this.s}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return hi.isMatrix(this.U)||(this.U=new hi(this.U)),this.U}get rightSingularVectors(){return hi.isMatrix(this.V)||(this.V=new hi(this.V)),this.V}get diagonalMatrix(){return hi.diag(this.s)}}function qr(e,t,n){var r=n?e.rows:e.rows-1;if(t<0||t>r)throw new RangeError("Row index out of range")}function Vr(e,t,n){var r=n?e.columns:e.columns-1;if(t<0||t>r)throw new RangeError("Column index out of range")}function Hr(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.columns)throw new RangeError("vector size must be the same as the number of columns");return t}function Wr(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.rows)throw new RangeError("vector size must be the same as the number of rows");return t}function Gr(e,t,n){return{row:Br(e,t),column:Jr(e,n)}}function Br(e,t){if("object"!=typeof t)throw new TypeError("unexpected type for row indices");if(t.some(t=>t<0||t>=e.rows))throw new RangeError("row indices are out of range");return Array.isArray(t)||(t=Array.from(t)),t}function Jr(e,t){if("object"!=typeof t)throw new TypeError("unexpected type for column indices");if(t.some(t=>t<0||t>=e.columns))throw new RangeError("column indices are out of range");return Array.isArray(t)||(t=Array.from(t)),t}function Kr(e,t,n,r,i){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(Zr("startRow",t),Zr("endRow",n),Zr("startColumn",r),Zr("endColumn",i),t>n||r>i||t<0||t>=e.rows||n<0||n>=e.rows||r<0||r>=e.columns||i<0||i>=e.columns)throw new RangeError("Submatrix indices are out of range")}function Xr(e){for(var t=hi.zeros(e.rows,1),n=0;n<e.rows;++n)for(var r=0;r<e.columns;++r)t.set(n,0,t.get(n,0)+e.get(n,r));return t}function Qr(e){for(var t=hi.zeros(1,e.columns),n=0;n<e.rows;++n)for(var r=0;r<e.columns;++r)t.set(0,r,t.get(0,r)+e.get(n,r));return t}function Zr(e,t){if("number"!=typeof t)throw new TypeError(`${e} must be a number`)}class Yr extends(ci()){constructor(e,t,n){super(),this.matrix=e,this.rows=t,this.columns=n}static get[Symbol.species](){return hi}}class ei extends Yr{constructor(e){super(e,e.columns,e.rows)}set(e,t,n){return this.matrix.set(t,e,n),this}get(e,t){return this.matrix.get(t,e)}}class ti extends Yr{constructor(e,t){super(e,1,e.columns),this.row=t}set(e,t,n){return this.matrix.set(this.row,t,n),this}get(e,t){return this.matrix.get(this.row,t)}}class ni extends Yr{constructor(e,t,n,r,i){Kr(e,t,n,r,i),super(e,n-t+1,i-r+1),this.startRow=t,this.startColumn=r}set(e,t,n){return this.matrix.set(this.startRow+e,this.startColumn+t,n),this}get(e,t){return this.matrix.get(this.startRow+e,this.startColumn+t)}}class ri extends Yr{constructor(e,t,n){var r=Gr(e,t,n);super(e,r.row.length,r.column.length),this.rowIndices=r.row,this.columnIndices=r.column}set(e,t,n){return this.matrix.set(this.rowIndices[e],this.columnIndices[t],n),this}get(e,t){return this.matrix.get(this.rowIndices[e],this.columnIndices[t])}}class ii extends Yr{constructor(e,t){super(e,(t=Br(e,t)).length,e.columns),this.rowIndices=t}set(e,t,n){return this.matrix.set(this.rowIndices[e],t,n),this}get(e,t){return this.matrix.get(this.rowIndices[e],t)}}class oi extends Yr{constructor(e,t){t=Jr(e,t),super(e,e.rows,t.length),this.columnIndices=t}set(e,t,n){return this.matrix.set(e,this.columnIndices[t],n),this}get(e,t){return this.matrix.get(e,this.columnIndices[t])}}class si extends Yr{constructor(e,t){super(e,e.rows,1),this.column=t}set(e,t,n){return this.matrix.set(e,this.column,n),this}get(e){return this.matrix.get(e,this.column)}}class ai extends Yr{constructor(e){super(e,e.rows,e.columns)}set(e,t,n){return this.matrix.set(this.rows-e-1,t,n),this}get(e,t){return this.matrix.get(this.rows-e-1,t)}}class li extends Yr{constructor(e){super(e,e.rows,e.columns)}set(e,t,n){return this.matrix.set(e,this.columns-t-1,n),this}get(e,t){return this.matrix.get(e,this.columns-t-1)}}function ci(e){void 0===e&&(e=Object);class t extends e{static get[Symbol.species](){return this}static from1DArray(e,t,n){if(e*t!==n.length)throw new RangeError("Data length does not match given dimensions");for(var r=new this(e,t),i=0;i<e;i++)for(var o=0;o<t;o++)r.set(i,o,n[i*t+o]);return r}static rowVector(e){for(var t=new this(1,e.length),n=0;n<e.length;n++)t.set(0,n,e[n]);return t}static columnVector(e){for(var t=new this(e.length,1),n=0;n<e.length;n++)t.set(n,0,e[n]);return t}static empty(e,t){return new this(e,t)}static zeros(e,t){return this.empty(e,t).fill(0)}static ones(e,t){return this.empty(e,t).fill(1)}static rand(e,t,n){void 0===n&&(n=Math.random);for(var r=this.empty(e,t),i=0;i<e;i++)for(var o=0;o<t;o++)r.set(i,o,n());return r}static randInt(e,t,n,r){void 0===n&&(n=1e3),void 0===r&&(r=Math.random);for(var i=this.empty(e,t),o=0;o<e;o++)for(var s=0;s<t;s++){var a=Math.floor(r()*n);i.set(o,s,a)}return i}static eye(e,t,n){void 0===t&&(t=e),void 0===n&&(n=1);for(var r=Math.min(e,t),i=this.zeros(e,t),o=0;o<r;o++)i.set(o,o,n);return i}static diag(e,t,n){var r=e.length;void 0===t&&(t=r),void 0===n&&(n=t);for(var i=Math.min(r,t,n),o=this.zeros(t,n),s=0;s<i;s++)o.set(s,s,e[s]);return o}static min(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);for(var n=e.rows,r=e.columns,i=new this(n,r),o=0;o<n;o++)for(var s=0;s<r;s++)i.set(o,s,Math.min(e.get(o,s),t.get(o,s)));return i}static max(e,t){e=this.checkMatrix(e),t=this.checkMatrix(t);for(var n=e.rows,r=e.columns,i=new this(n,r),o=0;o<n;o++)for(var s=0;s<r;s++)i.set(o,s,Math.max(e.get(o,s),t.get(o,s)));return i}static checkMatrix(e){return t.isMatrix(e)?e:new this(e)}static isMatrix(e){return null!=e&&"Matrix"===e.klass}get size(){return this.rows*this.columns}apply(e){if("function"!=typeof e)throw new TypeError("callback must be a function");for(var t=this.rows,n=this.columns,r=0;r<t;r++)for(var i=0;i<n;i++)e.call(this,r,i);return this}to1DArray(){for(var e=new Array(this.size),t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)e[t*this.columns+n]=this.get(t,n);return e}to2DArray(){for(var e=new Array(this.rows),t=0;t<this.rows;t++){e[t]=new Array(this.columns);for(var n=0;n<this.columns;n++)e[t][n]=this.get(t,n)}return e}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(var e=0;e<this.rows;e++)for(var t=0;t<=e;t++)if(this.get(e,t)!==this.get(t,e))return!1;return!0}return!1}isEchelonForm(){let e=0,t=0,n=-1,r=!0,i=!1;for(;e<this.rows&&r;){for(t=0,i=!1;t<this.columns&&!1===i;)0===this.get(e,t)?t++:1===this.get(e,t)&&t>n?(i=!0,n=t):(r=!1,i=!0);e++}return r}isReducedEchelonForm(){let e=0,t=0,n=-1,r=!0,i=!1;for(;e<this.rows&&r;){for(t=0,i=!1;t<this.columns&&!1===i;)0===this.get(e,t)?t++:1===this.get(e,t)&&t>n?(i=!0,n=t):(r=!1,i=!0);for(let n=t+1;n<this.rows;n++)0!==this.get(e,n)&&(r=!1);e++}return r}set(e,t,n){throw new Error("set method is unimplemented")}get(e,t){throw new Error("get method is unimplemented")}repeat(e,t){e=e||1,t=t||1;for(var n=new this.constructor[Symbol.species](this.rows*e,this.columns*t),r=0;r<e;r++)for(var i=0;i<t;i++)n.setSubMatrix(this,this.rows*r,this.columns*i);return n}fill(e){for(var t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)this.set(t,n,e);return this}neg(){return this.mulS(-1)}getRow(e){qr(this,e);for(var t=new Array(this.columns),n=0;n<this.columns;n++)t[n]=this.get(e,n);return t}getRowVector(e){return this.constructor.rowVector(this.getRow(e))}setRow(e,t){qr(this,e),t=Hr(this,t);for(var n=0;n<this.columns;n++)this.set(e,n,t[n]);return this}swapRows(e,t){qr(this,e),qr(this,t);for(var n=0;n<this.columns;n++){var r=this.get(e,n);this.set(e,n,this.get(t,n)),this.set(t,n,r)}return this}getColumn(e){Vr(this,e);for(var t=new Array(this.rows),n=0;n<this.rows;n++)t[n]=this.get(n,e);return t}getColumnVector(e){return this.constructor.columnVector(this.getColumn(e))}setColumn(e,t){Vr(this,e),t=Wr(this,t);for(var n=0;n<this.rows;n++)this.set(n,e,t[n]);return this}swapColumns(e,t){Vr(this,e),Vr(this,t);for(var n=0;n<this.rows;n++){var r=this.get(n,e);this.set(n,e,this.get(n,t)),this.set(n,t,r)}return this}addRowVector(e){e=Hr(this,e);for(var t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)+e[n]);return this}subRowVector(e){e=Hr(this,e);for(var t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)-e[n]);return this}mulRowVector(e){e=Hr(this,e);for(var t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*e[n]);return this}divRowVector(e){e=Hr(this,e);for(var t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)/e[n]);return this}addColumnVector(e){e=Wr(this,e);for(var t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)+e[t]);return this}subColumnVector(e){e=Wr(this,e);for(var t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)-e[t]);return this}mulColumnVector(e){e=Wr(this,e);for(var t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*e[t]);return this}divColumnVector(e){e=Wr(this,e);for(var t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)/e[t]);return this}mulRow(e,t){qr(this,e);for(var n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*t);return this}mulColumn(e,t){Vr(this,e);for(var n=0;n<this.rows;n++)this.set(n,e,this.get(n,e)*t);return this}max(){for(var e=this.get(0,0),t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n));return e}maxIndex(){for(var e=this.get(0,0),t=[0,0],n=0;n<this.rows;n++)for(var r=0;r<this.columns;r++)this.get(n,r)>e&&(e=this.get(n,r),t[0]=n,t[1]=r);return t}min(){for(var e=this.get(0,0),t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n));return e}minIndex(){for(var e=this.get(0,0),t=[0,0],n=0;n<this.rows;n++)for(var r=0;r<this.columns;r++)this.get(n,r)<e&&(e=this.get(n,r),t[0]=n,t[1]=r);return t}maxRow(e){qr(this,e);for(var t=this.get(e,0),n=1;n<this.columns;n++)this.get(e,n)>t&&(t=this.get(e,n));return t}maxRowIndex(e){qr(this,e);for(var t=this.get(e,0),n=[e,0],r=1;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r),n[1]=r);return n}minRow(e){qr(this,e);for(var t=this.get(e,0),n=1;n<this.columns;n++)this.get(e,n)<t&&(t=this.get(e,n));return t}minRowIndex(e){qr(this,e);for(var t=this.get(e,0),n=[e,0],r=1;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r),n[1]=r);return n}maxColumn(e){Vr(this,e);for(var t=this.get(0,e),n=1;n<this.rows;n++)this.get(n,e)>t&&(t=this.get(n,e));return t}maxColumnIndex(e){Vr(this,e);for(var t=this.get(0,e),n=[0,e],r=1;r<this.rows;r++)this.get(r,e)>t&&(t=this.get(r,e),n[0]=r);return n}minColumn(e){Vr(this,e);for(var t=this.get(0,e),n=1;n<this.rows;n++)this.get(n,e)<t&&(t=this.get(n,e));return t}minColumnIndex(e){Vr(this,e);for(var t=this.get(0,e),n=[0,e],r=1;r<this.rows;r++)this.get(r,e)<t&&(t=this.get(r,e),n[0]=r);return n}diag(){for(var e=Math.min(this.rows,this.columns),t=new Array(e),n=0;n<e;n++)t[n]=this.get(n,n);return t}sum(e){switch(e){case"row":return Xr(this);case"column":return Qr(this);default:return function(e){for(var t=0,n=0;n<e.rows;n++)for(var r=0;r<e.columns;r++)t+=e.get(n,r);return t}(this)}}mean(){return this.sum()/this.size}prod(){for(var e=1,t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)e*=this.get(t,n);return e}norm(e="frobenius"){var t=0;if("max"===e)return this.max();if("frobenius"===e){for(var n=0;n<this.rows;n++)for(var r=0;r<this.columns;r++)t+=this.get(n,r)*this.get(n,r);return Math.sqrt(t)}throw new RangeError(`unknown norm type: ${e}`)}cumulativeSum(){for(var e=0,t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)e+=this.get(t,n),this.set(t,n,e);return this}dot(e){t.isMatrix(e)&&(e=e.to1DArray());var n=this.to1DArray();if(n.length!==e.length)throw new RangeError("vectors do not have the same size");for(var r=0,i=0;i<n.length;i++)r+=n[i]*e[i];return r}mmul(e){e=this.constructor.checkMatrix(e),this.columns!==e.rows&&console.warn("Number of columns of left matrix are not equal to number of rows of right matrix.");for(var t=this.rows,n=this.columns,r=e.columns,i=new this.constructor[Symbol.species](t,r),o=new Array(n),s=0;s<r;s++){for(var a=0;a<n;a++)o[a]=e.get(a,s);for(var l=0;l<t;l++){var c=0;for(a=0;a<n;a++)c+=this.get(l,a)*o[a];i.set(l,s,c)}}return i}strassen2x2(e){var t=new this.constructor[Symbol.species](2,2);const n=this.get(0,0),r=e.get(0,0),i=this.get(0,1),o=e.get(0,1),s=this.get(1,0),a=e.get(1,0),l=this.get(1,1),c=e.get(1,1),h=(n+l)*(r+c),u=(s+l)*r,d=n*(o-c),f=l*(a-r),m=(n+i)*c,p=h+f-m+(i-l)*(a+c),g=d+m,v=u+f,b=h-u+d+(s-n)*(r+o);return t.set(0,0,p),t.set(0,1,g),t.set(1,0,v),t.set(1,1,b),t}strassen3x3(e){var t=new this.constructor[Symbol.species](3,3);const n=this.get(0,0),r=this.get(0,1),i=this.get(0,2),o=this.get(1,0),s=this.get(1,1),a=this.get(1,2),l=this.get(2,0),c=this.get(2,1),h=this.get(2,2),u=e.get(0,0),d=e.get(0,1),f=e.get(0,2),m=e.get(1,0),p=e.get(1,1),g=e.get(1,2),v=e.get(2,0),b=e.get(2,1),w=e.get(2,2),y=(n-o)*(-d+p),x=(-n+o+s)*(u-d+p),M=(o+s)*(-u+d),$=n*u,P=(-n+l+c)*(u-f+g),k=(-n+l)*(f-g),I=(l+c)*(-u+f),N=(-i+c+h)*(p+v-b),j=(i-h)*(p-b),S=i*v,_=(c+h)*(-v+b),C=(-i+s+a)*(g+v-w),A=(i-a)*(g-w),z=(s+a)*(-v+w),E=$+S+r*m,O=(n+r+i-o-s-c-h)*p+x+M+$+N+S+_,R=$+P+I+(n+r+i-s-a-l-c)*g+S+C+z,D=y+s*(-u+d+m-p-g-v+w)+x+$+S+C+A,L=y+x+M+$+a*b,T=S+C+A+z+o*f,U=$+P+k+c*(-u+f+m-p-g-v+b)+N+j+S,F=N+j+S+_+l*d,q=$+P+k+I+h*w;return t.set(0,0,E),t.set(0,1,O),t.set(0,2,R),t.set(1,0,D),t.set(1,1,L),t.set(1,2,T),t.set(2,0,U),t.set(2,1,F),t.set(2,2,q),t}mmulStrassen(e){var n=this.clone(),r=n.rows,i=n.columns,o=e.rows,s=e.columns;function a(e,n,r){var i=e.rows,o=e.columns;if(i===n&&o===r)return e;var s=t.zeros(n,r);return s=s.setSubMatrix(e,0,0)}i!==o&&console.warn(`Multiplying ${r} x ${i} and ${o} x ${s} matrix: dimensions do not match.`);var l=Math.max(r,o),c=Math.max(i,s);return function e(n,r,i,o){if(i<=512||o<=512)return n.mmul(r);i%2==1&&o%2==1?(n=a(n,i+1,o+1),r=a(r,i+1,o+1)):i%2==1?(n=a(n,i+1,o),r=a(r,i+1,o)):o%2==1&&(n=a(n,i,o+1),r=a(r,i,o+1));var s=parseInt(n.rows/2,10),l=parseInt(n.columns/2,10),c=n.subMatrix(0,s-1,0,l-1),h=r.subMatrix(0,s-1,0,l-1),u=n.subMatrix(0,s-1,l,n.columns-1),d=r.subMatrix(0,s-1,l,r.columns-1),f=n.subMatrix(s,n.rows-1,0,l-1),m=r.subMatrix(s,r.rows-1,0,l-1),p=n.subMatrix(s,n.rows-1,l,n.columns-1),g=r.subMatrix(s,r.rows-1,l,r.columns-1),v=e(t.add(c,p),t.add(h,g),s,l),b=e(t.add(f,p),h,s,l),w=e(c,t.sub(d,g),s,l),y=e(p,t.sub(m,h),s,l),x=e(t.add(c,u),g,s,l),M=e(t.sub(f,c),t.add(h,d),s,l),$=e(t.sub(u,p),t.add(m,g),s,l),P=t.add(v,y);P.sub(x),P.add($);var k=t.add(w,x),I=t.add(b,y),N=t.sub(v,b);N.add(w),N.add(M);var j=t.zeros(2*P.rows,2*P.columns);return(j=(j=(j=(j=j.setSubMatrix(P,0,0)).setSubMatrix(k,P.rows,0)).setSubMatrix(I,0,P.columns)).setSubMatrix(N,P.rows,P.columns)).subMatrix(0,i-1,0,o-1)}(n=a(n,l,c),e=a(e,l,c),l,c)}scaleRows(e,t){if((e=void 0===e?0:e)>=(t=void 0===t?1:t))throw new RangeError("min should be strictly smaller than max");for(var n=this.constructor.empty(this.rows,this.columns),r=0;r<this.rows;r++){var i=Dr(this.getRow(r),{min:e,max:t});n.setRow(r,i)}return n}scaleColumns(e,t){if((e=void 0===e?0:e)>=(t=void 0===t?1:t))throw new RangeError("min should be strictly smaller than max");for(var n=this.constructor.empty(this.rows,this.columns),r=0;r<this.columns;r++){var i=Dr(this.getColumn(r),{min:e,max:t});n.setColumn(r,i)}return n}kroneckerProduct(e){e=this.constructor.checkMatrix(e);for(var t=this.rows,n=this.columns,r=e.rows,i=e.columns,o=new this.constructor[Symbol.species](t*r,n*i),s=0;s<t;s++)for(var a=0;a<n;a++)for(var l=0;l<r;l++)for(var c=0;c<i;c++)o[r*s+l][i*a+c]=this.get(s,a)*e.get(l,c);return o}transpose(){for(var e=new this.constructor[Symbol.species](this.columns,this.rows),t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)e.set(n,t,this.get(t,n));return e}sortRows(e){void 0===e&&(e=n);for(var t=0;t<this.rows;t++)this.setRow(t,this.getRow(t).sort(e));return this}sortColumns(e){void 0===e&&(e=n);for(var t=0;t<this.columns;t++)this.setColumn(t,this.getColumn(t).sort(e));return this}subMatrix(e,t,n,r){Kr(this,e,t,n,r);for(var i=new this.constructor[Symbol.species](t-e+1,r-n+1),o=e;o<=t;o++)for(var s=n;s<=r;s++)i[o-e][s-n]=this.get(o,s);return i}subMatrixRow(e,t,n){if(void 0===t&&(t=0),void 0===n&&(n=this.columns-1),t>n||t<0||t>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");for(var r=new this.constructor[Symbol.species](e.length,n-t+1),i=0;i<e.length;i++)for(var o=t;o<=n;o++){if(e[i]<0||e[i]>=this.rows)throw new RangeError(`Row index out of range: ${e[i]}`);r.set(i,o-t,this.get(e[i],o))}return r}subMatrixColumn(e,t,n){if(void 0===t&&(t=0),void 0===n&&(n=this.rows-1),t>n||t<0||t>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");for(var r=new this.constructor[Symbol.species](n-t+1,e.length),i=0;i<e.length;i++)for(var o=t;o<=n;o++){if(e[i]<0||e[i]>=this.columns)throw new RangeError(`Column index out of range: ${e[i]}`);r.set(o-t,i,this.get(o,e[i]))}return r}setSubMatrix(e,t,n){Kr(this,t,t+(e=this.constructor.checkMatrix(e)).rows-1,n,n+e.columns-1);for(var r=0;r<e.rows;r++)for(var i=0;i<e.columns;i++)this[t+r][n+i]=e.get(r,i);return this}selection(e,t){for(var n=Gr(this,e,t),r=new this.constructor[Symbol.species](e.length,t.length),i=0;i<n.row.length;i++)for(var o=n.row[i],s=0;s<n.column.length;s++){var a=n.column[s];r[i][s]=this.get(o,a)}return r}trace(){for(var e=Math.min(this.rows,this.columns),t=0,n=0;n<e;n++)t+=this.get(n,n);return t}transposeView(){return new ei(this)}rowView(e){return qr(this,e),new ti(this,e)}columnView(e){return Vr(this,e),new si(this,e)}flipRowView(){return new ai(this)}flipColumnView(){return new li(this)}subMatrixView(e,t,n,r){return new ni(this,e,t,n,r)}selectionView(e,t){return new ri(this,e,t)}rowSelectionView(e){return new ii(this,e)}columnSelectionView(e){return new oi(this,e)}det(){var e,t,n,r,i,o;if(this.isSquare())return 2===this.columns?(e=this.get(0,0),t=this.get(0,1),n=this.get(1,0),e*this.get(1,1)-t*n):3===this.columns?(r=this.selectionView([1,2],[1,2]),i=this.selectionView([1,2],[0,2]),o=this.selectionView([1,2],[0,1]),e=this.get(0,0),t=this.get(0,1),n=this.get(0,2),e*r.det()-t*i.det()+n*o.det()):new Lr(this).determinant;throw Error("Determinant can only be calculated for a square matrix.")}pseudoInverse(e){void 0===e&&(e=Number.EPSILON);for(var t=new Fr(this,{autoTranspose:!0}),n=t.leftSingularVectors,r=t.rightSingularVectors,i=t.diagonal,o=0;o<i.length;o++)Math.abs(i[o])>e?i[o]=1/i[o]:i[o]=0;return i=this.constructor[Symbol.species].diag(i),r.mmul(i.mmul(n.transposeView()))}clone(){for(var e=new this.constructor[Symbol.species](this.rows,this.columns),t=0;t<this.rows;t++)for(var n=0;n<this.columns;n++)e.set(t,n,this.get(t,n));return e}}function n(e,t){return e-t}t.prototype.klass="Matrix",t.random=t.rand,t.diagonal=t.diag,t.prototype.diagonal=t.prototype.diag,t.identity=t.eye,t.prototype.negate=t.prototype.neg,t.prototype.tensorProduct=t.prototype.kroneckerProduct,t.prototype.determinant=t.prototype.det;var r,i="\n(function %name%(matrix, %args%) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%(%args%);\n})\n",o=eval;for(var s of[["+","add"],["-","sub","subtract"],["*","mul","multiply"],["/","div","divide"],["%","mod","modulus"],["&","and"],["|","or"],["^","xor"],["<<","leftShift"],[">>","signPropagatingRightShift"],[">>>","rightShift","zeroFillRightShift"]]){var a=o(P("\n(function %name%(value) {\n    if (typeof value === 'number') return this.%name%S(value);\n    return this.%name%M(value);\n})\n",{name:s[1],op:s[0]})),l=o(P("\n(function %name%S(value) {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, this.get(i, j) %op% value);\n        }\n    }\n    return this;\n})\n",{name:`${s[1]}S`,op:s[0]})),c=o(P("\n(function %name%M(matrix) {\n    matrix = this.constructor.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n        this.columns !== matrix.columns) {\n        throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, this.get(i, j) %op% matrix.get(i, j));\n        }\n    }\n    return this;\n})\n",{name:`${s[1]}M`,op:s[0]})),h=o(P("\n(function %name%(matrix, value) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%(value);\n})\n",{name:s[1]}));for(r=1;r<s.length;r++)t.prototype[s[r]]=a,t.prototype[`${s[r]}S`]=l,t.prototype[`${s[r]}M`]=c,t[s[r]]=h}var u=[["~","not"]];for(var d of(["abs","acos","acosh","asin","asinh","atan","atanh","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","log","log1p","log10","log2","round","sign","sin","sinh","sqrt","tan","tanh","trunc"].forEach(function(e){u.push([`Math.${e}`,e])}),u)){var f=o(P("\n(function %name%() {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j)));\n        }\n    }\n    return this;\n})\n",{name:d[1],method:d[0]})),m=o(P("\n(function %name%(matrix) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%();\n})\n",{name:d[1]}));for(r=1;r<d.length;r++)t.prototype[d[r]]=f,t[d[r]]=m}for(var p of[["Math.pow",1,"pow"]]){var g="arg0";for(r=1;r<p[1];r++)g+=`, arg${r}`;if(1!==p[1]){var v=o(P("\n(function %name%(%args%) {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j), %args%));\n        }\n    }\n    return this;\n})\n",{name:p[2],method:p[0],args:g})),b=o(P(i,{name:p[2],args:g}));for(r=2;r<p.length;r++)t.prototype[p[r]]=v,t[p[r]]=b}else{var w={name:p[2],args:g,method:p[0]},y=o(P("\n(function %name%(value) {\n    if (typeof value === 'number') return this.%name%S(value);\n    return this.%name%M(value);\n})\n",w)),x=o(P("\n(function %name%S(value) {\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j), value));\n        }\n    }\n    return this;\n})\n",w)),M=o(P("\n(function %name%M(matrix) {\n    matrix = this.constructor.checkMatrix(matrix);\n    if (this.rows !== matrix.rows ||\n        this.columns !== matrix.columns) {\n        throw new RangeError('Matrices dimensions must be equal');\n    }\n    for (var i = 0; i < this.rows; i++) {\n        for (var j = 0; j < this.columns; j++) {\n            this.set(i, j, %method%(this.get(i, j), matrix.get(i, j)));\n        }\n    }\n    return this;\n})\n",w)),$=o(P("\n(function %name%(matrix, %args%) {\n    var newMatrix = new this[Symbol.species](matrix);\n    return newMatrix.%name%(%args%);\n})\n",w));for(r=2;r<p.length;r++)t.prototype[p[r]]=y,t.prototype[`${p[r]}M`]=M,t.prototype[`${p[r]}S`]=x,t[p[r]]=$}}function P(e,t){for(var n in t)e=e.replace(new RegExp(`%${n}%`,"g"),t[n]);return e}return t}class hi extends(ci(Array)){constructor(e,t){var n;if(1===arguments.length&&"number"==typeof e)return new Array(e);if(hi.isMatrix(e))return e.clone();if(Number.isInteger(e)&&e>0){if(super(e),!(Number.isInteger(t)&&t>0))throw new TypeError("nColumns must be a positive integer");for(n=0;n<e;n++)this[n]=new Array(t)}else{if(!Array.isArray(e))throw new TypeError("First argument must be a positive number or an array");{const r=e;if(e=r.length,"number"!=typeof(t=r[0].length)||0===t)throw new TypeError("Data must be a 2D array with at least one element");for(super(e),n=0;n<e;n++){if(r[n].length!==t)throw new RangeError("Inconsistent array dimensions");this[n]=[].concat(r[n])}}}return this.rows=e,this.columns=t,this}set(e,t,n){return this[e][t]=n,this}get(e,t){return this[e][t]}removeRow(e){if(qr(this,e),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return this.splice(e,1),this.rows-=1,this}addRow(e,t){return void 0===t&&(t=e,e=this.rows),qr(this,e,!0),t=Hr(this,t),this.splice(e,0,t),this.rows+=1,this}removeColumn(e){if(Vr(this,e),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(var t=0;t<this.rows;t++)this[t].splice(e,1);return this.columns-=1,this}addColumn(e,t){void 0===t&&(t=e,e=this.columns),Vr(this,e,!0),t=Wr(this,t);for(var n=0;n<this.rows;n++)this[n].splice(e,0,t[n]);return this.columns+=1,this}}class ui extends(ci()){constructor(e){super(),this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,t,n){return this.data[e][t]=n,this}get(e,t){return this.data[e][t]}static get[Symbol.species](){return hi}}class di{constructor(e){var t,n,r,i,o=(e=ui.checkMatrix(e)).clone(),s=e.rows,a=e.columns,l=new Array(a);for(r=0;r<a;r++){var c=0;for(t=r;t<s;t++)c=Tr(c,o.get(t,r));if(0!==c){for(o.get(r,r)<0&&(c=-c),t=r;t<s;t++)o.set(t,r,o.get(t,r)/c);for(o.set(r,r,o.get(r,r)+1),n=r+1;n<a;n++){for(i=0,t=r;t<s;t++)i+=o.get(t,r)*o.get(t,n);for(i=-i/o.get(r,r),t=r;t<s;t++)o.set(t,n,o.get(t,n)+i*o.get(t,r))}}l[r]=-c}this.QR=o,this.Rdiag=l}solve(e){e=hi.checkMatrix(e);var t=this.QR,n=t.rows;if(e.rows!==n)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");var r,i,o,s,a=e.columns,l=e.clone(),c=t.columns;for(o=0;o<c;o++)for(i=0;i<a;i++){for(s=0,r=o;r<n;r++)s+=t[r][o]*l[r][i];for(s=-s/t[o][o],r=o;r<n;r++)l[r][i]+=s*t[r][o]}for(o=c-1;o>=0;o--){for(i=0;i<a;i++)l[o][i]/=this.Rdiag[o];for(r=0;r<o;r++)for(i=0;i<a;i++)l[r][i]-=l[o][i]*t[r][o]}return l.subMatrix(0,c-1,0,a-1)}isFullRank(){for(var e=this.QR.columns,t=0;t<e;t++)if(0===this.Rdiag[t])return!1;return!0}get upperTriangularMatrix(){var e,t,n=this.QR,r=n.columns,i=new hi(r,r);for(e=0;e<r;e++)for(t=0;t<r;t++)i[e][t]=e<t?n[e][t]:e===t?this.Rdiag[e]:0;return i}get orthogonalMatrix(){var e,t,n,r,i=this.QR,o=i.rows,s=i.columns,a=new hi(o,s);for(n=s-1;n>=0;n--){for(e=0;e<o;e++)a[e][n]=0;for(a[n][n]=1,t=n;t<s;t++)if(0!==i[n][n]){for(r=0,e=n;e<o;e++)r+=i[e][n]*a[e][t];for(r=-r/i[n][n],e=n;e<o;e++)a[e][t]+=r*i[e][n]}}return a}}function fi(e,t=!1){return e=ui.checkMatrix(e),t?new Fr(e).inverse():function(e,t,n=!1){return e=ui.checkMatrix(e),t=ui.checkMatrix(t),n?new Fr(e).solve(t):e.isSquare()?new Lr(e).solve(t):new di(e).solve(t)}(e,hi.eye(e.rows))}function mi(e,t,n,r,i){var o=n*r*r,s=hi.eye(t.length,t.length,o);const a=i(t);var l=e.x.map(e=>a(e)),c=function(e,t,n,r,i){const o=n.length,s=e.x.length;for(var a=new Array(o),l=0;l<o;l++){a[l]=new Array(s);var c=n.concat();c[l]+=r;for(var h=i(c),u=0;u<s;u++)a[l][u]=t[u]-h(e.x[u])}return new hi(a)}(e,l,t,r,i),h=function(e,t){const n=e.x.length;for(var r=new Array(n),i=0;i<n;i++)r[i]=[e.y[i]-t[i]];return new hi(r)}(e,l),u=fi(s.add(c.mmul(c.transpose())));return(t=(t=new hi([t])).sub(u.mmul(c).mmul(h).mul(r).transpose())).to1DArray()}function pi(e,t,n={}){let{maxIterations:r=100,gradientDifference:i=.1,damping:o=0,errorTolerance:s=.01,minValues:a,maxValues:l,initialValues:c}=n;if(o<=0)throw new Error("The damping option must be a positive number");if(!e.x||!e.y)throw new Error("The data parameter must have x and y elements");if(!Array.isArray(e.x)||e.x.length<2||!Array.isArray(e.y)||e.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(e.x.length!==e.y.length)throw new Error("The data parameter elements must have the same size");var h=c||new Array(t.length).fill(1);let u=h.length;if(l=l||new Array(u).fill(Number.MAX_SAFE_INTEGER),a=a||new Array(u).fill(Number.MIN_SAFE_INTEGER),l.length!==a.length)throw new Error("minValues and maxValues must be the same size");if(!Array.isArray(h))throw new Error("initialValues must be an array");for(var d=Er(e,h,t),f=d<=s,m=0;m<r&&!f;m++){h=mi(e,h,o,i,t);for(let e=0;e<u;e++)h[e]=Math.min(Math.max(a[e],h[e]),l[e]);if(d=Er(e,h,t),isNaN(d))break;f=d<=s}return{parameterValues:h,parameterError:d,iterations:m}}var gi=pe(function(e,t){var n=fe&&fe.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}l((r=r.apply(e,t||[])).next())})},r=fe&&fe.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},i=fe&&fe.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},o=fe&&fe.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},s=fe&&fe.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},a=fe&&fe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=s(_r),c=s(Cr),h=s(zr),u=s(Ar),d=s(Sr),f=a(pi),m=function(){function e(e){void 0===e&&(e={});var t=this;this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=p,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new g;var n=function(n){void 0!==e[n]&&(t[n]=e[n])};n("distanceFn"),n("learningRate"),n("localConnectivity"),n("minDist"),n("nComponents"),n("nEpochs"),n("nNeighbors"),n("negativeSampleRate"),n("random"),n("repulsionStrength"),n("setOpMixRatio"),n("spread"),n("transformQueueSize")}return e.prototype.fit=function(e){return this.initializeFit(e),this.optimizeLayout(),this.embedding},e.prototype.fitAsync=function(e,t){return void 0===t&&(t=function(){return!0}),n(this,void 0,void 0,function(){return r(this,function(n){switch(n.label){case 0:return this.initializeFit(e),[4,this.optimizeLayoutAsync(t)];case 1:return n.sent(),[2,this.embedding]}})})},e.prototype.setSupervisedProjection=function(e,t){void 0===t&&(t={}),this.Y=e,this.targetMetric=t.targetMetric||this.targetMetric,this.targetWeight=t.targetWeight||this.targetWeight,this.targetNNeighbors=t.targetNNeighbors||this.targetNNeighbors},e.prototype.setPrecomputedKNN=function(e,t){this.knnIndices=e,this.knnDistances=t},e.prototype.initializeFit=function(e){if(this.X===e&&this.isInitialized)return this.getNEpochs();if(this.X=e,!this.knnIndices&&!this.knnDistances){var t=this.nearestNeighbors(e);this.knnIndices=t.knnIndices,this.knnDistances=t.knnDistances}this.graph=this.fuzzySimplicialSet(e,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(e),this.processGraphForSupervisedProjection();var n=this.initializeSimplicialSetEmbedding(),r=n.head,i=n.tail,o=n.epochsPerSample;return this.optimizationState.head=r,this.optimizationState.tail=i,this.optimizationState.epochsPerSample=o,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},e.prototype.makeSearchFns=function(){var e=h.makeInitializations(this.distanceFn),t=e.initFromTree,n=e.initFromRandom;this.initFromTree=t,this.initFromRandom=n,this.search=h.makeInitializedNNSearch(this.distanceFn)},e.prototype.makeSearchGraph=function(e){for(var t=this.knnIndices,n=this.knnDistances,r=[e.length,e.length],i=new c.SparseMatrix([],[],[],r),o=0;o<t.length;o++)for(var s=t[o],a=n[o],l=0;l<s.length;l++){var h=s[l],u=a[l];u>0&&i.set(o,h,u)}var d=c.transpose(i);return c.maximum(i,d)},e.prototype.transform=function(e){var t=this,n=this.X;if(void 0===n||0===n.length)throw new Error("No data has been fit.");var r=Math.floor(this.nNeighbors*this.transformQueueSize),i=h.initializeSearch(this.rpForest,n,e,r,this.initFromRandom,this.initFromTree,this.random),o=this.search(n,this.searchGraph,i,e),s=l.deheapSort(o),a=s.indices,u=s.weights;a=a.map(function(e){return e.slice(0,t.nNeighbors)}),u=u.map(function(e){return e.slice(0,t.nNeighbors)});var f=Math.max(0,this.localConnectivity-1),m=this.smoothKNNDistance(u,this.nNeighbors,f),p=m.sigmas,g=m.rhos,v=this.computeMembershipStrengths(a,u,p,g),b=v.rows,w=v.cols,y=v.vals,x=[e.length,n.length],$=new c.SparseMatrix(b,w,y,x),P=c.normalize($,"l1"),k=c.getCSR(P),I=e.length,N=M(d.reshape2d(k.indices,I,this.nNeighbors),d.reshape2d(k.values,I,this.nNeighbors),this.embedding),j=this.nEpochs?this.nEpochs/3:$.nRows<=1e4?100:30,S=$.getValues().reduce(function(e,t){return t>e?t:e},0);$=$.map(function(e){return e<S/j?0:e}),$=c.eliminateZeros($);var _=this.makeEpochsPerSample($.getValues(),j),C=$.getRows(),A=$.getCols();return this.assignOptimizationStateParameters({headEmbedding:N,tailEmbedding:this.embedding,head:C,tail:A,currentEpoch:0,nEpochs:j,nVertices:$.getDims()[1],epochsPerSample:_}),this.prepareForOptimizationLoop(),this.optimizeLayout()},e.prototype.processGraphForSupervisedProjection=function(){var e=this.Y,t=this.X;if(e){if(e.length!==t.length)throw new Error("Length of X and y must be equal");if("categorical"===this.targetMetric){var n=this.targetWeight<1?1/(1-this.targetWeight)*2.5:1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,e,n)}}},e.prototype.step=function(){var e=this.optimizationState.currentEpoch;return e<this.getNEpochs()&&this.optimizeLayoutStep(e),this.optimizationState.currentEpoch},e.prototype.getEmbedding=function(){return this.embedding},e.prototype.nearestNeighbors=function(e){var t,n=this.distanceFn,r=this.nNeighbors,i=h.makeNNDescent(n,this.random),o=5+Math.floor(.5===(t=Math.pow(e.length,.5)/20)?0:Math.round(t)),s=Math.max(5,Math.floor(Math.round(function(e){return Math.log(e)/Math.log(2)}(e.length))));this.rpForest=u.makeForest(e,r,o,this.random);var a=i(e,u.makeLeafArray(this.rpForest),r,s);return{knnIndices:a.indices,knnDistances:a.weights}},e.prototype.fuzzySimplicialSet=function(e,t,n){void 0===n&&(n=1);var r=this.knnIndices,i=void 0===r?[]:r,o=this.knnDistances,s=void 0===o?[]:o,a=this.localConnectivity,l=this.smoothKNNDistance(s,t,a),h=l.sigmas,u=l.rhos,d=this.computeMembershipStrengths(i,s,h,u),f=d.rows,m=d.cols,p=d.vals,g=[e.length,e.length],v=new c.SparseMatrix(f,m,p,g),b=c.transpose(v),w=c.pairwiseMultiply(v,b),y=c.subtract(c.add(v,b),w),x=c.multiplyScalar(y,n),M=c.multiplyScalar(w,1-n);return c.add(x,M)},e.prototype.categoricalSimplicialSetIntersection=function(e,t,n,r){void 0===r&&(r=1);var i=y(e,t,r,n);return x(i=c.eliminateZeros(i))},e.prototype.smoothKNNDistance=function(e,t,n,r,i){void 0===n&&(n=1),void 0===r&&(r=64),void 0===i&&(i=1);for(var o=Math.log(t)/Math.log(2)*i,s=d.zeros(e.length),a=d.zeros(e.length),l=0;l<e.length;l++){var c=0,h=1/0,u=1,f=e[l],m=f.filter(function(e){return e>0});if(m.length>=n){var p=Math.floor(n),g=n-p;p>0?(s[l]=m[p-1],g>1e-5&&(s[l]+=g*(m[p]-m[p-1]))):s[l]=g*m[0]}else m.length>0&&(s[l]=d.max(m));for(var v=0;v<r;v++){for(var b=0,w=1;w<e[l].length;w++){var y=e[l][w]-s[l];b+=y>0?Math.exp(-y/u):1}if(Math.abs(b-o)<1e-5)break;b>o?u=(c+(h=u))/2:(c=u,h===1/0?u*=2:u=(c+h)/2)}if(a[l]=u,s[l]>0){var x=d.mean(f);a[l]<.001*x&&(a[l]=.001*x)}else{var M=d.mean(e.map(d.mean));a[l]<.001*M&&(a[l]=.001*M)}}return{sigmas:a,rhos:s}},e.prototype.computeMembershipStrengths=function(e,t,n,r){for(var i=e.length,o=e[0].length,s=d.zeros(i*o),a=d.zeros(i*o),l=d.zeros(i*o),c=0;c<i;c++)for(var h=0;h<o;h++){var u=0;-1!==e[c][h]&&(u=e[c][h]===c?0:t[c][h]-r[c]<=0?1:Math.exp(-(t[c][h]-r[c])/n[c]),s[c*o+h]=c,a[c*o+h]=e[c][h],l[c*o+h]=u)}return{rows:s,cols:a,vals:l}},e.prototype.initializeSimplicialSetEmbedding=function(){for(var e=this,t=this.getNEpochs(),n=this.nComponents,r=this.graph.getValues(),i=0,o=0;o<r.length;o++){var s=r[o];i<r[o]&&(i=s)}var a=this.graph.map(function(e){return e<i/t?0:e});this.embedding=d.zeros(a.nRows).map(function(){return d.zeros(n).map(function(){return 20*d.tauRand(e.random)-10})});var l=[],c=[],h=[];for(o=0;o<a.nRows;o++)for(var u=0;u<a.nCols;u++){(s=a.get(o,u))&&(l.push(s),h.push(o),c.push(u))}return{head:c,tail:h,epochsPerSample:this.makeEpochsPerSample(l,t)}},e.prototype.makeEpochsPerSample=function(e,t){var n=d.filled(e.length,-1),r=d.max(e),i=e.map(function(e){return e/r*t});return i.forEach(function(e,r){e>0&&(n[r]=t/i[r])}),n},e.prototype.assignOptimizationStateParameters=function(e){Object.assign(this.optimizationState,e)},e.prototype.prepareForOptimizationLoop=function(){var e=this.repulsionStrength,t=this.learningRate,n=this.negativeSampleRate,r=this.optimizationState,i=r.epochsPerSample,s=r.headEmbedding,a=r.tailEmbedding,l=s[0].length,c=s.length===a.length,h=i.map(function(e){return e/n}),u=o(h),d=o(i);this.assignOptimizationStateParameters({epochOfNextSample:d,epochOfNextNegativeSample:u,epochsPerNegativeSample:h,moveOther:c,initialAlpha:t,alpha:t,gamma:e,dim:l})},e.prototype.initializeOptimization=function(){var e=this.embedding,t=this.embedding,n=this.optimizationState,r=n.head,i=n.tail,o=n.epochsPerSample,s=this.getNEpochs(),a=this.graph.nCols,l=w(this.spread,this.minDist),c=l.a,h=l.b;this.assignOptimizationStateParameters({headEmbedding:e,tailEmbedding:t,head:r,tail:i,epochsPerSample:o,a:c,b:h,nEpochs:s,nVertices:a})},e.prototype.optimizeLayoutStep=function(e){for(var t=this.optimizationState,n=t.head,r=t.tail,i=t.headEmbedding,o=t.tailEmbedding,s=t.epochsPerSample,a=t.epochOfNextSample,l=t.epochOfNextNegativeSample,c=t.epochsPerNegativeSample,h=t.moveOther,u=t.initialAlpha,f=t.alpha,m=t.gamma,p=t.a,g=t.b,w=t.dim,y=t.nEpochs,x=t.nVertices,M=0;M<s.length;M++)if(!(a[M]>e)){var $=n[M],P=r[M],k=i[$],I=o[P],N=b(k,I),j=0;N>0&&(j=-2*p*g*Math.pow(N,g-1),j/=p*Math.pow(N,g)+1);for(var S=0;S<w;S++){var _=v(j*(k[S]-I[S]),4);k[S]+=_*f,h&&(I[S]+=-_*f)}a[M]+=s[M];for(var C=Math.floor((e-l[M])/c[M]),A=0;A<C;A++){var z=d.tauRandInt(x,this.random),E=o[z],O=b(k,E),R=0;if(O>0)R=2*m*g,R/=(.001+O)*(p*Math.pow(O,g)+1);else if($===z)continue;for(S=0;S<w;S++){_=4;R>0&&(_=v(R*(k[S]-E[S]),4)),k[S]+=_*f}}l[M]+=C*c[M]}return t.alpha=u*(1-e/y),t.currentEpoch+=1,i},e.prototype.optimizeLayoutAsync=function(e){var t=this;return void 0===e&&(e=function(){return!0}),new Promise(function(i,o){var s=function(){return n(t,void 0,void 0,function(){var t,n,a,l,c,h;return r(this,function(r){try{if(t=this.optimizationState,n=t.nEpochs,a=t.currentEpoch,this.embedding=this.optimizeLayoutStep(a),l=this.optimizationState.currentEpoch,c=!1===e(l),h=l===n,c||h)return[2,i(h)];s()}catch(e){o(e)}return[2]})})};s()})},e.prototype.optimizeLayout=function(e){void 0===e&&(e=function(){return!0});for(var t=!1,n=[];!t;){var r=this.optimizationState,i=r.nEpochs,o=r.currentEpoch;n=this.optimizeLayoutStep(o);var s=this.optimizationState.currentEpoch,a=!1===e(s);t=s===i||a}return n},e.prototype.getNEpochs=function(){var e=this.graph;if(this.nEpochs>0)return this.nEpochs;var t=e.nRows;return t<=2500?500:t<=5e3?400:t<=7500?300:200},e}();function p(e,t){for(var n=0,r=0;r<e.length;r++)n+=Math.pow(e[r]-t[r],2);return Math.sqrt(n)}t.UMAP=m,t.euclidean=p,t.cosine=function(e,t){for(var n=0,r=0,i=0,o=0;o<e.length;o++)n+=e[o]*t[o],r+=Math.pow(e[o],2),i+=Math.pow(t[o],2);return 0===r&&0===i?0:0===r||0===i?1:1-n/Math.sqrt(r*i)};var g=function(){return function(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0}}();function v(e,t){return e>t?t:e<-t?-t:e}function b(e,t){for(var n=0,r=0;r<e.length;r++)n+=Math.pow(e[r]-t[r],2);return n}function w(e,t){var n=d.linear(0,3*e,300).map(function(e){return e<t?1:e}),r=d.zeros(n.length).map(function(r,i){return n[i]>=t?Math.exp(-(n[i]-t)/e):r}),o={x:n,y:r},s={damping:1.5,initialValues:[.5,.5],gradientDifference:.1,maxIterations:100,errorTolerance:.01},a=f.default(o,function(e){var t=i(e,2),n=t[0],r=t[1];return function(e){return 1/(1+n*Math.pow(e,2*r))}},s).parameterValues,l=i(a,2);return{a:l[0],b:l[1]}}function y(e,t,n,r){return void 0===n&&(n=1),void 0===r&&(r=5),e.map(function(e,i,o){return-1===t[i]||-1===t[o]?e*Math.exp(-n):t[i]!==t[o]?e*Math.exp(-r):e})}function x(e){e=c.normalize(e,"max");var t=c.transpose(e),n=c.pairwiseMultiply(t,e);return e=c.add(e,c.subtract(t,n)),c.eliminateZeros(e)}function M(e,t,n){for(var r=d.zeros(e.length).map(function(e){return d.zeros(n[0].length)}),i=0;i<e.length;i++)for(var o=0;o<e[0].length;o++)for(var s=0;s<n[0].length;s++){var a=e[i][o];r[i][s]+=t[i][o]*n[a][s]}return r}t.findABParams=w,t.fastIntersection=y,t.resetLocalConnectivity=x,t.initTransform=M});me(gi);gi.UMAP,gi.euclidean,gi.cosine,gi.findABParams,gi.fastIntersection,gi.resetLocalConnectivity,gi.initTransform;var vi=pe(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.UMAP=gi.UMAP});me(vi);var bi=vi.UMAP;function wi(e,t,n){const r=Object.create(e);return r.option=t[n],r}function yi(e,t,n){const r=Object.create(e);return r.demo=t[n],r.i=n,r}function xi(e,t,n){const r=Object.create(e);return r.group=t[n],r.groupIndex=n,r}function Mi(e,t,n){const r=Object.create(e);return r.points=t[n],r}function $i(e,t,n){const r=Object.create(e);return r.row=t[n],r.rowIndex=n,r}function Pi(e,t,n){const r=Object.create(e);return r.minDist=t[n],r}function ki(e,t,n){const r=Object.create(e);return r.nNeighbors=t[n],r}function Ii(e){var n;return{c(){(n=p("div")).textContent="Loading..."},m(e,t){d(e,n,t)},p:t,i:t,o:t,d(e){e&&f(n)}}}function Ni(e){var t,n,r,i,o,s,a,l,c,h,g,w,y,$,P,k,I,N,j,S,_,C,A,z,E,O=e.selectedDemo.description+"";let R=e.nNeighborsOptions,D=[];for(let t=0;t<R.length;t+=1)D[t]=ji(ki(e,R,t));let L=e.minDistOptions,T=[];for(let t=0;t<L.length;t+=1)T[t]=Si(Pi(e,L,t));let U=e.entries,F=[];for(let t=0;t<U.length;t+=1)F[t]=Ci($i(e,U,t));const q=e=>J(F[e],1,1,()=>{F[e]=null});let V=e.groupDemos(e.N_PER_ROW),H=[];for(let t=0;t<V.length;t+=1)H[t]=zi(xi(e,V,t));const K=e=>J(H[e],1,1,()=>{H[e]=null});let X=e.selectedDemo.options,Q=[];for(let t=0;t<X.length;t+=1)Q[t]=Ei(wi(e,X,t));return{c(){t=p("div"),n=p("div"),r=p("div"),i=b(),o=p("div"),(s=p("div")).innerHTML='<div class="n-neighbors-header svelte-1vhx0ua">n_neighbors</div>',a=b(),l=p("div");for(let e=0;e<D.length;e+=1)D[e].c();c=b(),h=p("div"),g=p("div"),(w=p("div")).textContent="min_dist",y=b(),$=p("div");for(let e=0;e<T.length;e+=1)T[e].c();P=b(),k=p("div");for(let e=0;e<F.length;e+=1)F[e].c();I=b(),N=p("div"),j=p("div");for(let e=0;e<H.length;e+=1)H[e].c();S=b(),_=p("div"),C=p("div"),A=v(O),z=b();for(let e=0;e<Q.length;e+=1)Q[e].c();x(r,"class","left-column-spacer svelte-1vhx0ua"),x(s,"class","left-column-header svelte-1vhx0ua"),x(l,"class","left-column-labels svelte-1vhx0ua"),x(o,"class","left-column-content svelte-1vhx0ua"),x(n,"class","left-column svelte-1vhx0ua"),x(w,"class","min-dist-header svelte-1vhx0ua"),x($,"class","min-dist-labels svelte-1vhx0ua"),x(k,"class","rows svelte-1vhx0ua"),x(g,"class","rows-container svelte-1vhx0ua"),x(h,"class","right-column"),x(t,"class","figures-container svelte-1vhx0ua"),x(j,"class","demo-select svelte-1vhx0ua"),x(C,"class","demo-text svelte-1vhx0ua"),x(_,"class","demo-description svelte-1vhx0ua"),x(N,"class","menu svelte-1vhx0ua")},m(e,f){d(e,t,f),u(t,n),u(n,r),u(n,i),u(n,o),u(o,s),u(o,a),u(o,l);for(let e=0;e<D.length;e+=1)D[e].m(l,null);u(t,c),u(t,h),u(h,g),u(g,w),u(g,y),u(g,$);for(let e=0;e<T.length;e+=1)T[e].m($,null);u(g,P),u(g,k);for(let e=0;e<F.length;e+=1)F[e].m(k,null);d(e,I,f),d(e,N,f),u(N,j);for(let e=0;e<H.length;e+=1)H[e].m(j,null);u(N,S),u(N,_),u(_,C),u(C,A),u(_,z);for(let e=0;e<Q.length;e+=1)Q[e].m(_,null);E=!0},p(e,t){if(e.nNeighborsOptions){let n;for(R=t.nNeighborsOptions,n=0;n<R.length;n+=1){const r=ki(t,R,n);D[n]?D[n].p(e,r):(D[n]=ji(r),D[n].c(),D[n].m(l,null))}for(;n<D.length;n+=1)D[n].d(1);D.length=R.length}if(e.minDistOptions){let n;for(L=t.minDistOptions,n=0;n<L.length;n+=1){const r=Pi(t,L,n);T[n]?T[n].p(e,r):(T[n]=Si(r),T[n].c(),T[n].m($,null))}for(;n<T.length;n+=1)T[n].d(1);T.length=L.length}if(e.entries||e.hoveredPointIndex){let n;for(U=t.entries,n=0;n<U.length;n+=1){const r=$i(t,U,n);F[n]?(F[n].p(e,r),B(F[n],1)):(F[n]=Ci(r),F[n].c(),B(F[n],1),F[n].m(k,null))}for(W(),n=U.length;n<F.length;n+=1)q(n);G()}if(e.groupDemos||e.N_PER_ROW||e.getDemoPreviewOverride||e.getPoints||e.handlePreviewClick||e.selectedDemoIndex){let n;for(V=t.groupDemos(t.N_PER_ROW),n=0;n<V.length;n+=1){const r=xi(t,V,n);H[n]?(H[n].p(e,r),B(H[n],1)):(H[n]=zi(r),H[n].c(),B(H[n],1),H[n].m(j,null))}for(W(),n=V.length;n<H.length;n+=1)K(n);G()}if(E&&!e.selectedDemo||O===(O=t.selectedDemo.description+"")||M(A,O),e.selectedDemo){let n;for(X=t.selectedDemo.options,n=0;n<X.length;n+=1){const r=wi(t,X,n);Q[n]?Q[n].p(e,r):(Q[n]=Ei(r),Q[n].c(),Q[n].m(_,null))}for(;n<Q.length;n+=1)Q[n].d(1);Q.length=X.length}},i(e){if(!E){for(let e=0;e<U.length;e+=1)B(F[e]);for(let e=0;e<V.length;e+=1)B(H[e]);E=!0}},o(e){F=F.filter(Boolean);for(let e=0;e<F.length;e+=1)J(F[e]);H=H.filter(Boolean);for(let e=0;e<H.length;e+=1)J(H[e]);E=!1},d(e){e&&f(t),m(D,e),m(T,e),m(F,e),e&&(f(I),f(N)),m(H,e),m(Q,e)}}}function ji(e){var n,r,i=e.nNeighbors+"";return{c(){n=p("div"),r=v(i)},m(e,t){d(e,n,t),u(n,r)},p:t,d(e){e&&f(n)}}}function Si(e){var n,r,i=e.minDist+"";return{c(){n=p("div"),r=v(i)},m(e,t){d(e,n,t),u(n,r)},p:t,d(e){e&&f(n)}}}function _i(e){var t,n=new jr({props:{points:e.points,hoveredPointIndex:e.hoveredPointIndex,onClick:Ri,highlighted:!0,selectable:!1,selected:!1}});return n.$on("hover",e.hover_handler),{c(){n.$$.fragment.c()},m(e,r){Q(n,e,r),t=!0},p(e,t){var r={};e.entries&&(r.points=t.points),e.hoveredPointIndex&&(r.hoveredPointIndex=t.hoveredPointIndex),n.$set(r)},i(e){t||(B(n.$$.fragment,e),t=!0)},o(e){J(n.$$.fragment,e),t=!1},d(e){Z(n,e)}}}function Ci(e){var t,n,r;let i=e.row,o=[];for(let t=0;t<i.length;t+=1)o[t]=_i(Mi(e,i,t));const s=e=>J(o[e],1,1,()=>{o[e]=null});return{c(){t=p("div");for(let e=0;e<o.length;e+=1)o[e].c();n=b(),x(t,"class","row svelte-1vhx0ua")},m(e,i){d(e,t,i);for(let e=0;e<o.length;e+=1)o[e].m(t,null);u(t,n),r=!0},p(e,r){if(e.entries||e.hoveredPointIndex){let a;for(i=r.row,a=0;a<i.length;a+=1){const s=Mi(r,i,a);o[a]?(o[a].p(e,s),B(o[a],1)):(o[a]=_i(s),o[a].c(),B(o[a],1),o[a].m(t,n))}for(W(),a=i.length;a<o.length;a+=1)s(a);G()}},i(e){if(!r){for(let e=0;e<i.length;e+=1)B(o[e]);r=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)J(o[e]);r=!1},d(e){e&&f(t),m(o,e)}}}function Ai(e){var t,n=new jr({props:{points:e.demo.previewOverride?Mr(e.demo):xr(e.demo),onClick:e.handlePreviewClick(e.groupIndex*e.N_PER_ROW+e.i),selected:e.groupIndex*e.N_PER_ROW+e.i===e.selectedDemoIndex}});return{c(){n.$$.fragment.c()},m(e,r){Q(n,e,r),t=!0},p(e,t){var r={};e.N_PER_ROW&&(r.points=t.demo.previewOverride?Mr(t.demo):xr(t.demo)),e.N_PER_ROW&&(r.onClick=t.handlePreviewClick(t.groupIndex*t.N_PER_ROW+t.i)),(e.N_PER_ROW||e.selectedDemoIndex)&&(r.selected=t.groupIndex*t.N_PER_ROW+t.i===t.selectedDemoIndex),n.$set(r)},i(e){t||(B(n.$$.fragment,e),t=!0)},o(e){J(n.$$.fragment,e),t=!1},d(e){Z(n,e)}}}function zi(e){var t,n,r;let i=e.group,o=[];for(let t=0;t<i.length;t+=1)o[t]=Ai(yi(e,i,t));const s=e=>J(o[e],1,1,()=>{o[e]=null});return{c(){t=p("div");for(let e=0;e<o.length;e+=1)o[e].c();n=b(),x(t,"class","demos svelte-1vhx0ua")},m(e,i){d(e,t,i);for(let e=0;e<o.length;e+=1)o[e].m(t,null);u(t,n),r=!0},p(e,r){if(e.groupDemos||e.N_PER_ROW||e.getDemoPreviewOverride||e.getPoints||e.handlePreviewClick||e.selectedDemoIndex){let a;for(i=r.group,a=0;a<i.length;a+=1){const s=yi(r,i,a);o[a]?(o[a].p(e,s),B(o[a],1)):(o[a]=Ai(s),o[a].c(),B(o[a],1),o[a].m(t,n))}for(W(),a=i.length;a<o.length;a+=1)s(a);G()}},i(e){if(!r){for(let e=0;e<i.length;e+=1)B(o[e]);r=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)J(o[e]);r=!1},d(e){e&&f(t),m(o,e)}}}function Ei(e){var t,n,r,i,o,s,a,l,c=e.option.name+"",h=e.option.start+"";return{c(){t=p("div"),n=p("span"),r=v(c),i=v(":"),o=b(),s=p("span"),a=v(h),l=b(),x(n,"class","demo-parameter-name svelte-1vhx0ua"),x(t,"class","demo-parameters")},m(e,c){d(e,t,c),u(t,n),u(n,r),u(n,i),u(t,o),u(t,s),u(s,a),u(t,l)},p(e,t){e.selectedDemo&&c!==(c=t.option.name+"")&&M(r,c),e.selectedDemo&&h!==(h=t.option.start+"")&&M(a,h)},d(e){e&&f(t)}}}function Oi(e){var t,n,r,i,o=[Ni,Ii],s=[];function a(e,t){return t.isLoaded?0:1}return n=a(0,e),r=s[n]=o[n](e),{c(){t=p("div"),r.c(),x(t,"class","container svelte-1vhx0ua")},m(e,r){d(e,t,r),s[n].m(t,null),i=!0},p(e,i){var l=n;(n=a(0,i))===l?s[n].p(e,i):(W(),J(s[l],1,1,()=>{s[l]=null}),G(),(r=s[n])||(r=s[n]=o[n](i)).c(),B(r,1),r.m(t,null))},i(e){i||(B(r),i=!0)},o(e){J(r),i=!1},d(e){e&&f(t),s[n].d()}}}const Ri=()=>{};function Di(e,t,n){let r,i,o=!1,s=0,a=yr[s],l=-1,c=xr(a);const h=[5,15,30,50,100],u=[0,.01,.05,.1,.5,1];let d=6;function f(e){e.matches?n("N_PER_ROW",d=8):n("N_PER_ROW",d=6)}const m=window.matchMedia("(max-width: 800px)");f(m),m.addListener(f);const p=e=>{n("selectedDemoIndex",s=e),n("selectedDemo",a=yr[s]),c=xr(a);const t=(()=>h.map(()=>u.map(()=>[{coords:[0,0],color:"red"}])))(),o=r[s];for(let e in o){const n=1*e.replace("nNeighbors=","").split(",")[0],r=1*e.replace("minDist=","").split(",")[1],i=h.indexOf(n),s=u.indexOf(r),a=o[e];t[i][s]=a.map(([e,t],n)=>({coords:[e,t],color:c[n].color}))}n("entries",i=t)};j(async()=>{r=await ir(),p(0),n("isLoaded",o=!0)});return{isLoaded:o,selectedDemoIndex:s,selectedDemo:a,hoveredPointIndex:l,entries:i,nNeighborsOptions:h,minDistOptions:u,N_PER_ROW:d,groupDemos:e=>{const t=[],n=Math.ceil(yr.length/e),r=Math.floor(yr.length/n);for(let e=0;e<n;e++)t.push(yr.slice(r*e,r*(e+1)));return t},handlePreviewClick:e=>()=>{p(e)},hover_handler:e=>n("hoveredPointIndex",l=e.detail)}}class Li extends te{constructor(e){super(),ee(this,e,Di,Oi,a,[])}}function Ti(e){const t={};return Object.keys(e).forEach(n=>{const r=e[n],i=Zn(atob(r)),o=Qn(i,2e4,nr),s=[];for(let e=0;e<o.length;e+=2)s.push([o[e],o[e+1]]);t[n]=s}),t}let Ui=null,Fi=null;async function qi(){return Ui||(Fi||(Fi=async function(){const e=await fetch("mammoth_tsne_encoded.json"),t=await e.json();return Ui=Ti(t)}()),Fi)}let Vi=null,Hi=null;async function Wi(){return Vi||(Hi||(Hi=async function(){const e=await fetch("mammoth_10k_encoded.json"),t=await e.json(),n=Ti(t.projections);return t.projections=n,Vi=t}()),Hi)}let Gi=null,Bi=null;async function Ji(){return Gi||(Bi||(Bi=async function(){const e=await fetch("mammoth_3d.json"),t=await e.json();return Gi=t,t}()),Bi)}let Ki=null,Xi=null;async function Qi(){return Ki||(Xi||(Xi=async function(){const e=(await Wi()).labelOffsets;Ki=new Uint8Array(1e4);let t=-1,n=0;for(let r=0;r<Ki.length;r++)r>=n&&(n+=e[t+=1]),Ki[r]=t;return Ki}()),Xi)}async function Zi(){const e={};return await Promise.all([Wi().then(t=>e.projections=t.projections),Qi().then(t=>e.colorIndices=t),Ji().then(t=>e.mammoth3d=t)]),e}const Yi=["rgba(204, 0, 17, 1)","rgba(0, 34, 68, 1)","rgba(221, 221, 51, 1)","rgba(0, 68, 136, 1)","rgba(0, 51, 17, 1)","rgba(17, 170, 170, 1)","rgba(46, 102, 151, 1)","rgba(155, 32, 6, 1)","rgba(204, 0, 17, 1)","rgba(17, 170, 170, 1)","rgba(17, 170, 170, 1)"],eo=e=>e<.5?2*e*e:(4-2*e)*e-1,to=500,no=e=>e.map(([e,t])=>[e,t]);class ro{constructor(e,t,n=eo,r=to){this.current=no(e),this.end=no(e),this.callback=t,this.easingFn=n,this.tweenDuration=r,this.isActive=!1,this.percent=1,this.onAnimationFrame=this.onAnimationFrame.bind(this)}beginTween(e){this.start=no(this.current),this.end=no(e),this.isActive=!0,this.startTime=Date.now(),requestAnimationFrame(this.onAnimationFrame)}applyTween(){this.current=this.current.map((e,t)=>{const[n,r]=this.start[t],[i,o]=this.end[t];return[(i-n)*this.percent+n,(o-r)*this.percent+r]})}onAnimationFrame(){const e=Date.now()-this.startTime,t=Math.min(1,e/this.tweenDuration);this.percent=this.easingFn(t),1===this.percent&&(this.isActive=!1),this.applyTween(),this.callback(this.current,this.isActive,this.percent),this.isActive&&requestAnimationFrame(this.onAnimationFrame)}}function io(e){var t,n,r,i;return{c(){x(t=g("circle"),"r","10"),x(t,"fill","none"),x(t,"stroke","#000"),x(t,"stroke-width","3"),x(t,"opacity",n=e.hoveredPointIndex>-1?1:0),x(t,"cx",r=e.projection[e.hoveredPointIndex][0]),x(t,"cy",i=e.projection[e.hoveredPointIndex][1])},m(e,n){d(e,t,n)},p(e,o){e.hoveredPointIndex&&n!==(n=o.hoveredPointIndex>-1?1:0)&&x(t,"opacity",n),(e.projection||e.hoveredPointIndex)&&r!==(r=o.projection[o.hoveredPointIndex][0])&&x(t,"cx",r),(e.projection||e.hoveredPointIndex)&&i!==(i=o.projection[o.hoveredPointIndex][1])&&x(t,"cy",i)},d(e){e&&f(t)}}}function oo(e){var n,r,i,s,a,l,c,h,m=e.projection[e.hoveredPointIndex]+"",w=e.projection[e.hoveredPointIndex]&&e.projection[e.hoveredPointIndex][0]&&io(e);return{c(){n=p("div"),r=p("canvas"),i=b(),s=g("svg"),a=g("text"),l=v(m),w&&w.c(),x(r,"width",e.size),x(r,"height",e.size),x(r,"class","svelte-1t453rc"),x(s,"viewBox",c="0 0 "+e.size+" "+e.size),x(s,"class","svelte-1t453rc"),x(n,"class","container svelte-1t453rc"),h=[y(r,"mousemove",e.handleMousemove),y(r,"mouseout",e.handleMouseout)]},m(t,o){d(t,n,o),u(n,r),e.canvas_1_binding(r),u(n,i),u(n,s),u(s,a),u(a,l),w&&w.m(s,null),e.svg_1_binding(s)},p(e,t){e.size&&(x(r,"width",t.size),x(r,"height",t.size)),(e.projection||e.hoveredPointIndex)&&m!==(m=t.projection[t.hoveredPointIndex]+"")&&M(l,m),t.projection[t.hoveredPointIndex]&&t.projection[t.hoveredPointIndex][0]?w?w.p(e,t):((w=io(t)).c(),w.m(s,null)):w&&(w.d(1),w=null),e.size&&c!==(c="0 0 "+t.size+" "+t.size)&&x(s,"viewBox",c)},i:t,o:t,d(t){t&&f(n),e.canvas_1_binding(null),w&&w.d(),e.svg_1_binding(null),o(h)}}}function so(e,t,n){const r=_();let i,o,s,{colorIndices:a,projection:l,hoveredPointIndex:c=-1,size:h=1024}=t;const u=(e,t,n)=>{!function(e,t,n,r){const{width:i,height:o}=t,s=e.getContext("2d");s.clearRect(0,0,i,o);for(let e=0;e<n.length;e++){const t=n[e],[i,o]=t,a=r[e];s.fillStyle=Yi[a],s.fillRect(i,o,3,3)}}(i,{width:h,height:h},e,a)};j(()=>{s=new ro(l,u)});let d=null;return S(()=>{l!=d&&(d=l,s.beginTween(l))}),e.$set=(e=>{"colorIndices"in e&&n("colorIndices",a=e.colorIndices),"projection"in e&&n("projection",l=e.projection),"hoveredPointIndex"in e&&n("hoveredPointIndex",c=e.hoveredPointIndex),"size"in e&&n("size",h=e.size)}),{canvas:i,svg:o,colorIndices:a,projection:l,hoveredPointIndex:c,size:h,handleMousemove:function(){var e=h/i.offsetWidth,t=event.layerX*e,n=event.layerY*e;if(a||!a.length){var o=1/0,s=0;l.forEach((e,r)=>{var i=e[0]-t,a=e[1]-n,l=i*i+a*a;l<o&&(o=l,s=r)}),r("hover",s)}},handleMouseout:function(){r("hover",-1)},canvas_1_binding:function(e){z[e?"unshift":"push"](()=>{n("canvas",i=e)})},svg_1_binding:function(e){z[e?"unshift":"push"](()=>{n("svg",o=e)})}}}class ao extends te{constructor(e){super(),ee(this,e,so,oo,a,["colorIndices","projection","hoveredPointIndex","size"])}}function lo(e){var t,n;return{c(){t=p("div"),n=v(e.title),x(t,"class","title svelte-1wyabjw")},m(e,r){d(e,t,r),u(t,n)},p(e,t){e.title&&M(n,t.title)},d(e){e&&f(t)}}}function co(e){var t,n,r,i,o,s,a,l=e.times[e.nNeighborsIndex].t+"";return{c(){t=p("div"),n=p("label"),(r=p("span")).textContent="time:",i=b(),o=v(l),s=b(),a=p("div"),x(r,"class","label-text svelte-1wyabjw"),x(n,"class","label svelte-1wyabjw"),P(a,"width",e.sliderWidth+"px"),x(t,"class","controls svelte-1wyabjw")},m(e,l){d(e,t,l),u(t,n),u(n,r),u(n,i),u(n,o),u(t,s),u(t,a)},p(e,t){(e.times||e.nNeighborsIndex)&&l!==(l=t.times[t.nNeighborsIndex].t+"")&&M(o,l),e.sliderWidth&&P(a,"width",t.sliderWidth+"px")},d(e){e&&f(t)}}}function ho(e){var t,n,r,i,o,s,a,l,c,h,m,g,w,y,$,k,I,N,j,S,_,C,A=e.title&&lo(e),E=new ao({props:{projection:e.projection,colorIndices:e.colorIndices,hoveredPointIndex:e.hoveredPointIndex}});function O(t){e.slider0_value_binding.call(null,t),m=!0,T(()=>m=!1)}E.$on("hover",e.hover_handler);let R={min:0,max:e.neighbors.length-1,step:1};void 0!==e.nNeighborsIndex&&(R.value=e.nNeighborsIndex);var D=new pn({props:R});function L(t){e.slider1_value_binding.call(null,t),S=!0,T(()=>S=!1)}z.push(()=>X(D,"value",O));let U={min:0,max:e.dists.length-1,step:1};void 0!==e.distsIndex&&(U.value=e.distsIndex);var F=new pn({props:U});z.push(()=>X(F,"value",L));var q=e.times&&co(e);return{c(){t=p("div"),A&&A.c(),n=b(),E.$$.fragment.c(),r=b(),i=p("div"),o=p("label"),(s=p("span")).textContent="n_neighbors:",a=b(),l=v(e.nNeighbors),c=b(),h=p("div"),D.$$.fragment.c(),g=b(),w=p("div"),y=p("label"),($=p("span")).textContent="min_dist:",k=b(),I=v(e.minDist),N=b(),j=p("div"),F.$$.fragment.c(),_=b(),q&&q.c(),x(s,"class","label-text svelte-1wyabjw"),x(o,"class","label svelte-1wyabjw"),P(h,"width",e.sliderWidth+"px"),x(i,"class","controls svelte-1wyabjw"),x($,"class","label-text svelte-1wyabjw"),x(y,"class","label svelte-1wyabjw"),P(j,"width",e.sliderWidth+"px"),x(w,"class","controls svelte-1wyabjw"),x(t,"class","container svelte-1wyabjw")},m(e,f){d(e,t,f),A&&A.m(t,null),u(t,n),Q(E,t,null),u(t,r),u(t,i),u(i,o),u(o,s),u(o,a),u(o,l),u(i,c),u(i,h),Q(D,h,null),u(t,g),u(t,w),u(w,y),u(y,$),u(y,k),u(y,I),u(w,N),u(w,j),Q(F,j,null),u(t,_),q&&q.m(t,null),C=!0},p(e,r){r.title?A?A.p(e,r):((A=lo(r)).c(),A.m(t,n)):A&&(A.d(1),A=null);var i={};e.projection&&(i.projection=r.projection),e.colorIndices&&(i.colorIndices=r.colorIndices),e.hoveredPointIndex&&(i.hoveredPointIndex=r.hoveredPointIndex),E.$set(i),C&&!e.nNeighbors||M(l,r.nNeighbors);var o={};!m&&e.nNeighborsIndex&&(o.value=r.nNeighborsIndex),D.$set(o),C&&!e.sliderWidth||P(h,"width",r.sliderWidth+"px"),C&&!e.minDist||M(I,r.minDist);var s={};!S&&e.distsIndex&&(s.value=r.distsIndex),F.$set(s),C&&!e.sliderWidth||P(j,"width",r.sliderWidth+"px"),r.times?q?q.p(e,r):((q=co(r)).c(),q.m(t,null)):q&&(q.d(1),q=null)},i(e){C||(B(E.$$.fragment,e),B(D.$$.fragment,e),B(F.$$.fragment,e),C=!0)},o(e){J(E.$$.fragment,e),J(D.$$.fragment,e),J(F.$$.fragment,e),C=!1},d(e){e&&f(t),A&&A.d(),Z(E),Z(D),Z(F),q&&q.d()}}}function uo(e,t,n){let r=230;function i(e){e.matches?n("sliderWidth",r=100):n("sliderWidth",r=230)}const o=window.matchMedia("(max-width: 800px)");i(o),o.addListener(i);const s=[3,5,10,15,20,50,100,200],a=["0.0","0.1","0.25","0.5","0.8","0.99"];let l=3,c=s[l],h=1,u=a[h],{colorIndices:d,projections:f,title:m="",times:p=null,hoveredPointIndex:g=-1}=t;const v=()=>f?f[(()=>`n=${c},d=${u}`)()]:null;let b=v();return S(()=>{n("nNeighbors",c=s[l]),n("minDist",u=a[h]),n("projection",b=v()),console.log("Umap2d afterUpdate - projection:",b?b.length:"null")}),j(()=>{console.log("Umap2d onMount - colorIndices:",d?d.length:"null"),console.log("Umap2d onMount - projections:",f?Object.keys(f):"null")}),e.$set=(e=>{"colorIndices"in e&&n("colorIndices",d=e.colorIndices),"projections"in e&&n("projections",f=e.projections),"title"in e&&n("title",m=e.title),"times"in e&&n("times",p=e.times),"hoveredPointIndex"in e&&n("hoveredPointIndex",g=e.hoveredPointIndex)}),{sliderWidth:r,neighbors:s,dists:a,nNeighborsIndex:l,nNeighbors:c,distsIndex:h,minDist:u,colorIndices:d,projections:f,title:m,times:p,hoveredPointIndex:g,projection:b,hover_handler:function(t){C(e,t)},slider0_value_binding:function(e){n("nNeighborsIndex",l=e)},slider1_value_binding:function(e){n("distsIndex",h=e)}}}class fo extends te{constructor(e){super(),ee(this,e,uo,ho,a,["colorIndices","projections","title","times","hoveredPointIndex"])}}function mo(e){var t,n;return{c(){t=p("div"),n=v(e.title),x(t,"class","title svelte-1ep2zgs")},m(e,r){d(e,t,r),u(t,n)},p(e,t){e.title&&M(n,t.title)},d(e){e&&f(t)}}}function po(e){var t,n;return{c(){(t=p("div")).innerHTML='<i class="material-icons">3d_rotation</i>',x(t,"class","orbit svelte-1ep2zgs"),n=y(t,"click",e.toggleOrbit)},m(e,n){d(e,t,n)},d(e){e&&f(t),n()}}}function go(e){var n,r,i,o,s,a=e.title&&mo(e),l=!e.isOrbiting&&po(e);return{c(){n=p("div"),a&&a.c(),r=b(),i=p("div"),o=b(),l&&l.c(),x(i,"class","scatter-gl-container svelte-1ep2zgs"),x(n,"class","container svelte-1ep2zgs"),s=y(n,"mouseout",e.handleMouseout)},m(t,s){d(t,n,s),a&&a.m(n,null),u(n,r),u(n,i),e.div0_binding(i),u(n,o),l&&l.m(n,null)},p(e,t){t.title?a?a.p(e,t):((a=mo(t)).c(),a.m(n,r)):a&&(a.d(1),a=null),t.isOrbiting?l&&(l.d(1),l=null):l||((l=po(t)).c(),l.m(n,null))},i:t,o:t,d(t){t&&f(n),a&&a.d(),e.div0_binding(null),l&&l.d(),s()}}}function vo(e,t,n){const r=_();let i,o,s=!0,{colorIndices:a,model3d:l,title:c="",hoveredPointIndex:h=-1}=t;return j(async()=>{if(console.log("Projection3d onMount - model3d:",l?l.length:"null"),console.log("Projection3d onMount - colorIndices:",a?a.length:"null"),!l||!a)return void console.error("Projection3d: Missing required data",{model3d:!!l,colorIndices:!!a});const e={dimensions:3,points:l,metadata:[]};o=new ScatterGL(i,{styles:{fog:{enabled:!1},point:{scaleHover:3.5,colorHover:"rgba(0,0,0,1)"}},selectEnabled:!1,onCameraMove:()=>{s&&n("isOrbiting",s=!1)},onHover:e=>{null!==e&&e!==h&&r("hover",e)}}),window.scatterGLObj=o,o.setPointColorer(e=>{const t=a[e];return Yi[t]}),o.render(e)}),S(()=>{o.setHoverPointIndex(h)}),e.$set=(e=>{"colorIndices"in e&&n("colorIndices",a=e.colorIndices),"model3d"in e&&n("model3d",l=e.model3d),"title"in e&&n("title",c=e.title),"hoveredPointIndex"in e&&n("hoveredPointIndex",h=e.hoveredPointIndex)}),{container:i,isOrbiting:s,colorIndices:a,model3d:l,title:c,hoveredPointIndex:h,handleMouseout:function(){r("hover",-1)},toggleOrbit:()=>{n("isOrbiting",s=!0),o.startOrbitAnimation()},div0_binding:function(e){z[e?"unshift":"push"](()=>{n("container",i=e)})}}}class bo extends te{constructor(e){super(),ee(this,e,vo,go,a,["colorIndices","model3d","title","hoveredPointIndex"])}}function wo(e){var n;return{c(){(n=p("p")).textContent="loading..."},m(e,t){d(e,n,t)},p:t,i:t,o:t,d(e){e&&f(n)}}}function yo(e){var t,n,r=new bo({props:{colorIndices:e.colorIndices,mammoth3d:e.mammoth3d,hoveredPointIndex:e.hoveredPointIndex,title:"Original 3D Data"}});r.$on("hover",e.hover_handler);var i=new fo({props:{colorIndices:e.colorIndices,projections:e.projections,hoveredPointIndex:e.hoveredPointIndex,title:"2D UMAP Projection"}});return i.$on("hover",e.hover_handler_1),{c(){r.$$.fragment.c(),t=b(),i.$$.fragment.c()},m(e,o){Q(r,e,o),d(e,t,o),Q(i,e,o),n=!0},p(e,t){var n={};e.colorIndices&&(n.colorIndices=t.colorIndices),e.mammoth3d&&(n.mammoth3d=t.mammoth3d),e.hoveredPointIndex&&(n.hoveredPointIndex=t.hoveredPointIndex),r.$set(n);var o={};e.colorIndices&&(o.colorIndices=t.colorIndices),e.projections&&(o.projections=t.projections),e.hoveredPointIndex&&(o.hoveredPointIndex=t.hoveredPointIndex),i.$set(o)},i(e){n||(B(r.$$.fragment,e),B(i.$$.fragment,e),n=!0)},o(e){J(r.$$.fragment,e),J(i.$$.fragment,e),n=!1},d(e){Z(r,e),e&&f(t),Z(i,e)}}}function xo(e){var t,n,r,i,o=[yo,wo],s=[];function a(e,t){return t.isLoaded?0:1}return n=a(0,e),r=s[n]=o[n](e),{c(){t=p("div"),r.c(),x(t,"class","container svelte-1g2360b")},m(e,r){d(e,t,r),s[n].m(t,null),i=!0},p(e,i){var l=n;(n=a(0,i))===l?s[n].p(e,i):(W(),J(s[l],1,1,()=>{s[l]=null}),G(),(r=s[n])||(r=s[n]=o[n](i)).c(),B(r,1),r.m(t,null))},i(e){i||(B(r),i=!0)},o(e){J(r),i=!1},d(e){e&&f(t),s[n].d()}}}function Mo(e,t,n){let r,i,o,s=!1,a=-1;j(async()=>{const e=await Zi();n("isLoaded",s=!0),n("colorIndices",r=e.colorIndices),n("projections",i=e.projections),n("mammoth3d",o=e.mammoth3d)});return{isLoaded:s,colorIndices:r,projections:i,mammoth3d:o,hoveredPointIndex:a,hover_handler:e=>n("hoveredPointIndex",a=e.detail),hover_handler_1:e=>n("hoveredPointIndex",a=e.detail)}}class $o extends te{constructor(e){super(),ee(this,e,Mo,xo,a,[])}}function Po(e){var t,n;return{c(){t=p("div"),n=v(e.title),x(t,"class","title svelte-4a3mwu")},m(e,r){d(e,t,r),u(t,n)},p(e,t){e.title&&M(n,t.title)},d(e){e&&f(t)}}}function ko(e){var t,n,r,i,o,s,a,l=e.times[e.perplexityIndex].t+"";return{c(){t=p("div"),n=p("label"),(r=p("span")).textContent="time:",i=b(),o=v(l),s=b(),a=p("div"),x(r,"class","label-text svelte-4a3mwu"),x(n,"class","label svelte-4a3mwu"),P(a,"width",e.sliderWidth+"px"),x(t,"class","controls svelte-4a3mwu")},m(e,l){d(e,t,l),u(t,n),u(n,r),u(n,i),u(n,o),u(t,s),u(t,a)},p(e,t){(e.times||e.perplexityIndex)&&l!==(l=t.times[t.perplexityIndex].t+"")&&M(o,l),e.sliderWidth&&P(a,"width",t.sliderWidth+"px")},d(e){e&&f(t)}}}function Io(e){var t,n,r,i,o,s,a,l,c,h,m,g,w,y=e.title&&Po(e),$=new ao({props:{projection:e.projection,colorIndices:e.colorIndices,hoveredPointIndex:e.hoveredPointIndex}});function k(t){e.slider_value_binding.call(null,t),m=!0,T(()=>m=!1)}$.$on("hover",e.hover_handler);let I={min:0,max:e.perplexities.length-1,step:1};void 0!==e.perplexityIndex&&(I.value=e.perplexityIndex);var N=new pn({props:I});z.push(()=>X(N,"value",k));var j=e.times&&ko(e);return{c(){t=p("div"),y&&y.c(),n=b(),$.$$.fragment.c(),r=b(),i=p("div"),o=p("label"),(s=p("span")).textContent="perplexity:",a=b(),l=v(e.perplexity),c=b(),h=p("div"),N.$$.fragment.c(),g=b(),j&&j.c(),x(s,"class","label-text svelte-4a3mwu"),x(o,"class","label svelte-4a3mwu"),P(h,"width",e.sliderWidth+"px"),x(i,"class","controls svelte-4a3mwu"),x(t,"class","container svelte-4a3mwu")},m(e,f){d(e,t,f),y&&y.m(t,null),u(t,n),Q($,t,null),u(t,r),u(t,i),u(i,o),u(o,s),u(o,a),u(o,l),u(i,c),u(i,h),Q(N,h,null),u(t,g),j&&j.m(t,null),w=!0},p(e,r){r.title?y?y.p(e,r):((y=Po(r)).c(),y.m(t,n)):y&&(y.d(1),y=null);var i={};e.projection&&(i.projection=r.projection),e.colorIndices&&(i.colorIndices=r.colorIndices),e.hoveredPointIndex&&(i.hoveredPointIndex=r.hoveredPointIndex),$.$set(i),w&&!e.perplexity||M(l,r.perplexity);var o={};!m&&e.perplexityIndex&&(o.value=r.perplexityIndex),N.$set(o),w&&!e.sliderWidth||P(h,"width",r.sliderWidth+"px"),r.times?j?j.p(e,r):((j=ko(r)).c(),j.m(t,null)):j&&(j.d(1),j=null)},i(e){w||(B($.$$.fragment,e),B(N.$$.fragment,e),w=!0)},o(e){J($.$$.fragment,e),J(N.$$.fragment,e),w=!1},d(e){e&&f(t),y&&y.d(),Z($),Z(N),j&&j.d()}}}function No(e,t,n){let r=230;function i(e){e.matches?n("sliderWidth",r=100):n("sliderWidth",r=230)}const o=window.matchMedia("(max-width: 800px)");i(o),o.addListener(i);const s=[...Yn];let a=4,l=s[a],{colorIndices:c,projections:h,title:u="",times:d=null,hoveredPointIndex:f=-1}=t;const m=()=>h[(()=>`p=${l}`)()];let p=m();return S(()=>{n("perplexity",l=s[a]),n("projection",p=m())}),e.$set=(e=>{"colorIndices"in e&&n("colorIndices",c=e.colorIndices),"projections"in e&&n("projections",h=e.projections),"title"in e&&n("title",u=e.title),"times"in e&&n("times",d=e.times),"hoveredPointIndex"in e&&n("hoveredPointIndex",f=e.hoveredPointIndex)}),{sliderWidth:r,perplexities:s,perplexityIndex:a,perplexity:l,colorIndices:c,projections:h,title:u,times:d,hoveredPointIndex:f,projection:p,hover_handler:function(t){C(e,t)},slider_value_binding:function(e){n("perplexityIndex",a=e)}}}class jo extends te{constructor(e){super(),ee(this,e,No,Io,a,["colorIndices","projections","title","times","hoveredPointIndex"])}}const So={umap:[{n:3,t:"25s"},{n:5,t:"34s"},{n:10,t:"51s"},{n:15,t:"1m 2s"},{n:20,t:"1m 11s"},{n:50,t:"1m 56s"},{n:100,t:"2m 30s"},{n:200,t:"3m 22s"}],tsne:[{p:5,t:"9m 18s"},{p:15,t:"10m 7s"},{p:30,t:"11m 5s"},{p:50,t:"12m 42s"},{p:100,t:"16m 1s"},{p:200,t:"22m 16s"},{p:500,t:"42m 24s"},{p:1e3,t:"1h 16m"},{p:200,t:"2h 5m",fake:!0}]};function _o(e){var n;return{c(){(n=p("p")).textContent="loading..."},m(e,t){d(e,n,t)},p:t,i:t,o:t,d(e){e&&f(n)}}}function Co(e){var t,n,r=new jo({props:{colorIndices:e.colorIndices,hoveredPointIndex:e.hoveredPointIndex,projections:e.tsneProjections,title:"2D t-SNE projection",times:So.tsne}});r.$on("hover",e.hover_handler);var i=new fo({props:{colorIndices:e.colorIndices,hoveredPointIndex:e.hoveredPointIndex,projections:e.umapProjections,title:"2D UMAP projection",times:So.umap}});return i.$on("hover",e.hover_handler_1),{c(){r.$$.fragment.c(),t=b(),i.$$.fragment.c()},m(e,o){Q(r,e,o),d(e,t,o),Q(i,e,o),n=!0},p(e,t){var n={};e.colorIndices&&(n.colorIndices=t.colorIndices),e.hoveredPointIndex&&(n.hoveredPointIndex=t.hoveredPointIndex),e.tsneProjections&&(n.projections=t.tsneProjections),r.$set(n);var o={};e.colorIndices&&(o.colorIndices=t.colorIndices),e.hoveredPointIndex&&(o.hoveredPointIndex=t.hoveredPointIndex),e.umapProjections&&(o.projections=t.umapProjections),i.$set(o)},i(e){n||(B(r.$$.fragment,e),B(i.$$.fragment,e),n=!0)},o(e){J(r.$$.fragment,e),J(i.$$.fragment,e),n=!1},d(e){Z(r,e),e&&f(t),Z(i,e)}}}function Ao(e){var t,n,r,i,o=[Co,_o],s=[];function a(e,t){return t.isLoaded?0:1}return n=a(0,e),r=s[n]=o[n](e),{c(){t=p("div"),r.c(),x(t,"class","container svelte-1g2360b")},m(e,r){d(e,t,r),s[n].m(t,null),i=!0},p(e,i){var l=n;(n=a(0,i))===l?s[n].p(e,i):(W(),J(s[l],1,1,()=>{s[l]=null}),G(),(r=s[n])||(r=s[n]=o[n](i)).c(),B(r,1),r.m(t,null))},i(e){i||(B(r),i=!0)},o(e){J(r),i=!1},d(e){e&&f(t),s[n].d()}}}function zo(e,t,n){let r,i,o,s,a=!1,l=-1;j(async()=>{const e=await Zi();n("tsneProjections",o=await qi()),n("isLoaded",a=!0),n("colorIndices",r=e.colorIndices),n("umapProjections",i=e.projections),s=e.mammoth3d});return{isLoaded:a,colorIndices:r,umapProjections:i,tsneProjections:o,hoveredPointIndex:l,hover_handler:e=>n("hoveredPointIndex",l=e.detail),hover_handler_1:e=>n("hoveredPointIndex",l=e.detail)}}class Eo extends te{constructor(e){super(),ee(this,e,zo,Ao,a,[])}}const Oo=400,Ro=d3.scaleLinear().domain([0,20,50,100,200,6e3]).range([60,30,20,10,0]);function Do(e){var n,r,i,o;return{c(){n=p("div"),x(r=p("canvas"),"width",150),x(r,"height",150),x(r,"class","svelte-1kx2hq9"),x(n,"class",i="demo-data "+(e.selected?"selected":"")+" svelte-1kx2hq9"),o=y(n,"click",e.onClick)},m(t,i){d(t,n,i),u(n,r),e.canvas_1_binding(r)},p(e,t){e.selected&&i!==(i="demo-data "+(t.selected?"selected":"")+" svelte-1kx2hq9")&&x(n,"class",i)},i:t,o:t,d(t){t&&f(n),e.canvas_1_binding(null),o()}}}function Lo(e,t,n){let r,{demo:i,onClick:o,selected:s}=t;const a=i.previewOverride?Mr(i):xr(i);return j(()=>{Pr(a,r,null,null)}),e.$set=(e=>{"demo"in e&&n("demo",i=e.demo),"onClick"in e&&n("onClick",o=e.onClick),"selected"in e&&n("selected",s=e.selected)}),{demo:i,onClick:o,selected:s,canvas:r,canvas_1_binding:function(e){z[e?"unshift":"push"](()=>{n("canvas",r=e)})}}}class To extends te{constructor(e){super(),ee(this,e,Lo,Do,a,["demo","onClick","selected"])}}function Uo(e){var t,n,r,i,o,s,a,l,c,h;function m(t){e.slider_value_binding.call(null,t),c=!0,T(()=>c=!1)}let g={min:e.min,max:e.max,step:e.step,onChange:e.onChange};void 0!==e.value&&(g.value=e.value);var w=new pn({props:g});return z.push(()=>X(w,"value",m)),{c(){t=p("div"),n=p("span"),r=v(e.name),i=b(),o=p("span"),s=v(e.value),a=b(),l=p("div"),w.$$.fragment.c(),x(l,"class","slider-container svelte-t7irbq")},m(e,c){d(e,t,c),u(t,n),u(n,r),u(t,i),u(t,o),u(o,s),u(t,a),u(t,l),Q(w,l,null),h=!0},p(e,t){h&&!e.value||M(s,t.value);var n={};e.onChange&&(n.onChange=t.onChange),!c&&e.value&&(n.value=t.value),w.$set(n)},i(e){h||(B(w.$$.fragment,e),h=!0)},o(e){J(w.$$.fragment,e),h=!1},d(e){e&&f(t),Z(w)}}}function Fo(e,t,n){let{options:r,value:i,onChange:o=(()=>{})}=t;const{name:s,min:a,max:l}=r,c=r.step||1;return e.$set=(e=>{"options"in e&&n("options",r=e.options),"value"in e&&n("value",i=e.value),"onChange"in e&&n("onChange",o=e.onChange)}),{options:r,value:i,onChange:o,name:s,min:a,max:l,step:c,slider_value_binding:function(e){n("value",i=e)}}}class qo extends te{constructor(e){super(),ee(this,e,Fo,Uo,a,["options","value","onChange"])}}function Vo(e,t,n){const r=Object.create(e);return r.demoOption=t[n],r.each_value=t,r.demoOption_index=n,r}function Ho(e,t,n){const r=Object.create(e);return r.demo=t[n],r.i=n,r}function Wo(e){var t,n=new To({props:{demo:e.demo,onClick:e.handlePreviewClick(e.i),selected:e.i===e.selectedDemoIndex}});return{c(){n.$$.fragment.c()},m(e,r){Q(n,e,r),t=!0},p(e,t){var r={};e.selectedDemoIndex&&(r.selected=t.i===t.selectedDemoIndex),n.$set(r)},i(e){t||(B(n.$$.fragment,e),t=!0)},o(e){J(n.$$.fragment,e),t=!1},d(e){Z(n,e)}}}function Go(e){var t;return{c(){(t=p("i")).textContent="play_arrow",x(t,"class","material-icons svelte-e37zij")},m(e,n){d(e,t,n)},d(e){e&&f(t)}}}function Bo(e){var t;return{c(){(t=p("i")).textContent="pause",x(t,"class","material-icons svelte-e37zij")},m(e,n){d(e,t,n)},d(e){e&&f(t)}}}function Jo(e,t){var n,r,i;function o(e){t.parameter_value_binding.call(null,e,t),r=!0,T(()=>r=!1)}let s={options:t.demoOption,onChange:t.restart};void 0!==t.demoOption.start&&(s.value=t.demoOption.start);var a=new qo({props:s});return z.push(()=>X(a,"value",o)),{key:e,first:null,c(){n=w(),a.$$.fragment.c(),this.first=n},m(e,t){d(e,n,t),Q(a,e,t),i=!0},p(e,n){t=n;var i={};e.demo&&(i.options=t.demoOption),!r&&e.demo&&(i.value=t.demoOption.start),a.$set(i)},i(e){i||(B(a.$$.fragment,e),i=!0)},o(e){J(a.$$.fragment,e),i=!1},d(e){e&&f(n),Z(a,e)}}}function Ko(e){var t,n,r,i,s,a,l,c,h,g,w,$,P,k,I,N,j,S,_,C,A,E,O,R,D,L,U,F,q,V,H,Y,ee,te,ne,re,ie,oe,se=e.demo.description+"",ae=[],le=new Map;let ce=br,he=[];for(let t=0;t<ce.length;t+=1)he[t]=Wo(Ho(e,ce,t));const ue=e=>J(he[e],1,1,()=>{he[e]=null});function de(e,t){return t.isRunning?Bo:Go}var fe=de(0,e),me=fe(e);function pe(t){e.parameter0_value_binding.call(null,t),L=!0,T(()=>L=!1)}let ge={options:{name:"n_neighbors",min:Xo,max:Qo,step:1},onChange:e.restart};void 0!==e.nNeighbors&&(ge.value=e.nNeighbors);var ve=new qo({props:ge});function be(t){e.parameter1_value_binding.call(null,t),F=!0,T(()=>F=!1)}z.push(()=>X(ve,"value",pe));let we={options:{name:"min_dist",min:Zo,max:Yo,step:.01},onChange:e.restart};void 0!==e.minDist&&(we.value=e.minDist);var ye=new qo({props:we});z.push(()=>X(ye,"value",be));let xe=e.demo.options;const Me=e=>e.demoOption.name;for(let t=0;t<xe.length;t+=1){let n=Vo(e,xe,t),r=Me(n);le.set(r,ae[t]=Jo(r,n))}return{c(){t=p("div"),n=p("div"),r=p("canvas"),i=b(),s=p("div");for(let e=0;e<he.length;e+=1)he[e].c();a=b(),l=p("div"),c=p("div"),h=p("div"),g=p("button"),me.c(),w=b(),$=p("button"),(P=p("i")).textContent="refresh",I=b(),N=p("div"),j=v("Step\n          "),S=p("br"),_=b(),C=p("span"),A=v(e.step),E=b(),O=p("div"),(R=p("div")).textContent="UMAP Parameters",D=b(),ve.$$.fragment.c(),U=b(),ye.$$.fragment.c(),q=b(),V=p("div"),H=p("div"),Y=v(se),ee=b(),te=p("div"),(ne=p("div")).textContent="Dataset Parameters",re=b();for(let e=0;e<ae.length;e+=1)ae[e].c();x(r,"class","output svelte-e37zij"),x(r,"width","600"),x(r,"height","600"),x(n,"class","playground-canvas svelte-e37zij"),x(s,"class","data-menu svelte-e37zij"),x(g,"class","play-pause svelte-e37zij"),g.disabled=e.isFinished,x(P,"class","material-icons svelte-e37zij"),x($,"class","restart svelte-e37zij"),$.disabled=k=e.isRunning||0===e.step,x(S,"class","svelte-e37zij"),x(C,"class","step svelte-e37zij"),x(N,"class","steps-display svelte-e37zij"),x(h,"class","play-controls svelte-e37zij"),x(R,"class","parameters-label svelte-e37zij"),x(O,"class","umap-options svelte-e37zij"),x(c,"class","data-controls svelte-e37zij"),x(H,"class","data-description-text svelte-e37zij"),x(ne,"class","parameters-label svelte-e37zij"),x(te,"class","data-options svelte-e37zij"),x(V,"class","data-description svelte-e37zij"),x(l,"class","data-details svelte-e37zij"),x(t,"class","playground svelte-e37zij"),oe=[y(g,"click",e.playPause),y($,"click",e.restart)]},m(o,f){d(o,t,f),u(t,n),u(n,r),e.canvas_1_binding(r),u(t,i),u(t,s);for(let e=0;e<he.length;e+=1)he[e].m(s,null);u(t,a),u(t,l),u(l,c),u(c,h),u(h,g),me.m(g,null),u(h,w),u(h,$),u($,P),u(h,I),u(h,N),u(N,j),u(N,S),u(N,_),u(N,C),u(C,A),u(c,E),u(c,O),u(O,R),u(O,D),Q(ve,O,null),u(O,U),Q(ye,O,null),u(l,q),u(l,V),u(V,H),u(H,Y),u(V,ee),u(V,te),u(te,ne),u(te,re);for(let e=0;e<ae.length;e+=1)ae[e].m(te,null);ie=!0},p(e,t){if(e.demos||e.handlePreviewClick||e.selectedDemoIndex){let n;for(ce=br,n=0;n<ce.length;n+=1){const r=Ho(t,ce,n);he[n]?(he[n].p(e,r),B(he[n],1)):(he[n]=Wo(r),he[n].c(),B(he[n],1),he[n].m(s,null))}for(W(),n=ce.length;n<he.length;n+=1)ue(n);G()}fe!==(fe=de(0,t))&&(me.d(1),(me=fe(t))&&(me.c(),me.m(g,null))),ie&&!e.isFinished||(g.disabled=t.isFinished),ie&&!e.isRunning&&!e.step||k===(k=t.isRunning||0===t.step)||($.disabled=k),ie&&!e.step||M(A,t.step);var n={};!L&&e.nNeighbors&&(n.value=t.nNeighbors),ve.$set(n);var r={};!F&&e.minDist&&(r.value=t.minDist),ye.$set(r),ie&&!e.demo||se===(se=t.demo.description+"")||M(Y,se);const i=t.demo.options;W(),ae=function(e,t,n,r,i,o,s,a,l,c,h,u){let d=e.length,f=o.length,m=d;const p={};for(;m--;)p[e[m].key]=m;const g=[],v=new Map,b=new Map;for(m=f;m--;){const e=u(i,o,m),a=n(e);let l=s.get(a);l?r&&l.p(t,e):(l=c(a,e)).c(),v.set(a,g[m]=l),a in p&&b.set(a,Math.abs(m-p[a]))}const w=new Set,y=new Set;function x(e){B(e,1),e.m(a,h),s.set(e.key,e),h=e.first,f--}for(;d&&f;){const t=g[f-1],n=e[d-1],r=t.key,i=n.key;t===n?(h=t.first,d--,f--):v.has(i)?!s.has(r)||w.has(r)?x(t):y.has(i)?d--:b.get(r)>b.get(i)?(y.add(r),x(t)):(w.add(i),d--):(l(n,s),d--)}for(;d--;){const t=e[d];v.has(t.key)||l(t,s)}for(;f;)x(g[f-1]);return g}(ae,e,Me,1,t,i,le,te,K,Jo,null,Vo),G()},i(e){if(!ie){for(let e=0;e<ce.length;e+=1)B(he[e]);B(ve.$$.fragment,e),B(ye.$$.fragment,e);for(let e=0;e<xe.length;e+=1)B(ae[e]);ie=!0}},o(e){he=he.filter(Boolean);for(let e=0;e<he.length;e+=1)J(he[e]);J(ve.$$.fragment,e),J(ye.$$.fragment,e);for(let e=0;e<ae.length;e+=1)J(ae[e]);ie=!1},d(n){n&&f(t),e.canvas_1_binding(null),m(he,n),me.d(),Z(ve),Z(ye);for(let e=0;e<ae.length;e+=1)ae[e].d();o(oe)}}}let Xo=3,Qo=100,Zo=0,Yo=1;function es(e,t,n){let r,i,o=!1,s=!1,a=0,l=0,c=[],h=br[l],u=0,d=15,f=.1;const m=()=>{i&&i.pause(),n("isRunning",o=!0),n("isFinished",s=!1),d>=c.length&&n("nNeighbors",d=c.length-1),i=function(e,t,n,r){const i={};let o,s=!1,a=0,l=5;const c=e.map(e=>e.coords),h=new bi({nEpochs:Oo,...n});function u(){if(s)return;for(let e=0;e<l;e++)h.step(),++a;r(a),Pr(h.getEmbedding().map((t,n)=>new cr(t,e[n].color)),t,"");const n=Ro(a);setTimeout(function(){o=window.requestAnimationFrame(u)},n)}return h.initializeFit(c),i.pause=function(){s||(s=!0,window.cancelAnimationFrame(o))},i.unpause=function(){s&&(s=!1,u())},i.paused=function(){return s},i.destroy=function(){i.pause()},u(),i}(c,r,{nNeighbors:d,minDist:f},e=>{n("step",u=e),u>=Oo&&(n("isRunning",o=!1),n("isFinished",s=!0),i.pause())})};return j(()=>{Pr(c=xr(h),r,null,null)}),S(()=>{n("demo",h=br[l]),c=xr(h),a!==l&&(m(),a=l)}),{isRunning:o,isFinished:s,selectedDemoIndex:l,demo:h,step:u,canvas:r,nNeighbors:d,minDist:f,handlePreviewClick:e=>()=>{n("selectedDemoIndex",l=e),n("demo",h=br[l])},playPause:()=>{o&&i?(i.pause(),n("isRunning",o=!o)):!o&&i?(i.unpause(),n("isRunning",o=!o)):o||i||m()},restart:()=>{m()},canvas_1_binding:function(e){z[e?"unshift":"push"](()=>{n("canvas",r=e)})},parameter0_value_binding:function(e){n("nNeighbors",d=e)},parameter1_value_binding:function(e){n("minDist",f=e)},parameter_value_binding:function(e,{demoOption:t}){t.start=e,n("demo",h)}}}class ts extends te{constructor(e){super(),ee(this,e,es,Ko,a,[])}}const ns=new Map;async function rs(){const e=await fetch("toy_comparison_encoded.json"),t=await e.json();return t.map((e,t)=>(Object.keys(e).forEach(n=>{const r=e[n],i={};Object.keys(r).forEach(e=>{Object.defineProperty(i,e,{get:function(){const i=`${n}:${t}:${e}`;if(ns.has(i))return ns.get(i);const o=r[e],{data:s,length:a,nDimensions:l,ranges:c}=o,h=Zn(atob(s)),u=Qn(h,l*a,tr),d=[],[f,m]=c,{min:p,max:g}=f,{min:v,max:b}=m,w=2**tr;for(let e=0;e<u.length;e+=2){const t=u[e]/w*(g-p)+p,n=u[e+1]/w*(b-v)+v;d.push([t,n])}return ns.set(i,d),d},enumerable:!0})}),e[n]=i}),e))}function is(e){var t,n,r,i;return{c(){x(t=g("circle"),"r","5"),x(t,"fill","none"),x(t,"stroke","#000"),x(t,"stroke-width","2"),x(t,"opacity",n=e.hoveredPointIndex>-1?1:0),x(t,"cx",r=e.points[e.hoveredPointIndex].px),x(t,"cy",i=e.points[e.hoveredPointIndex].py)},m(e,n){d(e,t,n)},p(e,o){e.hoveredPointIndex&&n!==(n=o.hoveredPointIndex>-1?1:0)&&x(t,"opacity",n),(e.points||e.hoveredPointIndex)&&r!==(r=o.points[o.hoveredPointIndex].px)&&x(t,"cx",r),(e.points||e.hoveredPointIndex)&&i!==(i=o.points[o.hoveredPointIndex].py)&&x(t,"cy",i)},d(e){e&&f(t)}}}function os(e){var n,r,i,s,a,l,c,h=e.points[e.hoveredPointIndex]&&e.points[e.hoveredPointIndex].px&&is(e);return{c(){n=p("div"),r=p("canvas"),i=b(),s=g("svg"),h&&h.c(),x(r,"width",e.size),x(r,"height",e.size),x(r,"class","svelte-1nzy8y"),x(s,"viewBox",a="0 0 "+e.size+" "+e.size),x(s,"class","svelte-1nzy8y"),x(n,"class",l="demo-data "+(e.selected?"selected":"")+"\n  "+(e.highlighted?"highlighted":"")+"\n  "+(e.selectable?"":"non-selectable")+" svelte-1nzy8y"),c=[y(r,"mousemove",e.handleMousemove),y(n,"click",e.onClick)]},m(t,o){d(t,n,o),u(n,r),e.canvas_1_binding(r),u(n,i),u(n,s),h&&h.m(s,null),e.svg_1_binding(s)},p(e,t){e.size&&(x(r,"width",t.size),x(r,"height",t.size)),t.points[t.hoveredPointIndex]&&t.points[t.hoveredPointIndex].px?h?h.p(e,t):((h=is(t)).c(),h.m(s,null)):h&&(h.d(1),h=null),e.size&&a!==(a="0 0 "+t.size+" "+t.size)&&x(s,"viewBox",a),(e.selected||e.highlighted||e.selectable)&&l!==(l="demo-data "+(t.selected?"selected":"")+"\n  "+(t.highlighted?"highlighted":"")+"\n  "+(t.selectable?"":"non-selectable")+" svelte-1nzy8y")&&x(n,"class",l)},i:t,o:t,d(t){t&&f(n),e.canvas_1_binding(null),h&&h.d(),e.svg_1_binding(null),o(c)}}}function ss(e,t,n){const r=_();let i,o,{points:s,onClick:a,selected:l,hoveredPointIndex:c=-1,selectable:h=!0,highlighted:u=!1,size:d=200}=t;j(()=>{Pr(s,i,null,null)});let f=null;return S(()=>{s!=f&&(f=s,Pr(s,i,null,null))}),e.$set=(e=>{"points"in e&&n("points",s=e.points),"onClick"in e&&n("onClick",a=e.onClick),"selected"in e&&n("selected",l=e.selected),"hoveredPointIndex"in e&&n("hoveredPointIndex",c=e.hoveredPointIndex),"selectable"in e&&n("selectable",h=e.selectable),"highlighted"in e&&n("highlighted",u=e.highlighted),"size"in e&&n("size",d=e.size)}),{points:s,onClick:a,selected:l,hoveredPointIndex:c,selectable:h,highlighted:u,size:d,handleMousemove:function(){var e=d/i.offsetWidth,t=event.layerX*e,n=event.layerY*e;if(s||!s.length){var o=1/0,a=0;s.forEach((e,r)=>{var i=e.px-t,s=e.py-n,l=i*i+s*s;l<o&&(o=l,a=r)}),r("hover",a)}},canvas:i,svg:o,canvas_1_binding:function(e){z[e?"unshift":"push"](()=>{n("canvas",i=e)})},svg_1_binding:function(e){z[e?"unshift":"push"](()=>{n("svg",o=e)})}}}class as extends te{constructor(e){super(),ee(this,e,ss,os,a,["points","onClick","selected","hoveredPointIndex","selectable","highlighted","size"])}}function ls(e,t,n){const r=Object.create(e);return r.option=t[n],r}function cs(e,t,n){const r=Object.create(e);return r.demo=t[n],r.i=n,r}function hs(e,t,n){const r=Object.create(e);return r.group=t[n],r.groupIndex=n,r}function us(e,t,n){const r=Object.create(e);return r.points=t[n],r}function ds(e,t,n){const r=Object.create(e);return r.key=t[n],r}function fs(e,t,n){const r=Object.create(e);return r.nNeighbors=t[n],r}function ms(e){var n;return{c(){(n=p("div")).textContent="Loading..."},m(e,t){d(e,n,t)},p:t,i:t,o:t,d(e){e&&f(n)}}}function ps(e){var t,n,r,i,o,s,a,l,c,h,g,w,y,$,P,k,I,N,j,S,_=e.selectedDemo.description+"";let C=e.nNeighborsOptions,A=[];for(let t=0;t<C.length;t+=1)A[t]=gs(fs(e,C,t));let z=Object.keys(e.entries),E=[];for(let t=0;t<z.length;t+=1)E[t]=bs(ds(e,z,t));const O=e=>J(E[e],1,1,()=>{E[e]=null});let R=e.groupDemos(Ps),D=[];for(let t=0;t<R.length;t+=1)D[t]=ys(hs(e,R,t));const L=e=>J(D[e],1,1,()=>{D[e]=null});let T=e.selectedDemo.options,U=[];for(let t=0;t<T.length;t+=1)U[t]=xs(ls(e,T,t));return{c(){t=p("div"),n=p("div"),(r=p("div")).innerHTML='<div class="left-column-spacer svelte-1tf9l5v"></div> <div class="left-column-content svelte-1tf9l5v"><div class="left-column-labels svelte-1tf9l5v"><div>t-SNE</div> <div>UMAP</div></div></div>',i=b(),o=p("div"),s=p("div"),(a=p("div")).textContent="perplexity / n_neighbors",l=b(),c=p("div");for(let e=0;e<A.length;e+=1)A[e].c();h=b(),g=p("div");for(let e=0;e<E.length;e+=1)E[e].c();w=b(),y=p("div"),$=p("div");for(let e=0;e<D.length;e+=1)D[e].c();P=b(),k=p("div"),I=p("div"),N=v(_),j=b();for(let e=0;e<U.length;e+=1)U[e].c();x(r,"class","left-column svelte-1tf9l5v"),x(a,"class","hyperparam-header svelte-1tf9l5v"),x(c,"class","hyperparam-labels svelte-1tf9l5v"),x(g,"class","rows svelte-1tf9l5v"),x(s,"class","rows-container svelte-1tf9l5v"),x(o,"class","right-column"),x(n,"class","figures-container svelte-1tf9l5v"),x($,"class","demo-select svelte-1tf9l5v"),x(I,"class","demo-text svelte-1tf9l5v"),x(k,"class","demo-description svelte-1tf9l5v"),x(y,"class","menu svelte-1tf9l5v"),x(t,"class","container svelte-1tf9l5v")},m(e,f){d(e,t,f),u(t,n),u(n,r),u(n,i),u(n,o),u(o,s),u(s,a),u(s,l),u(s,c);for(let e=0;e<A.length;e+=1)A[e].m(c,null);u(s,h),u(s,g);for(let e=0;e<E.length;e+=1)E[e].m(g,null);u(t,w),u(t,y),u(y,$);for(let e=0;e<D.length;e+=1)D[e].m($,null);u(y,P),u(y,k),u(k,I),u(I,N),u(k,j);for(let e=0;e<U.length;e+=1)U[e].m(k,null);S=!0},p(e,t){if(e.nNeighborsOptions){let n;for(C=t.nNeighborsOptions,n=0;n<C.length;n+=1){const r=fs(t,C,n);A[n]?A[n].p(e,r):(A[n]=gs(r),A[n].c(),A[n].m(c,null))}for(;n<A.length;n+=1)A[n].d(1);A.length=C.length}if(e.entries||e.hoveredPointIndex){let n;for(z=Object.keys(t.entries),n=0;n<z.length;n+=1){const r=ds(t,z,n);E[n]?(E[n].p(e,r),B(E[n],1)):(E[n]=bs(r),E[n].c(),B(E[n],1),E[n].m(g,null))}for(W(),n=z.length;n<E.length;n+=1)O(n);G()}if(e.groupDemos||e.GROUP_SIZE||e.getDemoPreviewOverride||e.getPoints||e.handlePreviewClick||e.selectedDemoIndex){let n;for(R=t.groupDemos(Ps),n=0;n<R.length;n+=1){const r=hs(t,R,n);D[n]?(D[n].p(e,r),B(D[n],1)):(D[n]=ys(r),D[n].c(),B(D[n],1),D[n].m($,null))}for(W(),n=R.length;n<D.length;n+=1)L(n);G()}if(S&&!e.selectedDemo||_===(_=t.selectedDemo.description+"")||M(N,_),e.selectedDemo){let n;for(T=t.selectedDemo.options,n=0;n<T.length;n+=1){const r=ls(t,T,n);U[n]?U[n].p(e,r):(U[n]=xs(r),U[n].c(),U[n].m(k,null))}for(;n<U.length;n+=1)U[n].d(1);U.length=T.length}},i(e){if(!S){for(let e=0;e<z.length;e+=1)B(E[e]);for(let e=0;e<R.length;e+=1)B(D[e]);S=!0}},o(e){E=E.filter(Boolean);for(let e=0;e<E.length;e+=1)J(E[e]);D=D.filter(Boolean);for(let e=0;e<D.length;e+=1)J(D[e]);S=!1},d(e){e&&f(t),m(A,e),m(E,e),m(D,e),m(U,e)}}}function gs(e){var n,r,i=e.nNeighbors+"";return{c(){n=p("div"),r=v(i)},m(e,t){d(e,n,t),u(n,r)},p:t,d(e){e&&f(n)}}}function vs(e){var t,n=new as({props:{points:e.points,hoveredPointIndex:e.hoveredPointIndex,onClick:ks,highlighted:!0,selectable:!1,selected:!1}});return n.$on("hover",e.hover_handler),{c(){n.$$.fragment.c()},m(e,r){Q(n,e,r),t=!0},p(e,t){var r={};e.entries&&(r.points=t.points),e.hoveredPointIndex&&(r.hoveredPointIndex=t.hoveredPointIndex),n.$set(r)},i(e){t||(B(n.$$.fragment,e),t=!0)},o(e){J(n.$$.fragment,e),t=!1},d(e){Z(n,e)}}}function bs(e){var t,n,r;let i=e.entries[e.key],o=[];for(let t=0;t<i.length;t+=1)o[t]=vs(us(e,i,t));const s=e=>J(o[e],1,1,()=>{o[e]=null});return{c(){t=p("div");for(let e=0;e<o.length;e+=1)o[e].c();n=b(),x(t,"class","row svelte-1tf9l5v")},m(e,i){d(e,t,i);for(let e=0;e<o.length;e+=1)o[e].m(t,null);u(t,n),r=!0},p(e,r){if(e.entries||e.hoveredPointIndex){let a;for(i=r.entries[r.key],a=0;a<i.length;a+=1){const s=us(r,i,a);o[a]?(o[a].p(e,s),B(o[a],1)):(o[a]=vs(s),o[a].c(),B(o[a],1),o[a].m(t,n))}for(W(),a=i.length;a<o.length;a+=1)s(a);G()}},i(e){if(!r){for(let e=0;e<i.length;e+=1)B(o[e]);r=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)J(o[e]);r=!1},d(e){e&&f(t),m(o,e)}}}function ws(e){var t,n=new as({props:{points:e.demo.previewOverride?Mr(e.demo):xr(e.demo),onClick:e.handlePreviewClick(e.groupIndex*Ps+e.i),selected:e.groupIndex*Ps+e.i===e.selectedDemoIndex}});return{c(){n.$$.fragment.c()},m(e,r){Q(n,e,r),t=!0},p(e,t){var r={};e.selectedDemoIndex&&(r.selected=t.groupIndex*Ps+t.i===t.selectedDemoIndex),n.$set(r)},i(e){t||(B(n.$$.fragment,e),t=!0)},o(e){J(n.$$.fragment,e),t=!1},d(e){Z(n,e)}}}function ys(e){var t,n,r;let i=e.group,o=[];for(let t=0;t<i.length;t+=1)o[t]=ws(cs(e,i,t));const s=e=>J(o[e],1,1,()=>{o[e]=null});return{c(){t=p("div");for(let e=0;e<o.length;e+=1)o[e].c();n=b(),x(t,"class","demos svelte-1tf9l5v")},m(e,i){d(e,t,i);for(let e=0;e<o.length;e+=1)o[e].m(t,null);u(t,n),r=!0},p(e,r){if(e.groupDemos||e.GROUP_SIZE||e.getDemoPreviewOverride||e.getPoints||e.handlePreviewClick||e.selectedDemoIndex){let a;for(i=r.group,a=0;a<i.length;a+=1){const s=cs(r,i,a);o[a]?(o[a].p(e,s),B(o[a],1)):(o[a]=ws(s),o[a].c(),B(o[a],1),o[a].m(t,n))}for(W(),a=i.length;a<o.length;a+=1)s(a);G()}},i(e){if(!r){for(let e=0;e<i.length;e+=1)B(o[e]);r=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)J(o[e]);r=!1},d(e){e&&f(t),m(o,e)}}}function xs(e){var t,n,r,i,o,s,a,l,c=e.option.name+"",h=e.option.start+"";return{c(){t=p("div"),n=p("span"),r=v(c),i=v(":"),o=b(),s=p("span"),a=v(h),l=b(),x(n,"class","demo-parameter-name svelte-1tf9l5v"),x(t,"class","demo-parameters")},m(e,c){d(e,t,c),u(t,n),u(n,r),u(n,i),u(t,o),u(t,s),u(s,a),u(t,l)},p(e,t){e.selectedDemo&&c!==(c=t.option.name+"")&&M(r,c),e.selectedDemo&&h!==(h=t.option.start+"")&&M(a,h)},d(e){e&&f(t)}}}function Ms(e){var t,n,r,i,o=[ps,ms],s=[];function a(e,t){return t.isLoaded?0:1}return t=a(0,e),n=s[t]=o[t](e),{c(){n.c(),r=w()},m(e,n){s[t].m(e,n),d(e,r,n),i=!0},p(e,i){var l=t;(t=a(0,i))===l?s[t].p(e,i):(W(),J(s[l],1,1,()=>{s[l]=null}),G(),(n=s[t])||(n=s[t]=o[t](i)).c(),B(n,1),n.m(r.parentNode,r))},i(e){i||(B(n),i=!0)},o(e){J(n),i=!1},d(e){s[t].d(e),e&&f(r)}}}const $s=11,Ps=8,ks=()=>{};function Is(e,t,n){let r,i,o=!1,s=$s,a=yr[s],l=-1,c=xr(a);const h=[3,5,15,30,50,100],u=[3,5,15,30,50,100],d=e=>{n("selectedDemoIndex",s=e),n("selectedDemo",a=yr[s]),c=xr(a);const t=(()=>({tsne:h.map(()=>[]),umap:h.map(()=>[])}))(),o=r[s],{tsne:l,umap:d}=o;for(let e in d){const n=d[e],r=1*e.replace("nNeighbors=","").split(",")[0],i=h.indexOf(r);t.umap[i]=n.map(([e,t],n)=>({coords:[e,t],color:c[n].color}))}for(let e in l){const n=l[e],r=1*e.replace("perplexity=","").split(",")[0],i=u.indexOf(r);t.tsne[i]=n.map(([e,t],n)=>({coords:[e,t],color:c[n].color}))}n("entries",i=t)};j(async()=>{r=await rs(),d($s),n("isLoaded",o=!0)});return{isLoaded:o,selectedDemoIndex:s,selectedDemo:a,hoveredPointIndex:l,entries:i,nNeighborsOptions:h,groupDemos:e=>{const t=[],n=Math.ceil(yr.length/e);for(let r=0;r<n;r++)t.push(yr.slice(e*r,e*(r+1)));return t},handlePreviewClick:e=>()=>{d(e)},hover_handler:e=>n("hoveredPointIndex",l=e.detail)}}class Ns extends te{constructor(e){super(),ee(this,e,Is,Ms,a,[])}}function js(e){var t,n,r;const i=e.$$slots.default,o=l(i,e,null);return{c(){t=p("section"),n=p("div"),o&&o.c(),x(n,"class","container svelte-1f7sbq8"),x(t,"class","svelte-1f7sbq8")},l(e){o&&o.l(div_nodes)},m(e,i){d(e,t,i),u(t,n),o&&o.m(n,null),r=!0},p(e,t){o&&o.p&&e.$$scope&&o.p(h(i,t,e,null),c(i,t,null))},i(e){r||(B(o,e),r=!0)},o(e){J(o,e),r=!1},d(e){e&&f(t),o&&o.d(e)}}}function Ss(e,t,n){let{$$slots:r={},$$scope:i}=t;return e.$set=(e=>{"$$scope"in e&&n("$$scope",i=e.$$scope)}),{$$slots:r,$$scope:i}}class _s extends te{constructor(e){super(),ee(this,e,Ss,js,a,[])}}function Cs(e){var t;return{c(){(t=p("span")).innerHTML='<span class="figure-number">Figure 1: </span>Apply UMAP projection to various toy datasets, powered by <a href="https://github.com/PAIR-code/umap-js" target="new">umap-js</a>.\n\t\t\t  ',x(t,"slot","caption")},m(e,n){d(e,t,n)},d(e){e&&f(t)}}}function As(e){var n,r,i=new ts({});return{c(){i.$$.fragment.c(),n=b()},m(e,t){Q(i,e,t),d(e,n,t),r=!0},p:t,i(e){r||(B(i.$$.fragment,e),r=!0)},o(e){J(i.$$.fragment,e),r=!1},d(e){Z(i,e),e&&f(n)}}}function zs(e){var t;return{c(){(t=p("span")).innerHTML='<span class="figure-number">Figure 2: </span>Dimensionality reduction applied to the Fashion MNIST dataset. 28x28 images of clothing items in 10 categories are encoded as 784-dimensional vectors and then projected to 3 using UMAP and t-SNE.\n\t\t\t  ',x(t,"slot","caption")},m(e,n){d(e,t,n)},d(e){e&&f(t)}}}function Es(e){var n,r,i=new Kn({});return{c(){i.$$.fragment.c(),n=b()},m(e,t){Q(i,e,t),d(e,n,t),r=!0},p:t,i(e){r||(B(i.$$.fragment,e),r=!0)},o(e){J(i.$$.fragment,e),r=!1},d(e){Z(i,e),e&&f(n)}}}function Os(e){var t;return{c(){(t=p("span")).innerHTML='<span class="figure-number">Figure 3: </span>Adjust the slider to extend a radius outwards from each point, computed by the distance to its nth nearest neighbor. Notice that past the intersection with the first neighbor, the radius begins to get fuzzy, with subsequent connections appearing with less weight;\n\t\t\t  ',x(t,"slot","caption")},m(e,n){d(e,t,n)},d(e){e&&f(t)}}}function Rs(e){var n,r,i=new Mn({});return{c(){i.$$.fragment.c(),n=b()},m(e,t){Q(i,e,t),d(e,n,t),r=!0},p:t,i(e){r||(B(i.$$.fragment,e),r=!0)},o(e){J(i.$$.fragment,e),r=!1},d(e){Z(i,e),e&&f(n)}}}function Ds(e){var t;return{c(){(t=p("span")).innerHTML='<span class="figure-number">Figure 4: </span>\n\t\t\t    UMAP projection of various toy datasets with a variety of common values for the <code>n_neighbors</code> and <code>min_dist</code> parameters.\n\t\t\t  ',x(t,"slot","caption")},m(e,n){d(e,t,n)},d(e){e&&f(t)}}}function Ls(e){var n,r,i=new Li({});return{c(){i.$$.fragment.c(),n=b()},m(e,t){Q(i,e,t),d(e,n,t),r=!0},p:t,i(e){r||(B(i.$$.fragment,e),r=!0)},o(e){J(i.$$.fragment,e),r=!1},d(e){Z(i,e),e&&f(n)}}}function Ts(e){var t;return{c(){(t=p("span")).innerHTML='<span class="figure-number">Figure 5: </span>\n\t\t\t    UMAP projections of a 3D woolly mammoth skeleton (50k points, 10k shown) into 2 dimensions, with various settings for the <code>n_neighbors</code> and <code>min_dist</code> parameters.\n\t\t\t  ',x(t,"slot","caption")},m(e,n){d(e,t,n)},d(e){e&&f(t)}}}function Us(e){var n,r,i=new $o({});return{c(){i.$$.fragment.c(),n=b()},m(e,t){Q(i,e,t),d(e,n,t),r=!0},p:t,i(e){r||(B(i.$$.fragment,e),r=!0)},o(e){J(i.$$.fragment,e),r=!1},d(e){Z(i,e),e&&f(n)}}}function Fs(e){var t;return{c(){(t=p("span")).innerHTML='<span class="figure-number">Figure 6: </span>\n\t\t\t    A comparison between UMAP and t-SNE projections of a 3D woolly mammoth skeleton (50,000 points) into 2 dimensions, with various settings for parameters. Notice how much more global structure is preserved with UMAP, particularly with larger values of <code>n_neighbors</code>.\n\t\t\t  ',x(t,"slot","caption")},m(e,n){d(e,t,n)},d(e){e&&f(t)}}}function qs(e){var n,r,i=new Eo({});return{c(){i.$$.fragment.c(),n=b()},m(e,t){Q(i,e,t),d(e,n,t),r=!0},p:t,i(e){r||(B(i.$$.fragment,e),r=!0)},o(e){J(i.$$.fragment,e),r=!1},d(e){Z(i,e),e&&f(n)}}}function Vs(e){var t;return{c(){(t=p("span")).innerHTML='<span class="figure-number">Figure 7: </span>\n\t\t\t    Comparison between UMAP and t-SNE projecting various toy datasets.\n\t\t\t  ',x(t,"slot","caption")},m(e,n){d(e,t,n)},d(e){e&&f(t)}}}function Hs(e){var n,r,i=new Ns({});return{c(){i.$$.fragment.c(),n=b()},m(e,t){Q(i,e,t),d(e,n,t),r=!0},p:t,i(e){r||(B(i.$$.fragment,e),r=!0)},o(e){J(i.$$.fragment,e),r=!1},d(e){Z(i,e),e&&f(n)}}}function Ws(e){var t,n,r,i,o,s,a,l,c,h,m,g,w,y,M,$,P,k,I,N,j,S,_,C,A,z,E,O,R,D,L,T,U,F,q,V,H,W,G,K,X,Y,ee,te,ne,re,ie,oe,ae,le,he,ue,fe,me,pe,ge,ve,be,we,ye,xe,Me,$e,Pe,ke,Ie,Ne,je,Se,_e,Ce,Ae,ze,Ee,Oe,Re,De,Le,Te,Ue,Fe,qe,Ve,He,We,Ge,Be,Je,Ke,Xe,Qe,Ze,Ye,et=new ce({props:{height:20}}),tt=new se({props:{$$slots:{default:[As],caption:[Cs]},$$scope:{ctx:e}}}),nt=new de({props:{label:"sandal"}}),rt=new de({props:{label:"sneaker"}}),it=new de({props:{label:"ankle boot"}}),ot=new se({props:{$$slots:{default:[Es],caption:[zs]},$$scope:{ctx:e}}}),st=new se({props:{$$slots:{default:[Rs],caption:[Os]},$$scope:{ctx:e}}}),at=new se({props:{$$slots:{default:[Ls],caption:[Ds]},$$scope:{ctx:e}}}),lt=new se({props:{$$slots:{default:[Us],caption:[Ts]},$$scope:{ctx:e}}}),ct=new se({props:{$$slots:{default:[qs],caption:[Fs]},$$scope:{ctx:e}}}),ht=new se({props:{$$slots:{default:[Hs],caption:[Vs]},$$scope:{ctx:e}}}),ut=new ce({props:{height:200}});return{c(){(t=p("h1")).textContent="Understanding UMAP",n=b(),(r=p("p")).innerHTML='<em>Andy Coenen, Adam Pearce</em> | <em><a href="https://ai.google/research/teams/brain/pair">Google PAIR</a></em>',i=b(),et.$$.fragment.c(),o=b(),(s=p("p")).innerHTML='Dimensionality reduction is a powerful tool for machine learning practitioners to visualize and understand large, high dimensional datasets. One of the most widely used techniques for visualization is <a href="https://lvdmaaten.github.io/tsne/">t-SNE</a>, but its performance suffers with large datasets and using it correctly can be <a href="https://distill.pub/2016/misread-tsne/">challenging</a>.',a=b(),(l=p("p")).innerHTML="<a href=\"https://github.com/lmcinnes/umap\">UMAP</a> is a new technique by McInnes et al. that offers a number of advantages over t-SNE, most notably increased speed and better preservation of the data's global structure. In this article, we'll take a look at the theory behind UMAP in order to better understand how the algorithm works, how to use it effectively, and how its performance compares with t-SNE.",c=b(),tt.$$.fragment.c(),h=b(),(m=p("p")).innerHTML="So what does UMAP bring to the table? Most importantly, UMAP is fast, scaling well in terms of both dataset size and dimensionality. For example, UMAP can project the 784-dimensional, 70,000-point <a href=\"http://yann.lecun.com/exdb/mnist/\">MNIST</a> dataset in less than 3 minutes, compared to 45 minutes for scikit-learn's t-SNE implementation. Additionally, UMAP tends to better preserve the global structure of the data. This can be attributed to UMAP's strong theoretical foundations, which allow the algorithm to better strike a balance between emphasizing local versus global structure.",g=b(),(w=p("h2")).textContent="UMAP vs t-SNE, at first glance",y=b(),M=p("p"),$=v("Before diving into the theory behind UMAP, let's take a look at how it performs on real-world, high-dimensional data. The following visualization shows a comparison between using UMAP and t-SNE to project a subset of the 784-dimensional "),(P=p("a")).textContent="Fashion MNIST",k=v(" dataset down to 3 dimensions. Notice how well clustered each different category is (local structure), while similar categories (such as "),nt.$$.fragment.c(),I=v(", "),rt.$$.fragment.c(),N=v(", and "),it.$$.fragment.c(),j=v(") tend to colocate (global structure)."),S=b(),ot.$$.fragment.c(),_=b(),(C=p("p")).textContent="While both algorithms exhibit strong local clustering and group similar categories together, UMAP much more clearly separates these groups of similar categories from each other. It's also worth noting that UMAP projection of the dataset took 4 minutes in comparison to 27 minutes with multicore t-SNE.",A=b(),(z=p("h2")).textContent="A dip into UMAP theory",E=b(),(O=p("p")).textContent="UMAP, at its core, works very similarly to t-SNE - both use graph layout algorithms to arrange data in low-dimensional space. In the simplest sense, UMAP constructs a high dimensional graph representation of the data then optimizes a low-dimensional graph to be as structurally similar as possible. While the mathematics UMAP uses to construct the high-dimensional graph is advanced, the intuition behind them is remarkably simple.",R=b(),(D=p("p")).innerHTML='In order to construct the initial high-dimensional graph, UMAP builds something called a "fuzzy simplicial complex". This is really just a representation of a weighted graph, with edge weights representing the likelihood that two points are connected. To determine connectedness, UMAP extends a radius outwards from each point, connecting points when those radii overlap. Choosing this radius is critical - too small a choice will lead to small, isolated clusters, while too large a choice will connect everything together. UMAP overcomes this challenge by choosing a radius locally, based on the distance to each point\'s <em>n</em>th nearest neighbor. UMAP then makes the graph "fuzzy" by decreasing the likelihood of connection as the radius grows. Finally, by stipulating that each point must be connected to at least its closest neighbor, UMAP ensures that local structure is preserved in balance with global structure.',L=b(),st.$$.fragment.c(),T=b(),(U=p("p")).textContent="Once the high-dimensional graph is constructed, UMAP optimizes the layout of a low-dimensional analogue to be as similar as possible. This process is essentially the same as in t-SNE, but using a few clever tricks to speed up the process.",F=b(),(q=p("p")).innerHTML='The key to effectively using UMAP lies in understanding the construction of the initial, high-dimensional graph. Though the ideas behind the process are very intuitive, the algorithm relies on some advanced mathematics to give strong theoretical guarantees about how well this graph actually represents the data. Interested readers can dive deeper into the entire process in the supplementary section: <a href="/supplement.html">A deeper dive into UMAP theory</a>.',V=b(),(H=p("h2")).textContent="UMAP Parameters",W=b(),(G=p("p")).innerHTML="By understanding the theory behind UMAP, it becomes much easier to understand the algorithm's parameters, especially compared with the <code>perplexity</code> parameter in t-SNE. We'll consider the two most commonly used parameters: <code>n_neighbors</code> and <code>min_dist</code>, which are effectively used to control the balance between local and global structure in the final projection.",K=b(),at.$$.fragment.c(),X=b(),(Y=p("p")).innerHTML="The most important parameter is <code>n_neighbors</code> - the number of approximate nearest neighbors used to construct the initial high-dimensional graph. It effectively controls how UMAP balances local versus global structure - low values will push UMAP to focus more on local structure by constraining the number of neighboring points considered when analyzing the data in high dimensions, while high values will push UMAP towards representing the big-picture structure while losing fine detail.",ee=b(),(te=p("p")).innerHTML="The second parameter we’ll investigate is <code>min_dist</code>, or the minimum distance between points in low-dimensional space. This parameter controls how tightly UMAP clumps points together, with low values leading to more tightly packed embeddings. Larger values of <code>min_dist</code> will make UMAP pack points together more loosely, focusing instead on the preservation of the broad topological structure.",ne=b(),(re=p("p")).innerHTML='The following visualization - extended from excellent work by <a href="https://homepage.univie.ac.at/noichlm94/">Max Noichl</a> - is an exploration of the impact of UMAP parameters on a 2D projection of 3D data. By changing the <code>n_neighbors</code> and <code>min_dist</code> parameters, you can explore their impact on the resulting projection.',ie=b(),lt.$$.fragment.c(),oe=b(),(ae=p("p")).innerHTML='While most applications of UMAP involve projection from high-dimensional data, the projection from 3D serves as a useful analogy to understand how UMAP prioritizes global vs local structure depending on its parameters. As <code>n_neighbors</code> increases, UMAP connects more and more neighboring points when constructing the graph representation of the high-dimensional data, which leads to a projection that more accurately reflects the global structure of the data. At very low values, any notion of global structure is almost completely lost. As the <code>min_dist</code> parameter increases, UMAP tends to "spread out" the projected points, leading to decreased clustering of the data and less emphasis on global structure.',le=b(),(he=p("h2")).textContent="UMAP vs t-SNE, revisited",ue=b(),(fe=p("p")).textContent="The biggest difference between the the output of UMAP when compared with t-SNE is this balance between local and global structure - UMAP is often better at preserving global structure in the final projection. This means that the inter-cluster relations are potentially more meaningful than in t-SNE. However, it's important to note that, because UMAP and t-SNE both necessarily warp the high-dimensional shape of the data when projecting to lower dimensions, any given axis or distance in lower dimensions still isn’t directly interpretable in the way of techniques such as PCA.",me=b(),ct.$$.fragment.c(),pe=b(),(ge=p("p")).innerHTML="Going back to the 3D mammoth example, we can easily see some big differences between the two algorithms' output. For lower values of the <code>perplexity</code> parameter, t-SNE tends to \"spread out\" the projected data with very little preservation of the global structure. In contrast, UMAP tends to group adjacent pieces of the higher-dimensional structure together in low dimensions, which reflects an increased preservation of global structure. Note that, using t-SNE, it takes an extremely high perplexity (~1000) to begin to see the global structure emerge, and at such large perplexity values the time to compute is dramatically longer. It's also notable that t-SNE projections vary widely from run to run, with different pieces of the higher-dimensional data projected to different locations. While UMAP is also a stochastic algorithm, it's striking how similar the resulting projections are from run to run and with different parameters. This is due, again, to UMAP's increased emphasis on global structure in comparison to t-SNE.",ve=b(),(be=p("p")).textContent="It's worth noting that t-SNE and UMAP wind up performing very similarly on the toy examples from earlier figures, with the notable exception of the following example: A dense, tight cluster inside of a wide, sparse cluster. Interestingly, UMAP is unable to separate the two nested clusters, especially when dimensionality is high.",we=b(),ht.$$.fragment.c(),ye=b(),(xe=p("p")).innerHTML='The failure of the algorithm to handle this case of "containment" may be explained by UMAP\'s use of local distances in the initial graph construction. Since distances between points in high dimensions tend to be very similar (<a href="https://en.wikipedia.org/wiki/Curse_of_dimensionality">the curse of dimensionality</a>), UMAP seems to be connecting the outer points of the inner cluster to those of the outer cluster. This, in effect, blends the two clusters together.',Me=b(),($e=p("h2")).textContent="How to (mis)read UMAP",Pe=b(),(ke=p("p")).innerHTML="While UMAP offers a number of advantages over t-SNE, it's by no means a silver bullet - and reading and understanding its results requires some care. It's worth revisiting our <a href=\"https://distill.pub/2016/misread-tsne/\">previous work on (mis)reading t-SNE</a>, since many of the same takeaways apply to UMAP:",Ie=b(),(Ne=p("h4")).textContent="1. Hyperparameters really matter",je=b(),(Se=p("p")).textContent="Choosing good values isn't easy, and depends on both the data and your goals (eg, how tightly packed the projection ought to be). This is where UMAP's speed is a big advantage - By running UMAP multiple times with a variety of hyperparameters, you can get a better sense of how the projection is affected by its parameters.",_e=b(),(Ce=p("h4")).textContent="2. Cluster sizes in a UMAP plot mean nothing",Ae=b(),(ze=p("p")).textContent="Just as in t-SNE, the size of clusters relative to each other is essentially meaningless. This is because UMAP uses local notions of distance to construct its high-dimensional graph representation.",Ee=b(),(Oe=p("h4")).textContent="3. Distances between clusters might not mean anything",Re=b(),(De=p("p")).textContent="Likewise, the distances between clusters is likely to be meaningless. While it's true that the global positions of clusters are better preserved in UMAP, the distances between them are not meaningful. Again, this is due to using local distances when constructing the graph.",Le=b(),(Te=p("h4")).textContent="4. Random noise doesn’t always look random.",Ue=b(),(Fe=p("p")).innerHTML="Especially at low values of <code>n_neighbors</code>, spurious clustering can be observed.",qe=b(),(Ve=p("h4")).textContent="5. You may need more than one plot",He=b(),(We=p("p")).textContent="Since the UMAP algorithm is stochastic, different runs with the same hyperparameters can yield different results. Additionally, since the choice of hyperparameters is so important, it can be very useful to run the projection multiple times with various hyperparameters.",Ge=b(),(Be=p("h2")).textContent="Conclusion",Je=b(),(Ke=p("p")).textContent="UMAP is an incredibly powerful tool in the data scientist's arsenal, and offers a number of advantages over t-SNE. While both UMAP and t-SNE produce somewhat similar output, the increased speed, better preservation of global structure, and more understandable parameters make UMAP a more effective tool for visualizing high dimensional data. Finally, it's important to remember that no dimensionality reduction technique is perfect - by necessity, we're distorting the data to fit it into lower dimensions - and UMAP is no exception. However, by building up an intuitive understanding of how the algorithm works and understanding how to tune its parameters, we can more effectively use this powerful tool to visualize and understand large, high-dimensional datasets.",Xe=b(),ut.$$.fragment.c(),Qe=b(),(Ze=p("footer")).innerHTML='<h3>Acknowledgements</h3> <section class="acknowledgements"><p>We\'d like to thank <a href="https://homepage.univie.ac.at/noichlm94/">Max Noichl</a> for the delightful mammoth visualization idea, and the <a href="https://3d.si.edu/">Smithsonian Institute</a> for the 3D mammoth model. We\'d also like to thank <a href="https://twitter.com/leland_mcinnes?lang=en">Leland McInnes</a> for his excellent feedback, and of course the UMAP library itself.</p> <p>Source code available on <a href="https://github.com/PAIR-code/understanding-umap">github</a>. Interactive UMAP projections powered by <a href="https://github.com/PAIR-code/umap-js">umap-js</a>. 3D Scatter plots powered by <a href="https://github.com/PAIR-code/scatter-gl">scatter-gl</a>.</p></section>',x(t,"class","article-title"),x(P,"href","https://github.com/zalandoresearch/fashion-mnist")},m(e,f){d(e,t,f),d(e,n,f),d(e,r,f),d(e,i,f),Q(et,e,f),d(e,o,f),d(e,s,f),d(e,a,f),d(e,l,f),d(e,c,f),Q(tt,e,f),d(e,h,f),d(e,m,f),d(e,g,f),d(e,w,f),d(e,y,f),d(e,M,f),u(M,$),u(M,P),u(M,k),Q(nt,M,null),u(M,I),Q(rt,M,null),u(M,N),Q(it,M,null),u(M,j),d(e,S,f),Q(ot,e,f),d(e,_,f),d(e,C,f),d(e,A,f),d(e,z,f),d(e,E,f),d(e,O,f),d(e,R,f),d(e,D,f),d(e,L,f),Q(st,e,f),d(e,T,f),d(e,U,f),d(e,F,f),d(e,q,f),d(e,V,f),d(e,H,f),d(e,W,f),d(e,G,f),d(e,K,f),Q(at,e,f),d(e,X,f),d(e,Y,f),d(e,ee,f),d(e,te,f),d(e,ne,f),d(e,re,f),d(e,ie,f),Q(lt,e,f),d(e,oe,f),d(e,ae,f),d(e,le,f),d(e,he,f),d(e,ue,f),d(e,fe,f),d(e,me,f),Q(ct,e,f),d(e,pe,f),d(e,ge,f),d(e,ve,f),d(e,be,f),d(e,we,f),Q(ht,e,f),d(e,ye,f),d(e,xe,f),d(e,Me,f),d(e,$e,f),d(e,Pe,f),d(e,ke,f),d(e,Ie,f),d(e,Ne,f),d(e,je,f),d(e,Se,f),d(e,_e,f),d(e,Ce,f),d(e,Ae,f),d(e,ze,f),d(e,Ee,f),d(e,Oe,f),d(e,Re,f),d(e,De,f),d(e,Le,f),d(e,Te,f),d(e,Ue,f),d(e,Fe,f),d(e,qe,f),d(e,Ve,f),d(e,He,f),d(e,We,f),d(e,Ge,f),d(e,Be,f),d(e,Je,f),d(e,Ke,f),d(e,Xe,f),Q(ut,e,f),d(e,Qe,f),d(e,Ze,f),Ye=!0},p(e,t){var n={};e.$$scope&&(n.$$scope={changed:e,ctx:t}),tt.$set(n);var r={};e.$$scope&&(r.$$scope={changed:e,ctx:t}),ot.$set(r);var i={};e.$$scope&&(i.$$scope={changed:e,ctx:t}),st.$set(i);var o={};e.$$scope&&(o.$$scope={changed:e,ctx:t}),at.$set(o);var s={};e.$$scope&&(s.$$scope={changed:e,ctx:t}),lt.$set(s);var a={};e.$$scope&&(a.$$scope={changed:e,ctx:t}),ct.$set(a);var l={};e.$$scope&&(l.$$scope={changed:e,ctx:t}),ht.$set(l)},i(e){Ye||(B(et.$$.fragment,e),B(tt.$$.fragment,e),B(nt.$$.fragment,e),B(rt.$$.fragment,e),B(it.$$.fragment,e),B(ot.$$.fragment,e),B(st.$$.fragment,e),B(at.$$.fragment,e),B(lt.$$.fragment,e),B(ct.$$.fragment,e),B(ht.$$.fragment,e),B(ut.$$.fragment,e),Ye=!0)},o(e){J(et.$$.fragment,e),J(tt.$$.fragment,e),J(nt.$$.fragment,e),J(rt.$$.fragment,e),J(it.$$.fragment,e),J(ot.$$.fragment,e),J(st.$$.fragment,e),J(at.$$.fragment,e),J(lt.$$.fragment,e),J(ct.$$.fragment,e),J(ht.$$.fragment,e),J(ut.$$.fragment,e),Ye=!1},d(e){e&&(f(t),f(n),f(r),f(i)),Z(et,e),e&&(f(o),f(s),f(a),f(l),f(c)),Z(tt,e),e&&(f(h),f(m),f(g),f(w),f(y),f(M)),Z(nt),Z(rt),Z(it),e&&f(S),Z(ot,e),e&&(f(_),f(C),f(A),f(z),f(E),f(O),f(R),f(D),f(L)),Z(st,e),e&&(f(T),f(U),f(F),f(q),f(V),f(H),f(W),f(G),f(K)),Z(at,e),e&&(f(X),f(Y),f(ee),f(te),f(ne),f(re),f(ie)),Z(lt,e),e&&(f(oe),f(ae),f(le),f(he),f(ue),f(fe),f(me)),Z(ct,e),e&&(f(pe),f(ge),f(ve),f(be),f(we)),Z(ht,e),e&&(f(ye),f(xe),f(Me),f($e),f(Pe),f(ke),f(Ie),f(Ne),f(je),f(Se),f(_e),f(Ce),f(Ae),f(ze),f(Ee),f(Oe),f(Re),f(De),f(Le),f(Te),f(Ue),f(Fe),f(qe),f(Ve),f(He),f(We),f(Ge),f(Be),f(Je),f(Ke),f(Xe)),Z(ut,e),e&&(f(Qe),f(Ze))}}}function Gs(e){var t,r=[Bs];let i={$$slots:{default:[Ws]},$$scope:{ctx:e}};for(var o=0;o<r.length;o+=1)i=n(i,r[o]);var s=new _s({props:i});return{c(){s.$$.fragment.c()},m(e,n){Q(s,e,n),t=!0},p(e,t){var n,i=e._metadata?function(e,t){const n={},r={},i={$$scope:1};let o=e.length;for(;o--;){const s=e[o],a=t[o];if(a){for(const e in s)e in a||(r[e]=1);for(const e in a)i[e]||(n[e]=a[e],i[e]=1);e[o]=a}else for(const e in s)i[e]=1}for(const e in r)e in n||(n[e]=void 0);return n}(r,[(n=Bs,"object"==typeof n&&null!==n?n:{})]):{};e.$$scope&&(i.$$scope={changed:e,ctx:t}),s.$set(i)},i(e){t||(B(s.$$.fragment,e),t=!0)},o(e){J(s.$$.fragment,e),t=!1},d(e){Z(s,e)}}}const Bs={title:"Understanding UMAP",layout:"./Layout.svelte"};return new class extends te{constructor(e){super(),ee(this,e,null,Gs,a,[])}}({target:document.body})}(d3);
//# sourceMappingURL=bundle.js.map
