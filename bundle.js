var app=function(){"use strict";function e(){}function n(e,n){for(const t in n)e[t]=n[t];return e}function t(e){return e()}function o(){return Object.create(null)}function i(e){e.forEach(t)}function s(e){return"function"==typeof e}function r(e,n){return e!=e?n==n:e!==n||e&&"object"==typeof e||"function"==typeof e}function l(e,n,t){if(e){const o=c(e,n,t);return e[0](o)}}function c(e,t,o){return e[1]?n({},n(t.$$scope.ctx,e[1](o?o(t):{}))):t.$$scope.ctx}function d(e,t,o,i){return e[1]?n({},n(t.$$scope.changed||{},e[1](i?i(o):{}))):t.$$scope.changed||{}}function a(e,n){e.appendChild(n)}function u(e,n,t){e.insertBefore(n,t||null)}function h(e){e.parentNode.removeChild(e)}function m(e){return document.createElement(e)}function f(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function p(e){return document.createTextNode(e)}function v(){return p(" ")}function g(e,n,t,o){return e.addEventListener(n,t,o),()=>e.removeEventListener(n,t,o)}function $(e,n,t){null==t?e.removeAttribute(n):e.setAttribute(n,t)}function x(e,n){n=""+n,e.data!==n&&(e.data=n)}function b(e,n){(null!=n||e.value)&&(e.value=n)}function I(e,n,t,o){e.style.setProperty(n,t,o?"important":"")}let _;function w(e){_=e}function j(){if(!_)throw new Error("Function called outside component initialization");return _}function y(e){j().$$.on_mount.push(e)}function P(e){j().$$.after_update.push(e)}function M(){const e=_;return(n,t)=>{const o=e.$$.callbacks[n];if(o){const i=function(e,n){const t=document.createEvent("CustomEvent");return t.initCustomEvent(e,!1,!1,n),t}(n,t);o.slice().forEach(n=>{n.call(e,i)})}}}const A=[],C=[],k=[],N=[],z=Promise.resolve();let L=!1;function D(e){k.push(e)}function O(e){N.push(e)}function E(){const e=new Set;do{for(;A.length;){const e=A.shift();w(e),F(e.$$)}for(;C.length;)C.pop()();for(let n=0;n<k.length;n+=1){const t=k[n];e.has(t)||(t(),e.add(t))}k.length=0}while(A.length);for(;N.length;)N.pop()();L=!1}function F(e){e.fragment&&(e.update(e.dirty),i(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(D))}const U=new Set;let W;function T(e,n){e&&e.i&&(U.delete(e),e.i(n))}function S(e,n,t,o){if(e&&e.o){if(U.has(e))return;U.add(e),W.c.push(()=>{U.delete(e),o&&(t&&e.d(1),o())}),e.o(n)}}const H="undefined"!=typeof window?window:global;function q(e,n,t){-1!==e.$$.props.indexOf(n)&&(e.$$.bound[n]=t,t(e.$$.ctx[n]))}function B(e,n,o){const{fragment:r,on_mount:l,on_destroy:c,after_update:d}=e.$$;r.m(n,o),D(()=>{const n=l.map(t).filter(s);c?c.push(...n):i(n),e.$$.on_mount=[]}),d.forEach(D)}function G(e,n){e.$$.fragment&&(i(e.$$.on_destroy),e.$$.fragment.d(n),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function R(e,n){e.$$.dirty||(A.push(e),L||(L=!0,z.then(E)),e.$$.dirty=o()),e.$$.dirty[n]=!0}function V(n,t,s,r,l,c){const d=_;w(n);const a=t.props||{},u=n.$$={fragment:null,ctx:null,props:c,update:e,not_equal:l,bound:o(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:o(),dirty:null};let h=!1;var m;u.ctx=s?s(n,a,(e,t,o=t)=>(u.ctx&&l(u.ctx[e],u.ctx[e]=o)&&(u.bound[e]&&u.bound[e](o),h&&R(n,e)),t)):a,u.update(),h=!0,i(u.before_update),u.fragment=r(u.ctx),t.target&&(t.hydrate?u.fragment.l((m=t.target,Array.from(m.childNodes))):u.fragment.c(),t.intro&&T(n.$$.fragment),B(n,t.target,t.anchor),E()),w(d)}let X;"undefined"!=typeof HTMLElement&&(X=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,n,t){this[e]=t}$destroy(){G(this,1),this.$destroy=e}$on(e,n){const t=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return t.push(n),()=>{const e=t.indexOf(n);-1!==e&&t.splice(e,1)}}$set(){}});class Y{$destroy(){G(this,1),this.$destroy=e}$on(e,n){const t=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return t.push(n),()=>{const e=t.indexOf(n);-1!==e&&t.splice(e,1)}}$set(){}}const J=()=>({}),K=()=>({});function Q(e){var n,t,o,i,s;const r=e.$$slots.default,f=l(r,e,null),p=e.$$slots.caption,g=l(p,e,K);return{c(){n=m("figure"),t=m("div"),f&&f.c(),o=v(),i=m("caption"),g&&g.c(),$(t,"class","figure-container svelte-jpfwvv"),$(i,"class","svelte-jpfwvv"),$(n,"class","svelte-jpfwvv")},l(e){f&&f.l(div_nodes),g&&g.l(caption_nodes)},m(e,r){u(e,n,r),a(n,t),f&&f.m(t,null),a(n,o),a(n,i),g&&g.m(i,null),s=!0},p(e,n){f&&f.p&&e.$$scope&&f.p(d(r,n,e,null),c(r,n,null)),g&&g.p&&e.$$scope&&g.p(d(p,n,e,J),c(p,n,K))},i(e){s||(T(f,e),T(g,e),s=!0)},o(e){S(f,e),S(g,e),s=!1},d(e){e&&h(n),f&&f.d(e),g&&g.d(e)}}}function Z(e,n,t){let{$$slots:o={},$$scope:i}=n;return e.$set=(e=>{"$$scope"in e&&t("$$scope",i=e.$$scope)}),{$$slots:o,$$scope:i}}class ee extends Y{constructor(e){super(),V(this,e,Z,Q,r,[])}}class ne{constructor(e){e=Math.ceil(e/32),this.backingArray=new Uint32Array(e),this.length=e}get(e){return 0!=(this.backingArray[e/32|0]&1<<e%32)}on(e){this.backingArray[e/32|0]|=1<<e%32}off(e){this.backingArray[e/32|0]&=~(1<<e%32)}toggle(e){this.backingArray[e/32|0]^=1<<e%32}}var te=function(e,n,t){const o=new ne(n*t);for(let n=0;n<e.length;n++){const t=e[n];for(let e=0;e<8;e++){const i=8*n+e;t&2**e&&o.on(i)}}const i=[];for(let e=0;e<n;e++){let n=0;for(let i=0;i<t;i++){const s=e*t+i;o.get(s)&&(n+=2**i)}i.push(n)}return i},oe=function(e){return Uint8Array.from(e,e=>e.charCodeAt(0))};const ie=10,se=[{id:"mammoth",name:"Mammoth",description:"3D mammoth model with UMAP projections",filename:"mammoth.json"},{id:"dragon",name:"Dragon",description:"3D dragon model with UMAP projections",filename:"dragon.json"},{id:"t-rex",name:"T-rex",description:"3D t-rex model with UMAP projections",filename:"t-rex.json"}],re="mammoth";const le=new Map,ce=new Map;async function de(e){console.log(`_loadUmapForModel: Loading UMAP data for ${e}`);const n=`${e}_10k_encoded.json`;console.log(`Fetching: ${n}`);const t=await fetch(n);if(!t.ok)throw new Error(`Failed to load ${n}: ${t.status} ${t.statusText}`);const o=await t.json();console.log(`Successfully loaded UMAP data for ${e}, projections keys:`,Object.keys(o.projections||{}));const i=function(e){const n={};return Object.keys(e).forEach(t=>{const o=e[t],i=oe(atob(o)),s=te(i,2e4,ie),r=[];for(let e=0;e<s.length;e+=2)r.push([s[e],s[e+1]]);n[t]=r}),n}(o.projections);return o.projections=i,le.set(`umap_${e}`,o),o}async function ae(e){const n=`umap_${e}`;if(le.has(n))return le.get(n);const t=`umap_${e}`;return ce.has(t)||ce.set(t,de(e)),ce.get(t)}async function ue(e){const n=`3d_${e}`;if(le.has(n))return le.get(n);const t=`3d_${e}`;return ce.has(t)||ce.set(t,async function(e){console.log(`_load3DForModel: Loading 3D data for ${e}`);const n=`${e}_3d.json`;console.log(`Fetching: ${n}`);const t=await fetch(n);if(!t.ok)throw new Error(`Failed to load ${n}: ${t.status} ${t.statusText}`);const o=await t.json();return console.log(`Successfully loaded 3D data for ${e}, points count:`,o?o.length:0),le.set(`3d_${e}`,o),o}(e)),ce.get(t)}async function he(e){const n=`colorIndices_${e}`;if(le.has(n))return le.get(n);const t=`colorIndices_${e}`;return ce.has(t)||ce.set(t,async function(e){console.log(`_loadColorIndicesForModel: Loading color indices for ${e}`);const n=(await ae(e)).labelOffsets;console.log(`Color offsets for ${e}:`,n?n.length:0,"groups");const t=new Uint8Array(1e4);let o=-1,i=0;for(let e=0;e<t.length;e++)e>=i&&(i+=n[o+=1]),t[e]=o;return console.log(`Generated color indices for ${e}, length:`,t.length),le.set(`colorIndices_${e}`,t),t}(e)),ce.get(t)}function me(n){var t,o;return{c(){$(t=m("input"),"type","range"),$(t,"min",n.min),$(t,"max",n.max),$(t,"step",n.step),$(t,"class","svelte-fa559t"),o=[g(t,"change",n.input_change_input_handler),g(t,"input",n.input_change_input_handler),g(t,"change",n.onSliderChange)]},m(e,o){u(e,t,o),b(t,n.value)},p(e,n){e.value&&b(t,n.value),e.min&&$(t,"min",n.min),e.max&&$(t,"max",n.max),e.step&&$(t,"step",n.step)},i:e,o:e,d(e){e&&h(t),i(o)}}}function fe(e,n,t){let{value:o,min:i=0,max:s=100,step:r=1,onChange:l=(()=>{})}=n;return e.$set=(e=>{"value"in e&&t("value",o=e.value),"min"in e&&t("min",i=e.min),"max"in e&&t("max",s=e.max),"step"in e&&t("step",r=e.step),"onChange"in e&&t("onChange",l=e.onChange)}),{value:o,min:i,max:s,step:r,onChange:l,onSliderChange:e=>{l(e.target.value)},input_change_input_handler:function(){o=function(e){return""===e?void 0:+e}(this.value),t("value",o)}}}class pe extends Y{constructor(e){super(),V(this,e,fe,me,r,["value","min","max","step","onChange"])}}const ve=["rgba(204, 0, 17, 1)","rgba(0, 34, 68, 1)","rgba(221, 221, 51, 1)","rgba(0, 68, 136, 1)","rgba(0, 51, 17, 1)","rgba(17, 170, 170, 1)","rgba(46, 102, 151, 1)","rgba(155, 32, 6, 1)","rgba(204, 0, 17, 1)","rgba(17, 170, 170, 1)","rgba(17, 170, 170, 1)"],ge=e=>e<.5?2*e*e:(4-2*e)*e-1,$e=500,xe=e=>e.map(([e,n])=>[e,n]);class be{constructor(e,n,t=ge,o=$e){this.current=xe(e),this.end=xe(e),this.callback=n,this.easingFn=t,this.tweenDuration=o,this.isActive=!1,this.percent=1,this.onAnimationFrame=this.onAnimationFrame.bind(this)}beginTween(e){this.start=xe(this.current),this.end=xe(e),this.isActive=!0,this.startTime=Date.now(),requestAnimationFrame(this.onAnimationFrame)}applyTween(){this.current=this.current.map((e,n)=>{const[t,o]=this.start[n],[i,s]=this.end[n];return[(i-t)*this.percent+t,(s-o)*this.percent+o]})}onAnimationFrame(){const e=Date.now()-this.startTime,n=Math.min(1,e/this.tweenDuration);this.percent=this.easingFn(n),1===this.percent&&(this.isActive=!1),this.applyTween(),this.callback(this.current,this.isActive,this.percent),this.isActive&&requestAnimationFrame(this.onAnimationFrame)}}function Ie(e){var n,t,o,i;return{c(){$(n=f("circle"),"r","10"),$(n,"fill","none"),$(n,"stroke","#000"),$(n,"stroke-width","3"),$(n,"opacity",t=e.hoveredPointIndex>-1?1:0),$(n,"cx",o=e.projection[e.hoveredPointIndex][0]),$(n,"cy",i=e.projection[e.hoveredPointIndex][1])},m(e,t){u(e,n,t)},p(e,s){e.hoveredPointIndex&&t!==(t=s.hoveredPointIndex>-1?1:0)&&$(n,"opacity",t),(e.projection||e.hoveredPointIndex)&&o!==(o=s.projection[s.hoveredPointIndex][0])&&$(n,"cx",o),(e.projection||e.hoveredPointIndex)&&i!==(i=s.projection[s.hoveredPointIndex][1])&&$(n,"cy",i)},d(e){e&&h(n)}}}function _e(n){var t,o,s,r,l,c,d,b,I=n.projection[n.hoveredPointIndex]+"",_=n.projection[n.hoveredPointIndex]&&n.projection[n.hoveredPointIndex][0]&&Ie(n);return{c(){t=m("div"),o=m("canvas"),s=v(),r=f("svg"),l=f("text"),c=p(I),_&&_.c(),$(o,"width",n.size),$(o,"height",n.size),$(o,"class","svelte-1t453rc"),$(r,"viewBox",d="0 0 "+n.size+" "+n.size),$(r,"class","svelte-1t453rc"),$(t,"class","container svelte-1t453rc"),b=[g(o,"mousemove",n.handleMousemove),g(o,"mouseout",n.handleMouseout)]},m(e,i){u(e,t,i),a(t,o),n.canvas_1_binding(o),a(t,s),a(t,r),a(r,l),a(l,c),_&&_.m(r,null),n.svg_1_binding(r)},p(e,n){e.size&&($(o,"width",n.size),$(o,"height",n.size)),(e.projection||e.hoveredPointIndex)&&I!==(I=n.projection[n.hoveredPointIndex]+"")&&x(c,I),n.projection[n.hoveredPointIndex]&&n.projection[n.hoveredPointIndex][0]?_?_.p(e,n):((_=Ie(n)).c(),_.m(r,null)):_&&(_.d(1),_=null),e.size&&d!==(d="0 0 "+n.size+" "+n.size)&&$(r,"viewBox",d)},i:e,o:e,d(e){e&&h(t),n.canvas_1_binding(null),_&&_.d(),n.svg_1_binding(null),i(b)}}}function we(e,n,t){const o=M();let i,s,r,{colorIndices:l,projection:c,hoveredPointIndex:d=-1,size:a=1024}=n;const u=(e,n,t)=>{!function(e,n,t,o){const{width:i,height:s}=n,r=e.getContext("2d");r.clearRect(0,0,i,s);for(let e=0;e<t.length;e++){const n=t[e],[i,s]=n,l=o[e];r.fillStyle=ve[l],r.fillRect(i,s,3,3)}}(i,{width:a,height:a},e,l)};y(()=>{r=new be(c,u)});let h=null;return P(()=>{c!=h&&(h=c,r.beginTween(c))}),e.$set=(e=>{"colorIndices"in e&&t("colorIndices",l=e.colorIndices),"projection"in e&&t("projection",c=e.projection),"hoveredPointIndex"in e&&t("hoveredPointIndex",d=e.hoveredPointIndex),"size"in e&&t("size",a=e.size)}),{canvas:i,svg:s,colorIndices:l,projection:c,hoveredPointIndex:d,size:a,handleMousemove:function(){var e=a/i.offsetWidth,n=event.layerX*e,t=event.layerY*e;if(l||!l.length){var s=1/0,r=0;c.forEach((e,o)=>{var i=e[0]-n,l=e[1]-t,c=i*i+l*l;c<s&&(s=c,r=o)}),o("hover",r)}},handleMouseout:function(){o("hover",-1)},canvas_1_binding:function(e){C[e?"unshift":"push"](()=>{t("canvas",i=e)})},svg_1_binding:function(e){C[e?"unshift":"push"](()=>{t("svg",s=e)})}}}class je extends Y{constructor(e){super(),V(this,e,we,_e,r,["colorIndices","projection","hoveredPointIndex","size"])}}function ye(e){var n,t;return{c(){n=m("div"),t=p(e.title),$(n,"class","title svelte-1jfiwdb")},m(e,o){u(e,n,o),a(n,t)},p(e,n){e.title&&x(t,n.title)},d(e){e&&h(n)}}}function Pe(e){var n,t,o,i,s,r,l,c=e.times[e.nNeighborsIndex].t+"";return{c(){n=m("div"),t=m("label"),(o=m("span")).textContent="time:",i=v(),s=p(c),r=v(),l=m("div"),$(o,"class","label-text svelte-1jfiwdb"),$(t,"class","label svelte-1jfiwdb"),I(l,"width",e.sliderWidth+"px"),$(n,"class","controls svelte-1jfiwdb")},m(e,c){u(e,n,c),a(n,t),a(t,o),a(t,i),a(t,s),a(n,r),a(n,l)},p(e,n){(e.times||e.nNeighborsIndex)&&c!==(c=n.times[n.nNeighborsIndex].t+"")&&x(s,c),e.sliderWidth&&I(l,"width",n.sliderWidth+"px")},d(e){e&&h(n)}}}function Me(e){var n,t,o,i,s,r,l,c,d,f,g,b,_,w,j,y,P,M,A,k,N,z,L=e.title&&ye(e),D=new je({props:{projection:e.projection,colorIndices:e.colorIndices,hoveredPointIndex:e.hoveredPointIndex}});function E(n){e.slider0_value_binding.call(null,n),g=!0,O(()=>g=!1)}D.$on("hover",e.hover_handler);let F={min:0,max:e.neighbors.length-1,step:1};void 0!==e.nNeighborsIndex&&(F.value=e.nNeighborsIndex);var U=new pe({props:F});function W(n){e.slider1_value_binding.call(null,n),k=!0,O(()=>k=!1)}C.push(()=>q(U,"value",E));let H={min:0,max:e.dists.length-1,step:1};void 0!==e.distsIndex&&(H.value=e.distsIndex);var R=new pe({props:H});C.push(()=>q(R,"value",W));var V=e.times&&Pe(e);return{c(){n=m("div"),L&&L.c(),t=v(),D.$$.fragment.c(),o=v(),i=m("div"),s=m("label"),(r=m("span")).textContent="n_neighbors:",l=v(),c=p(e.nNeighbors),d=v(),f=m("div"),U.$$.fragment.c(),b=v(),_=m("div"),w=m("label"),(j=m("span")).textContent="min_dist:",y=v(),P=p(e.minDist),M=v(),A=m("div"),R.$$.fragment.c(),N=v(),V&&V.c(),$(r,"class","label-text svelte-1jfiwdb"),$(s,"class","label svelte-1jfiwdb"),I(f,"width",e.sliderWidth+"px"),$(i,"class","controls svelte-1jfiwdb"),$(j,"class","label-text svelte-1jfiwdb"),$(w,"class","label svelte-1jfiwdb"),I(A,"width",e.sliderWidth+"px"),$(_,"class","controls svelte-1jfiwdb"),$(n,"class","container svelte-1jfiwdb")},m(e,h){u(e,n,h),L&&L.m(n,null),a(n,t),B(D,n,null),a(n,o),a(n,i),a(i,s),a(s,r),a(s,l),a(s,c),a(i,d),a(i,f),B(U,f,null),a(n,b),a(n,_),a(_,w),a(w,j),a(w,y),a(w,P),a(_,M),a(_,A),B(R,A,null),a(n,N),V&&V.m(n,null),z=!0},p(e,o){o.title?L?L.p(e,o):((L=ye(o)).c(),L.m(n,t)):L&&(L.d(1),L=null);var i={};e.projection&&(i.projection=o.projection),e.colorIndices&&(i.colorIndices=o.colorIndices),e.hoveredPointIndex&&(i.hoveredPointIndex=o.hoveredPointIndex),D.$set(i),z&&!e.nNeighbors||x(c,o.nNeighbors);var s={};!g&&e.nNeighborsIndex&&(s.value=o.nNeighborsIndex),U.$set(s),z&&!e.sliderWidth||I(f,"width",o.sliderWidth+"px"),z&&!e.minDist||x(P,o.minDist);var r={};!k&&e.distsIndex&&(r.value=o.distsIndex),R.$set(r),z&&!e.sliderWidth||I(A,"width",o.sliderWidth+"px"),o.times?V?V.p(e,o):((V=Pe(o)).c(),V.m(n,null)):V&&(V.d(1),V=null)},i(e){z||(T(D.$$.fragment,e),T(U.$$.fragment,e),T(R.$$.fragment,e),z=!0)},o(e){S(D.$$.fragment,e),S(U.$$.fragment,e),S(R.$$.fragment,e),z=!1},d(e){e&&h(n),L&&L.d(),G(D),G(U),G(R),V&&V.d()}}}function Ae(e,n,t){let o=230;function i(e){e.matches?t("sliderWidth",o=100):t("sliderWidth",o=230)}const s=window.matchMedia("(max-width: 800px)");i(s),s.addListener(i);const r=[3,5,10,15,20,50,100,200],l=["0.0","0.1","0.25","0.5","0.8","0.99"];let c=3,d=r[c],a=1,u=l[a],{colorIndices:h,projections:m,title:f="",times:p=null,hoveredPointIndex:v=-1}=n;const g=()=>m?m[(()=>`n=${d},d=${u}`)()]:null;let $=g();return P(()=>{t("nNeighbors",d=r[c]),t("minDist",u=l[a]),t("projection",$=g()),console.log("Umap2d afterUpdate - projection:",$?$.length:"null")}),y(()=>{console.log("Umap2d onMount - colorIndices:",h?h.length:"null"),console.log("Umap2d onMount - projections:",m?Object.keys(m):"null")}),e.$set=(e=>{"colorIndices"in e&&t("colorIndices",h=e.colorIndices),"projections"in e&&t("projections",m=e.projections),"title"in e&&t("title",f=e.title),"times"in e&&t("times",p=e.times),"hoveredPointIndex"in e&&t("hoveredPointIndex",v=e.hoveredPointIndex)}),{sliderWidth:o,neighbors:r,dists:l,nNeighborsIndex:c,nNeighbors:d,distsIndex:a,minDist:u,colorIndices:h,projections:m,title:f,times:p,hoveredPointIndex:v,projection:$,hover_handler:function(n){!function(e,n){const t=e.$$.callbacks[n.type];t&&t.slice().forEach(e=>e(n))}(e,n)},slider0_value_binding:function(e){t("nNeighborsIndex",c=e)},slider1_value_binding:function(e){t("distsIndex",a=e)}}}class Ce extends Y{constructor(e){super(),V(this,e,Ae,Me,r,["colorIndices","projections","title","times","hoveredPointIndex"])}}function ke(e){var n,t;return{c(){n=m("div"),t=p(e.title),$(n,"class","title svelte-1rtl5dd")},m(e,o){u(e,n,o),a(n,t)},p(e,n){e.title&&x(t,n.title)},d(e){e&&h(n)}}}function Ne(e){var n,t;return{c(){(n=m("div")).innerHTML='<i class="material-icons">3d_rotation</i>',$(n,"class","orbit svelte-1rtl5dd"),t=g(n,"click",e.toggleOrbit)},m(e,t){u(e,n,t)},d(e){e&&h(n),t()}}}function ze(n){var t,o,i,s,r,l=n.title&&ke(n),c=!n.isOrbiting&&Ne(n);return{c(){t=m("div"),l&&l.c(),o=v(),i=m("div"),s=v(),c&&c.c(),$(i,"class","scatter-gl-container svelte-1rtl5dd"),$(t,"class","container svelte-1rtl5dd"),r=g(t,"mouseout",n.handleMouseout)},m(e,r){u(e,t,r),l&&l.m(t,null),a(t,o),a(t,i),n.div0_binding(i),a(t,s),c&&c.m(t,null)},p(e,n){n.title?l?l.p(e,n):((l=ke(n)).c(),l.m(t,o)):l&&(l.d(1),l=null),n.isOrbiting?c&&(c.d(1),c=null):c||((c=Ne(n)).c(),c.m(t,null))},i:e,o:e,d(e){e&&h(t),l&&l.d(),n.div0_binding(null),c&&c.d(),r()}}}function Le(e,n,t){const o=M();let i,s,r=!0,{colorIndices:l,model3d:c,title:d="",hoveredPointIndex:a=-1}=n;return y(async()=>{if(console.log("Projection3d onMount - model3d:",c?c.length:"null"),console.log("Projection3d onMount - colorIndices:",l?l.length:"null"),!c||!l)return void console.error("Projection3d: Missing required data",{model3d:!!c,colorIndices:!!l});const e={dimensions:3,points:c,metadata:[]};s=new ScatterGL(i,{styles:{fog:{enabled:!1},point:{scaleHover:3.5,colorHover:"rgba(0,0,0,1)"}},selectEnabled:!1,onCameraMove:()=>{r&&t("isOrbiting",r=!1)},onHover:e=>{null!==e&&e!==a&&o("hover",e)}}),window.scatterGLObj=s,s.setPointColorer(e=>{const n=l[e];return ve[n]}),s.render(e)}),P(()=>{s.setHoverPointIndex(a)}),e.$set=(e=>{"colorIndices"in e&&t("colorIndices",l=e.colorIndices),"model3d"in e&&t("model3d",c=e.model3d),"title"in e&&t("title",d=e.title),"hoveredPointIndex"in e&&t("hoveredPointIndex",a=e.hoveredPointIndex)}),{container:i,isOrbiting:r,colorIndices:l,model3d:c,title:d,hoveredPointIndex:a,handleMouseout:function(){o("hover",-1)},toggleOrbit:()=>{t("isOrbiting",r=!0),s.startOrbitAnimation()},div0_binding:function(e){C[e?"unshift":"push"](()=>{t("container",i=e)})}}}class De extends Y{constructor(e){super(),V(this,e,Le,ze,r,["colorIndices","model3d","title","hoveredPointIndex"])}}const{Object:Oe}=H;function Ee(e,n,t){const o=Oe.create(e);return o.model=n[t],o}function Fe(e){var n,t,o,i=e.model.name+"";return{c(){n=m("option"),t=p(i),n.__value=o=e.model.id,n.value=n.__value},m(e,o){u(e,n,o),a(n,t)},p(e,s){e.availableModels&&i!==(i=s.model.name+"")&&x(t,i),e.availableModels&&o!==(o=s.model.id)&&(n.__value=o),n.value=n.__value},d(e){e&&h(n)}}}function Ue(n){var t;return{c(){(t=m("div")).textContent="Loading...",$(t,"class","loading-message svelte-1mmcyz7")},m(e,n){u(e,t,n)},p:e,i:e,o:e,d(e){e&&h(t)}}}function We(e){var n,t,o=new De({props:{colorIndices:e.colorIndices,model3d:e.model3d,hoveredPointIndex:e.hoveredPointIndex,title:`Original 3D Data - ${e.currentModelName}`}});o.$on("hover",e.hover_handler);var i=new Ce({props:{colorIndices:e.colorIndices,projections:e.projections,hoveredPointIndex:e.hoveredPointIndex,title:`2D UMAP Projection - ${e.currentModelName}`}});return i.$on("hover",e.hover_handler_1),{c(){o.$$.fragment.c(),n=v(),i.$$.fragment.c()},m(e,s){B(o,e,s),u(e,n,s),B(i,e,s),t=!0},p(e,n){var t={};e.colorIndices&&(t.colorIndices=n.colorIndices),e.model3d&&(t.model3d=n.model3d),e.hoveredPointIndex&&(t.hoveredPointIndex=n.hoveredPointIndex),e.currentModelName&&(t.title=`Original 3D Data - ${n.currentModelName}`),o.$set(t);var s={};e.colorIndices&&(s.colorIndices=n.colorIndices),e.projections&&(s.projections=n.projections),e.hoveredPointIndex&&(s.hoveredPointIndex=n.hoveredPointIndex),e.currentModelName&&(s.title=`2D UMAP Projection - ${n.currentModelName}`),i.$set(s)},i(e){t||(T(o.$$.fragment,e),T(i.$$.fragment,e),t=!0)},o(e){S(o.$$.fragment,e),S(i.$$.fragment,e),t=!1},d(e){G(o,e),e&&h(n),G(i,e)}}}function Te(n){var t,o,i,s,r=n.currentModelName||n.selectedModelId+"";return{c(){t=m("div"),o=p("Loading "),i=p(r),s=p("..."),$(t,"class","loading-message svelte-1mmcyz7")},m(e,n){u(e,t,n),a(t,o),a(t,i),a(t,s)},p(e,n){(e.currentModelName||e.selectedModelId)&&r!==(r=n.currentModelName||n.selectedModelId+"")&&x(i,r)},i:e,o:e,d(e){e&&h(t)}}}function Se(e){var n,t,o,s,r,l,c,d,f,p,x,b;let I=e.availableModels,_=[];for(let n=0;n<I.length;n+=1)_[n]=Fe(Ee(e,I,n));var w=[Te,We,Ue],j=[];function y(e,n){return n.isLoading?0:n.isLoaded?1:2}return f=y(0,e),p=j[f]=w[f](e),{c(){n=m("div"),t=m("div"),(o=m("label")).textContent="Select Model:",s=v(),r=m("select");for(let e=0;e<_.length;e+=1)_[e].c();c=v(),d=m("div"),p.c(),$(o,"for","model-select"),$(o,"class","svelte-1mmcyz7"),$(r,"id","model-select"),r.disabled=e.isLoading,$(r,"class","svelte-1mmcyz7"),$(t,"class","model-selector svelte-1mmcyz7"),$(d,"class","visualization-container svelte-1mmcyz7"),$(n,"class","container svelte-1mmcyz7"),b=g(r,"change",e.handleModelChange)},m(i,h){u(i,n,h),a(n,t),a(t,o),a(t,s),a(t,r);for(let e=0;e<_.length;e+=1)_[e].m(r,null);l=e.selectedModelId;for(var m=0;m<r.options.length;m+=1){var p=r.options[m];if(p.__value===l){p.selected=!0;break}}a(n,c),a(n,d),j[f].m(d,null),x=!0},p(e,n){if(e.availableModels){let t;for(I=n.availableModels,t=0;t<I.length;t+=1){const o=Ee(n,I,t);_[t]?_[t].p(e,o):(_[t]=Fe(o),_[t].c(),_[t].m(r,null))}for(;t<_.length;t+=1)_[t].d(1);_.length=I.length}if((!x||e.selectedModelId)&&l!==(l=n.selectedModelId))for(var t=0;t<r.options.length;t+=1){var o=r.options[t];if(o.__value===l){o.selected=!0;break}}x&&!e.isLoading||(r.disabled=n.isLoading);var s=f;(f=y(0,n))===s?j[f].p(e,n):(W={r:0,c:[],p:W},S(j[s],1,1,()=>{j[s]=null}),W.r||i(W.c),W=W.p,(p=j[f])||(p=j[f]=w[f](n)).c(),T(p,1),p.m(d,null))},i(e){x||(T(p),x=!0)},o(e){S(p),x=!1},d(e){e&&h(n),function(e,n){for(let t=0;t<e.length;t+=1)e[t]&&e[t].d(n)}(_,e),j[f].d(),b()}}}function He(e,n,t){let o,i,s,r=!1,l=!1,c=-1,d=re,a=[],u="";async function h(e){if(console.log(`Loading model: ${e}`),l)console.log("Already loading, skipping...");else{t("isLoading",l=!0),t("isLoaded",r=!1);try{console.log(`Fetching data for model: ${e}`);const n=await async function(e){const n={};return await Promise.all([ae(e).then(e=>n.projections=e.projections),he(e).then(e=>n.colorIndices=e),ue(e).then(e=>n.model3d=e)]),n}(e);console.log("Data loaded:",n),t("colorIndices",o=n.colorIndices),t("projections",i=n.projections),t("model3d",s=n.model3d),console.log("ColorIndices:",o?o.length:"null"),console.log("Projections:",i?Object.keys(i):"null"),console.log("Model3d:",s?s.length:"null");const d=a.find(n=>n.id===e);t("currentModelName",u=d?d.name:e),t("isLoaded",r=!0),t("hoveredPointIndex",c=-1),console.log(`Model ${e} loaded successfully`)}catch(n){console.error(`Failed to load model ${e}:`,n)}finally{t("isLoading",l=!1)}}}y(async()=>{console.log("VisualizationUmapWithModels: onMount starting"),t("availableModels",a=se),console.log("Available models:",a),console.log("Default model selected:",d),await h(d),console.log("Initial model loaded")});return{isLoaded:r,isLoading:l,colorIndices:o,projections:i,model3d:s,hoveredPointIndex:c,selectedModelId:d,availableModels:a,currentModelName:u,handleModelChange:async function(e){const n=e.target.value;console.log(`handleModelChange: ${d} -> ${n}`),t("selectedModelId",d=n),console.log(`Switching to model: ${d}`),await h(d)},hover_handler:e=>t("hoveredPointIndex",c=e.detail),hover_handler_1:e=>t("hoveredPointIndex",c=e.detail)}}class qe extends Y{constructor(e){super(),V(this,e,He,Se,r,[])}}function Be(e){var n,t=new qe({});return{c(){t.$$.fragment.c()},m(e,o){B(t,e,o),n=!0},i(e){n||(T(t.$$.fragment,e),n=!0)},o(e){S(t.$$.fragment,e),n=!1},d(e){G(t,e)}}}function Ge(e){var n,t=new ee({props:{$$slots:{default:[Be]},$$scope:{ctx:e}}});return{c(){t.$$.fragment.c()},m(e,o){B(t,e,o),n=!0},p(e,n){var o={};e.$$scope&&(o.$$scope={changed:e,ctx:n}),t.$set(o)},i(e){n||(T(t.$$.fragment,e),n=!0)},o(e){S(t.$$.fragment,e),n=!1},d(e){G(t,e)}}}return new class extends Y{constructor(e){super(),V(this,e,null,Ge,r,[])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
